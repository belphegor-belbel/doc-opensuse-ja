<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 [
<!ENTITY % entities SYSTEM "generic-entities.ent">
%entities;
]>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0" xml:id="sec-security-ldap-migrate">
  <info>
    <title>OpenLDAP ã‹ã‚‰ &ds389; ã¸ã®ç§»è¡Œ</title>
    <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
      <dm:translation>yes</dm:translation>
    </dm:docmanager>
  </info>

  <para>OpenLDAP ã¯ <phrase os="sles;sled">&sle; 15&nbsp;SP3 ã«ã¦ã‚µãƒãƒ¼ãƒˆå¯¾è±¡ã‹ã‚‰å¤–ã•ã‚Œã€</phrase> å»ƒæ­¢äºˆå®šã¨ãªã‚Šã€ &ds389; ã«ç½®ãæ›ãˆã‚‰ã‚Œã¦ã„ã¾ã™ã€‚ &suse; ã§ã¯ã“ã®ç§»è¡Œä½œæ¥­ã‚’æ”¯æ´ã™ã‚‹ãŸã‚ã€ <package>389-ds</package> ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å†…ã« <command>openldap_to_ds</command> ã¨ã„ã†ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚</para>

  <para><command>openldap_to_ds</command> ã¯ç§»è¡Œä½œæ¥­ã‚’ã§ãã‚‹é™ã‚Šè‡ªå‹•çš„ã«å®Ÿæ–½ã§ãã‚‹ã‚ˆã†è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ã€‚ã§ã™ãŒã€ãã‚Œãã‚Œã® LDAP ç’°å¢ƒã¯ç•°ãªã‚‹ã‚‚ã®ã§ã‚ã‚‹ã“ã¨ã‹ã‚‰ã€å…¨ã¦ã®ç’°å¢ƒã«é©åˆã™ã‚‹ãƒ„ãƒ¼ãƒ«ã‚’ä½œæˆã™ã‚‹ã®ã¯ä¸å¯èƒ½ã§ã™ã€‚ãã®ãŸã‚ã€ã„ãã¤ã‹ã®ä½œæ¥­ã«ã¤ã„ã¦ã¯æ‰‹ä½œæ¥­ã§å®Ÿæ–½ã™ã‚‹ã“ã¨ã«ãªã‚‹ã»ã‹ã€æœ¬ç•ªç’°å¢ƒã®ç§»è¡Œã«ã‚ãŸã£ã¦ã€ã‚ã‚‰ã‹ã˜ã‚ç§»è¡Œæ‰‹é †ã®ãƒ†ã‚¹ãƒˆã‚’è¡Œã†å¿…è¦ã‚‚ã‚ã‚Šã¾ã™ã€‚</para>

  <important>
    <title>Read the <command>help</command> page</title>
    <para>
      Before using the <command>openldap_to_ds</command> migration tool, we
      strongly recommend reading the output of <command>openldap_to_ds
      --help</command>. It helps you learn about the capabilities and
      limitations of the migration tool, and prevents you from making wrong
      assumptions.
    </para>
  </important>

  <sect2 xml:id="sec-security-ldap-migrate-test">
    <title>OpenLDAP ã‹ã‚‰ã®ãƒ†ã‚¹ãƒˆç§»è¡Œ</title>
    <para>OpenLDAP ã¨ &ds389; ã¨ã®é–“ã«ã¯ãã‚Œãªã‚Šã®å·®ç•°ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã‹ã‚‰ã€ç§»è¡Œã‚’è¡Œã†ã«ã‚ãŸã£ã¦ã‚‚äº‹å‰ã®ãƒ†ã‚¹ãƒˆã¨èª¿æ•´ã‚’ç¹°ã‚Šè¿”ã—å®Ÿæ–½ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã§ã—ã‚‡ã†ã€‚ãã®ãŸã‚ã€æ‰‹æ—©ãç§»è¡Œãƒ†ã‚¹ãƒˆã‚’å®Ÿæ–½ã—ã¦ã€å¿…è¦ãªè¿½åŠ æ‰‹é †ã‚’ç´ æ—©ãæ´—ã„å‡ºã™ã“ã¨ãŒè‚å¿ƒã§ã™ã€‚</para>
    <para>ã‚ã‚‰ã‹ã˜ã‚ç”¨æ„ã—ã¦ãŠãã¹ãã‚‚ã®:</para>
    <itemizedlist>
      <listitem>
        <para>ä½•ã‚ˆã‚Šã‚‚ &ds389; ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®å‹•ä½œã™ã‚‹ãƒã‚·ãƒ³ãŒå¿…è¦ã§ã™ã€‚</para>
      </listitem>
      <listitem>
        <para>OpenLDAP <filename>slapd</filename> ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã€ã‚‚ã—ãã¯ ldif å½¢å¼ã«ã‚ˆã‚‹å‹•çš„ãªè¨­å®šãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã€‚</para>
      </listitem>
      <listitem>
        <para>OpenLDAP ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã® ldif å½¢å¼ã«ã‚ˆã‚‹ãƒ•ãƒ«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã€‚</para>
      </listitem>
    </itemizedlist>
    <para>slapd ã®è¨­å®šãŒå‹•çš„ãª ldif å½¢å¼ã§ã¯ãªã„å ´åˆã€ã¾ãšã¯ <command>slaptest</command> ã‚’åˆ©ç”¨ã—ã¦å‹•çš„ãªã‚³ãƒ”ãƒ¼ã‚’ä½œæˆã—ã¾ã™ã€‚ <filename>/root/slapd.d/</filename> ã®ã‚ˆã†ãª <filename>slapd.d</filename> ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã¦ã€ä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™:</para>
<screen>&prompt.sudo;<command>slaptest -f /etc/openldap/slapd.conf -F /root/slapd.d</command>
     </screen>
    <para>ä¸Šè¨˜ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ä¸‹è¨˜ã®ã‚ˆã†ã«ã„ãã¤ã‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã‚‹ã¯ãšã§ã™:</para>
<screen>&prompt.sudo;<command>ls /root/slapd.d/*</command>

/root/slapd.d/cn=config.ldif

/root/slapd.d/cn=config:
cn=module{0}.ldif  cn=schema.ldif                 olcDatabase={0}config.ldif
cn=schema          olcDatabase={-1}frontend.ldif  olcDatabase={1}mdb.ldif
</screen>
    <para>ã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹ã”ã¨ã« 1 ã¤ã® ldif ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã¾ã™ã€‚ä»¥é™ã®ä¾‹ã§ã¯ã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹ãŒ dc= <replaceable>LDAP1</replaceable> ,dc= <replaceable>COM</replaceable> ã§ã‚ã‚‹ã‚‚ã®ã¨ã—ã¾ã™ã€‚ã¾ãŸã€ <filename>/etc/openldap/slapd.conf</filename> å½¢å¼ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã¯ã€ä¸‹è¨˜ã®ã‚ˆã†ãªã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ã€ ldif ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™:</para>
<screen>
&prompt.sudo;<command>slapcat -f /etc/openldap/slapd.conf -b dc=<replaceable>LDAP1</replaceable>,dc=<replaceable>COM</replaceable></command> \
<command>-l <replaceable>/root/LDAP1-COM</replaceable>.ldif</command>
   </screen>
    <para>ã‚ã¨ã¯ <command>openldap_to_ds</command> ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚’åˆ©ç”¨ã—ã¦è¨­å®šã¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ†æã•ã›ã€ç§»è¡Œãƒ—ãƒ©ãƒ³ã‚’è¡¨ç¤ºã•ã›ã¾ã™ (ã“ã®æ™‚ç‚¹ã§ã¯ä½•ã‚‚å¤‰æ›´ã¯è¡Œã‚ã‚Œã¾ã›ã‚“):</para>
<screen>&prompt.sudo;<command>openldap_to_ds <replaceable>LDAP1</replaceable></command>\
<command>/root/slapd.d <replaceable>/root/LDAP1-COM</replaceable>.ldif.ldif</command></screen>
    <para>å‰è¿°ã®ã¨ãŠã‚Šä¸Šè¨˜ã§ã¯ä½•ã‚‚å¤‰æ›´ã•ã‚Œã¾ã›ã‚“ãŒã€ä¸‹è¨˜ã®ã‚ˆã†ãªå‡ºåŠ›ãŒç¾ã‚Œã‚‹ã¯ãšã§ã™:</para>
<screen>Examining OpenLDAP Configuration ...
Completed OpenLDAP Configuration Parsing.
Examining Ldifs ...
Completed Ldif Metadata Parsing.
The following migration steps will be performed:
 * Schema Skip Unsupported Attribute -&gt; otherMailbox (0.9.2342.19200300.100.1.22)
 * Schema Skip Unsupported Attribute -&gt; dSAQuality (0.9.2342.19200300.100.1.49)
 * Schema Skip Unsupported Attribute -&gt; singleLevelQuality (0.9.2342.19200300.100.1.50)
 * Schema Skip Unsupported Attribute -&gt; subtreeMinimumQuality (0.9.2342.19200300.100.1.51)
 * Schema Skip Unsupported Attribute -&gt; subtreeMaximumQuality (0.9.2342.19200300.100.1.52)
 * Schema Create Attribute -&gt; suseDefaultBase (SUSE.YaST.ModuleConfig.Attr:2)
 * Schema Create Attribute -&gt; suseNextUniqueId (SUSE.YaST.ModuleConfig.Attr:3)
[...]
 * Schema Create ObjectClass -&gt; suseDhcpConfiguration (SUSE.YaST.ModuleConfig.OC:10)
 * Schema Create ObjectClass -&gt; suseMailConfiguration (SUSE.YaST.ModuleConfig.OC:11)
 * Database Reindex -&gt; dc=example,dc=com
 * Database Import Ldif -&gt; dc=example,dc=com from example.ldif -
excluding entry attributes = [{'structuralobjectclass', 'entrycsn'}]
No actions taken. To apply migration plan, use '--confirm'
</screen>
    <para>ã‚ã¨ã¯ä¸‹è¨˜ã®ã‚ˆã†ã«å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ã€å®Ÿéš›ã®ç§»è¡Œã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚å¤‰æ›´ã—ãªã„å ´åˆã¨ã¯å‡ºåŠ›ãŒç•°ãªã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„:</para>
<screen>&prompt.sudo;<command>openldap_to_ds <replaceable>LDAP1</replaceable> /root/slapd.d <replaceable>/root/LDAP1-COM</replaceable>.ldif --confirm</command>
Starting Migration ... This may take some time ...
migration: 1 / 40 complete ...
migration: 2 / 40 complete ...
migration: 3 / 40 complete ...
[...]
Index task index_all_05252021_120216 completed successfully
post: 39 / 40 complete ...
post: 40 / 40 complete ...
ğŸ‰ Migration complete!
----------------------
You should now review your instance configuration and data:
 * [ ] - Create/Migrate Database Access Controls (ACI)
 * [ ] - Enable and Verify TLS (LDAPS) Operation
 * [ ] - Schedule Automatic Backups
 * [ ] - Verify Accounts Can Bind Correctly
 * [ ] - Review Schema Inconistent ObjectClass -&gt; pilotOrganization (0.9.2342.19200300.100.4.20)
 * [ ] - Review Database Imported Content is Correct -&gt; dc=ldap1,dc=com
</screen>
    <para>ç§»è¡ŒãŒå®Œäº†ã™ã‚‹ã¨ <command>openldap_to_ds</command> ã¯ã€å®Ÿæ–½ã—ã¦ãŠã‹ãªã‘ã‚Œã°ãªã‚‰ãªã„ç§»è¡Œå¾Œã®ãƒã‚§ãƒƒã‚¯ä½œæ¥­ã®ä¸€è¦§ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚ã“ã®ä½œæ¥­ã¯ã„ãšã‚Œã‚‚ç§»è¡Œã‚’æœ€é©ã«è¡Œã†ãŸã‚ã«å¿…è¦ãªæ‰‹é †ã§ã™ã®ã§ã€æœ¬ç•ªç’°å¢ƒã§ã‚‚åŒã˜ã‚ˆã†ã«ã—ã¦ãŠãã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚ã‚ã¨ã¯ãƒ†ã‚¹ãƒˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã€ç§»è¡Œå¾Œã® &ds389; ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«å‘ã‘ã¦ãƒ†ã‚¹ãƒˆã‚’è¡Œã£ã¦ãã ã•ã„ã€‚</para>
    <important>
      <title>ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ—ãƒ©ãƒ³ã®ç­–å®š</title>
      <para>ç§»è¡Œæ™‚ã€ã‚‚ã—ãã¯ç§»è¡Œå¾Œã«ä½•ã‚‰ã‹ã®å•é¡Œã«ç›´é¢ã™ã‚‹ã“ã¨ã‚’æƒ³å®šã—ã¦ã€ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ—ãƒ©ãƒ³ (æ‰‹æˆ»ã‚Šã®ãŸã‚ã®æ‰‹é †) ã¨ç§»è¡Œã®æˆåŠŸåˆ¤æ–­åŸºæº–ã‚’ç­–å®šã—ã¦ãŠãã“ã¨ãŒé‡è¦ã§ã™ã€‚å…·ä½“çš„ã«ã¯ã€å‹•ä½œã•ã›ãªã‘ã‚Œã°ãªã‚‰ãªã„ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ä½•ã‹ã€å¾Œã‹ã‚‰ç§»è¡Œã—ã¦ã‚‚å•é¡Œã®ãªã„ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ä½•ã‹ã€ãã‚Œã‚‰ã§ãƒ†ã‚¹ãƒˆã—ã¦ãŠãã¹ãã“ã¨ã¯ä½•ã‹ã€ã©ã®ã‚ˆã†ã«ã—ã¦æ‰‹æˆ»ã‚Šã®è¢«å®³ã‚’æœ€å°é™ã«ã™ã‚‹ã®ã‹ã€å·»ãè¾¼ã‚€ã¹ããƒãƒ¼ãƒ ã¯ã©ã“ãªã®ã‹ã‚’äº‹å‰ã«æ±ºã‚ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</para>
    </important>
    <para>ç”¨é€”ã‚„ç¯„å›²ãªã©ãŒç’°å¢ƒã«ã‚ˆã£ã¦æ§˜ã€…ã«ç•°ãªã‚‹ã“ã¨ã‹ã‚‰ã€ç”»ä¸€çš„ãªç§»è¡Œãƒ—ãƒ©ãƒ³ï¼æ‰‹æˆ»ã‚Šãƒ—ãƒ©ãƒ³ã‚’ç­–å®šã™ã‚‹ã“ã¨ã¯é›£ã—ã„ãƒ¢ãƒã§ã™ã€‚ã¾ãšã¯ç§»è¡Œå‡¦ç†ã‚’ãŠãŠã¾ã‹ã«ãƒ†ã‚¹ãƒˆã—ã¦ã¿ã¦ã€ãã“ã‹ã‚‰å°‘ã—ãšã¤å•é¡Œç‚¹ã‚’æ´—ã„å‡ºã—ã¦ã„ãã®ãŒã‚ˆã„ã§ã—ã‚‡ã†ã€‚ã¾ãŸã€ä¸‹è¨˜ã®ã‚ˆã†ãªä¸€èˆ¬çš„ãªæ‰‹æ³•ã‚‚å½¹ã«ç«‹ã¤ã¯ãšã§ã™:</para>
    <itemizedlist>
      <listitem>
        <para>ãƒ›ã‚¹ãƒˆåã‚„ DNS ã® TTL ã‚’ã€ä¸€èˆ¬çš„ãª 48 æ™‚é–“ã‹ã‚‰ 5 åˆ†ã«çŸ­ç¸®ã—ã¦ãŠãã“ã¨ã§ã€æ‰‹æˆ»ã‚Šã‚’ç´ æ—©ãå®Ÿæ–½ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</para>
      </listitem>
      <listitem>
        <para>å…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿åŒæœŸã‚„å—ä¿¡ãƒ‡ãƒ¼ã‚¿å‡¦ç†ã‚’ä¸€æ™‚çš„ã«åœæ­¢ã—ã¦ã‚‚ã‹ã¾ã„ã¾ã›ã‚“ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ç§»è¡Œæ™‚ã« OpenLDAP ç’°å¢ƒãŒå¤‰åŒ–ã—ãªããªã‚Šã¾ã™ã€‚</para>
      </listitem>
      <listitem>
        <para>ç§»è¡Œå‰ã« &ds389; ã®ãƒ›ã‚¹ãƒˆã‚’ã‚ˆãç¢ºèªã—ã¦ãŠãã“ã¨ã‚‚é‡è¦ã§ã™ã€‚</para>
      </listitem>
      <listitem>
        <para>ãƒ†ã‚¹ãƒˆç§»è¡Œæ™‚ã«ç™ºç”Ÿã—ãŸç´°ã‹ã„å•é¡Œãªã©ã‚’è©³ã—ãè¨˜éŒ²ã—ã¦ãŠãã“ã¨ã‚‚é‡è¦ã§ã™ã€‚</para>
      </listitem>
    </itemizedlist>
  </sect2>

  <sect2 xml:id="sec-security-ldap-migrate-saslauthd">
    <title>Testing migration of OpenLDAP servers that use <literal>saslauthd</literal></title>
    <para>
      In OpenLDAP deployments, it is common to use <literal>saslauthd</literal>
      for passthrough authentication of users. The authentication process
      involves the following components:
    </para>
<screen>
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚                 â”‚
 â”‚   LDAP client   â”‚
 â”‚                 â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
      binds to
          â”‚
          â–¼
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚    OpenLDAP     â”‚
 â”‚     server      â”‚
 â”‚                 â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚
          â–¼
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚                 â”‚
 â”‚    saslauthd    â”‚
 â”‚                 â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚
          â–¼
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚                 â”‚
 â”‚  External auth  â”‚
 â”‚                 â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</screen>
    <para>
      For checking the correctness of configuration and subsequent
      troubleshooting, the following information is important:
    </para>
    <itemizedlist>
      <listitem>
        <para>
          OpenLDAP discovers that a user is allowed passthrough authentication
          if the <literal>userPassword</literal> attribute has a value with the
          <literal>userPassword:
          {SASL}<replaceable>USERNAME@REALM</replaceable></literal> format. The
          prerequisite is to build the OpenLDAP server with the
          <literal>--enable-spasswd</literal> option to enable passthrough
          authentication.
        </para>
      </listitem>
      <listitem>
        <para>
          OpenLDAP configures its connection to <literal>saslauthd</literal>
          from <filename>/usr/lib/sasl2/slapd.conf</filename>.
        </para>
      </listitem>
      <listitem>
        <para>
          <literal>saslauthd</literal> discovers the relevant modules using its
          command-line parameters configured in
          <literal>/etc/sysconfig/saslauthd</literal>.
        </para>
      </listitem>
      <listitem>
        <para>
          The backend modules of <literal>saslauthd</literal> use their own
          configuration, as documented in <command>man saslauthd</command>.
        </para>
      </listitem>
    </itemizedlist>
    <para>
      Detailed information about passthrough authentication using OpenLDAP is
      available in the official
      <link xlink:href="https://openldap.org/doc/admin24/security.html#Pass-Through%20authentication">OpenLDAP
      Admin Guide</link>.
    </para>
    <sect3 xml:id="sec-security-ldap-migrate-saslauthd-procedure">
      <title>Migrating SASL passthrough authentication from OpenLDAP to &ds389;</title>
      <para>
        As a best practice for correctly migrating SASL passthrough
        authentication from OpenLDAP to &ds389; refer to the following steps:
      </para>
      <procedure>
        <step>
          <para>
            Before migration, ensure that you can successfully run
            <command>testsaslauthd</command> on the OpenLDAP server.
          </para>
<screen>&prompt.sudo;<command>openldap_to_ds <replaceable>LDAP1</replaceable></command>\
<command>/root/slapd.d <replaceable>/root/LDAP1-COM</replaceable>.ldif.ldif</command></screen>
          <para>
            The realm routes the authentication to the correct backend in
            <literal>saslauthd</literal>, and the user name is then used to
            check the identity.
          </para>
        </step>
        <step>
          <para>
            Install the <package>pam_saslauthd</package> package that enables
            &ds389; to connect with <literal>saslauthd</literal>.
          </para>
<screen>&prompt.sudo;<command>slaptest -f /etc/openldap/slapd.conf -F /root/slapd.d</command>
     </screen>
        </step>
        <step>
          <para>
            Migrate from OpenLDAP to &ds389; by running the
            <command>openldap_to_ds</command> command-line tool. For detailed
            information on the migration process, refer to the section
            <xref linkend="sec-security-ldap-migrate-test"/>.
          </para>
          <note>
            <para>
              While the <command>openldap_to_ds</command> process is running,
              if a user is detected as having the value of the
              <literal>userPssword</literal> attribute in the
              <literal>userPassword:
              {SASL}<replaceable>USERNAME@REALM</replaceable></literal> format,
              it is removed and placed as the value of the
              <literal>nsSaslauthId</literal> attribute in the
              <literal>nsSaslauthId:
              <replaceable>USERNAME@REALM</replaceable></literal> format.
              Additionally, the attribute value <literal>objectClass:
              nsSaslauthAccount</literal> is automatically added to support the
              modification.
            </para>
          </note>
        </step>
        <step>
          <para>
            After completion of the migration, check whether the PAM
            passthrough authentication is configured correctly by running the
            following commands:
          </para>
<screen>&prompt.sudo;<command>dsconf <replaceable>INSTANCE</replaceable> plugin pam-passthrough-auth show</command></screen>
<screen>&prompt.sudo;<command>dsconf <replaceable>INSTANCE</replaceable> plugin pam-passthrough-auth list</command></screen>
        </step>
      </procedure>
      <para>
        After successful migration, the passthrough authentication flow
        involves the following components:
      </para>
<screen>
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                 â”‚
  â”‚   LDAP client   â”‚
  â”‚                 â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
       binds to
           â”‚
           â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚     389-DS      â”‚
  â”‚     server      â”‚
  â”‚                 â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                 â”‚
  â”‚  pam saslauthd  â”‚
  â”‚                 â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                 â”‚
  â”‚    saslauthd    â”‚
  â”‚                 â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚
           â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                 â”‚
  â”‚  External auth  â”‚
  â”‚                 â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

</screen>
    </sect3>
    <sect3 xml:id="sec-security-ldap-troubleshoot-saslauthd">
      <title>Troubleshooting <literal>saslauthd</literal> passthrough authentication</title>
      <para>
        To troubleshoot problems with <literal>saslauthd</literal> passthrough
        authentication before and after the migration from OpenLDAP to &ds389;,
        refer to the following tips:
      </para>
      <variablelist>
        <varlistentry>
          <term>Ensure that <command>testsaslauthd</command> works with <replaceable>USERNAME@REALM</replaceable>.</term>
          <listitem>
            <para>
              Refer to the step for running <command>testsaslauthd</command> in
              the
              <xref linkend="sec-security-ldap-migrate-saslauthd"/>
              section.
            </para>
            <para>
              In case of problems, try the following:
            </para>
            <itemizedlist>
              <listitem>
                <para>
                  Check <filename>/etc/sysconfig/saslauthd</filename> to ensure
                  the <literal>saslauthd</literal> backend modules are
                  configured correctly. For detailed information on the backend
                  modules of <literal>saslauthd</literal> and their
                  configurations, run <command>man saslauthd</command>.
                </para>
              </listitem>
              <listitem>
                <para>
                  Turn on debug logging by adding
                  <literal>SASLAUTHD_PARAMS="-d"</literal> in
                  <filename>/etc/sysconfig/saslauthd</filename>.
                </para>
              </listitem>
              <listitem>
                <para>
                  View the <literal>saslauthd</literal> logs that are available
                  as part of the output of <command>journalctl</command>.
                </para>
              </listitem>
            </itemizedlist>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>Ensure that PAM <literal>saslauthd</literal> works correctly.</term>
          <listitem>
            <para>
              To check if PAM <literal>saslauthd</literal> works correctly, you
              can use the <command>pam_tester</command> tool available at
              <link xlink:href="https://github.com/kanidm/pam_tester"/>.
            </para>
            <note>
              <para>
                The <command>pam_tester</command> tool is NOT officially
                supported.
              </para>
            </note>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>Ensure that the PAM Pass Through Auth plugin is enabled.</term>
          <listitem>
            <para>
              Check the status of the PAM Pass Through Auth plugin by running
              the following command:
            </para>
<screen>&prompt.sudo;<command>dsconf <replaceable>INSTANCE</replaceable> plugin pam-passthrough-auth status</command></screen>
            <para>
              To enable the plugin, run the following command:
            </para>
<screen>&prompt.sudo;<command>dsconf <replaceable>INSTANCE</replaceable> plugin pam-passthrough-auth enable</command></screen>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>Check the configuration of the PAM Pass Through Auth plugin.</term>
          <listitem>
            <para>
              To check the configuration of the PAM Pass Through Auth plugin
              for the server instance, run the following command:
            </para>
<screen>&prompt.sudo;<command>dsconf <replaceable>INSTANCE</replaceable> plugin pam-passthrough-auth show</command></screen>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>Check the error logs for the user of the server instance.</term>
          <listitem>
            <para>
              Check the logs available in
              <filename>/var/lib/<replaceable>SERVER_USER_NAME</replaceable>/<replaceable>INSTANCE</replaceable>/error</filename>.
            </para>
          </listitem>
        </varlistentry>
      </variablelist>
    </sect3>
  </sect2>

  <sect2 xml:id="sec-security-ldap-migrate-plan">
    <title>ç§»è¡Œã®è¨ˆç”»</title>
    <para>OpenLDAP ã¯ <quote>æ§˜ã€…ãªéƒ¨å“ã‹ã‚‰æ§‹æˆã•ã‚Œã‚‹ã‚½ãƒ•ãƒˆã‚¦ã‚¨ã‚¢ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸</quote> ã§ã‚ã‚Šã€æ§˜ã€…ãªã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã‚’å®Ÿæ–½ã§ãã‚‹ã“ã¨ã‹ã‚‰ã€ <quote>ç”»ä¸€çš„ãªæ‰‹é †</quote> ã§ç§»è¡ŒãŒã§ãã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã¾ãšã¯ OpenLDAP ã®ç’°å¢ƒã¨è¨­å®šã€ãã—ã¦ä½¿ç”¨ç¯„å›²ã‚’ã‚ˆãèª¿æŸ»ã—ã¦ãã ã•ã„ã€‚èª¿æŸ»ã®å¯¾è±¡ã¨ã—ã¦ã¯ã€ä¸‹è¨˜ã®ã‚ˆã†ãªã‚‚ã®ãŒã‚ã‚Šã¾ã™ (ä¸‹è¨˜ã ã‘ã§ã‚ã‚‹ã¨ã‚‚é™ã‚Šã¾ã›ã‚“):</para>
    <itemizedlist>
      <listitem>
        <para>ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒˆãƒãƒ­ã‚¸</para>
      </listitem>
      <listitem>
        <para>é«˜å¯ç”¨æ€§ã¨è² è·åˆ†æ•£ã®è¨­å®š</para>
      </listitem>
      <listitem>
        <para>å¤–éƒ¨ã®ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ (ãƒ‡ãƒ¼ã‚¿ç®¡ç†, äººäº‹ç®¡ç†, Active Directory ãªã©)</para>
      </listitem>
      <listitem>
        <para>è¨­å®šæ¸ˆã¿ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ (&ds389; ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³)</para>
      </listitem>
      <listitem>
        <para>ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®è¨­å®šã¨ã‚µãƒ¼ãƒå´ã«æ±‚ã‚ã‚‰ã‚Œã‚‹æ©Ÿèƒ½</para>
      </listitem>
      <listitem>
        <para>ã‚¹ã‚­ãƒ¼ãƒã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå†…å®¹</para>
      </listitem>
      <listitem>
        <para>TLS ã®è¨­å®š</para>
      </listitem>
    </itemizedlist>
    <para>æœ€çµ‚çš„ã« &ds389; ã‚’ã©ã®ã‚ˆã†ã«é…ç½®ã™ã‚‹ã®ã‹ã«ã¤ã„ã¦ã‚‚ã€ã‚ˆãè¨ˆç”»ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã¯ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ç½®ãæ›ãˆã‚‹ã“ã¨ä»¥å¤–ã®ã€ã‚µãƒ¼ãƒã®é…ç½®ã‚„ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã«é–¢ã™ã‚‹å†…å®¹ã§ã™ã€‚ç¾åœ¨ã®ç’°å¢ƒã‚’ã‚ˆãèª¿æŸ»ã—ã€ &ds389; ã®é…ç½®è¨ˆç”»ã‚’ç«‹ã¦ãŸã‚‰ã€ã‚ã¨ã¯ç§»è¡Œãƒ—ãƒ©ãƒ³ã®ç­–å®šã«ãªã‚Šã¾ã™ã€‚ OpenLDAP ã®ç’°å¢ƒã¨ä¸¦è¡Œã—ã¦ &ds389; ã®ç’°å¢ƒã‚’å‹•ä½œã•ã›ã¦ã€ãŠäº’ã„ã«åˆ‡ã‚Šæ›¿ãˆã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã‚‚è‰¯ã„ã§ã—ã‚‡ã†ã€‚</para>
    <para>OpenLDAP ã‹ã‚‰ &ds389; ã¸ã®ç§»è¡Œã¯ä¸€æ–¹é€šè¡Œã§ã™ã€‚ç›¸äº’é‹ç”¨ã®æ„å‘³ã§ã‚‚ã“ã‚Œã‚‰ã®é–“ã«ã¯ååˆ†ãªå·®ç•°ãŒã‚ã‚Šã¾ã™ã—ã€é€†æ–¹å‘ (&ds389; ã‹ã‚‰ OpenLDAP ã¸) ã®ç§»è¡Œã¯æä¾›ã•ã‚Œã¦ã„ã¾ã›ã‚“ã®ã§ã€ã‚ˆãæ³¨æ„ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ä¸‹è¨˜ã«ã¯ã€æ§˜ã€…ãªé¡ä¼¼æ€§ã¨å·®ç•°ã®ä¸€è¦§ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚</para>
    <informaltable>
      <tgroup cols="4">
        <thead>
          <row>
            <entry>æ©Ÿèƒ½</entry>
            <entry>OpenLDAP</entry>
            <entry>&ds389;</entry>
            <entry>äº’æ›æ€§</entry>
          </row>
        </thead>
        <tbody>
          <row>
            <entry>åŒæ–¹å‘ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³</entry>
            <entry>SyncREPL</entry>
            <entry>&ds389a; å›ºæœ‰ã®ã‚·ã‚¹ãƒ†ãƒ </entry>
            <entry>ã„ã„ãˆ</entry>
          </row>
          <row>
            <entry>MemberOf</entry>
            <entry>ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤</entry>
            <entry>ãƒ—ãƒ©ã‚°ã‚¤ãƒ³</entry>
            <entry>ã¯ã„ (ã‚·ãƒ³ãƒ—ãƒ«ãªè¨­å®šã«ã®ã¿å¯¾å¿œ)</entry>
          </row>
          <row>
            <entry>å¤–éƒ¨èªè¨¼</entry>
            <entry>ãƒ—ãƒ­ã‚­ã‚·</entry>
            <entry>-</entry>
            <entry>ã„ã„ãˆ</entry>
          </row>
          <row>
            <entry>Active Directory ã¨ã®åŒæœŸ</entry>
            <entry>-</entry>
            <entry>Winsync ãƒ—ãƒ©ã‚°ã‚¤ãƒ³</entry>
            <entry>ã„ã„ãˆ</entry>
          </row>
          <row>
            <entry>å†…è”µã‚¹ã‚­ãƒ¼ãƒ</entry>
            <entry>OLDAP ã‚¹ã‚­ãƒ¼ãƒ</entry>
            <entry>389 ã‚¹ã‚­ãƒ¼ãƒ</entry>
            <entry>ã¯ã„ (ç§»è¡Œãƒ„ãƒ¼ãƒ«ã§å¯¾å¿œ)</entry>
          </row>
          <row>
            <entry>ç‹¬è‡ªã‚¹ã‚­ãƒ¼ãƒ</entry>
            <entry>OLDAP ã‚¹ã‚­ãƒ¼ãƒ</entry>
            <entry>389 ã‚¹ã‚­ãƒ¼ãƒ</entry>
            <entry>ã¯ã„ (ç§»è¡Œãƒ„ãƒ¼ãƒ«ã§å¯¾å¿œ)</entry>
          </row>
          <row>
            <entry>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®å–ã‚Šè¾¼ã¿</entry>
            <entry>LDIF</entry>
            <entry>LDIF</entry>
            <entry>ã¯ã„ (ç§»è¡Œãƒ„ãƒ¼ãƒ«ã§å¯¾å¿œ)</entry>
          </row>
          <row>
            <entry>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ãƒãƒƒã‚·ãƒ¥åŒ–</entry>
            <entry>å„ç¨®</entry>
            <entry>å„ç¨®</entry>
            <entry>ã¯ã„ (Argon2 ã‚’é™¤ãå…¨ã¦ã®å½¢å¼ã«å¯¾å¿œ)</entry>
          </row>
          <row>
            <entry>OpenLDAP ã¨ &ds389a; ã®ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³</entry>
            <entry>-</entry>
            <entry>-</entry>
            <entry>ã„ã„ãˆ (&ds389a; ã¨ã®åŒæœŸã¯ä¸å¯èƒ½)</entry>
          </row>
          <row>
            <entry>æ™‚é–“ãƒ™ãƒ¼ã‚¹ã®ãƒ¯ãƒ³ã‚¿ã‚¤ãƒ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ (TOTP)</entry>
            <entry>TOTP ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤</entry>
            <entry>-</entry>
            <entry>ã„ã„ãˆ (ç¾æ™‚ç‚¹ã§ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“)</entry>
          </row>
          <row>
            <entry>entryUUID</entry>
            <entry>OpenLDAP ã®ä¸€éƒ¨ã¨ã—ã¦æä¾›</entry>
            <entry>ãƒ—ãƒ©ã‚°ã‚¤ãƒ³</entry>
            <entry>ã¯ã„</entry>
          </row>
        </tbody>
      </tgroup>
    </informaltable>
  </sect2>
</sect1>
