<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 [
<!ENTITY % entities SYSTEM "entity-decl.ent">
%entities;
]>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0" xml:id="sec-security-ldap-migrate">
  
  <title>OpenLDAP ã‹ã‚‰ &ds389; ã¸ã®ç§»è¡Œ</title>
   <para>OpenLDAP ã¯ &sle;&nbsp; 15.3 ã«ã¦å»ƒæ­¢äºˆå®šã¨ãªã‚Šã‚µãƒãƒ¼ãƒˆå¯¾è±¡ã‹ã‚‰ã‚‚å¤–ã•ã‚Œã€ &ds389; ã«ç½®ãæ›ãˆã‚‰ã‚Œã¦ã„ã¾ã™ã€‚ &suse; ã§ã¯ã“ã®ç§»è¡Œä½œæ¥­ã‚’æ”¯æ´ã™ã‚‹ãŸã‚ã€ <package>&ds389;</package> ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å†…ã« <command>openldap_to_ds</command> ã¨ã„ã†ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚</para>
   <para><command>openldap_to_ds</command> ã¯ç§»è¡Œä½œæ¥­ã‚’ã§ãã‚‹é™ã‚Šè‡ªå‹•çš„ã«å®Ÿæ–½ã§ãã‚‹ã‚ˆã†è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ã€‚ã§ã™ãŒã€ãã‚Œãã‚Œã® LDAP ç’°å¢ƒã¯ç•°ãªã‚‹ã‚‚ã®ã§ã‚ã‚‹ã“ã¨ã‹ã‚‰ã€å…¨ã¦ã®ç’°å¢ƒã«é©åˆã™ã‚‹ãƒ„ãƒ¼ãƒ«ã‚’ä½œæˆã™ã‚‹ã®ã¯ä¸å¯èƒ½ã§ã™ã€‚ãã®ãŸã‚ã€ã„ãã¤ã‹ã®ä½œæ¥­ã«ã¤ã„ã¦ã¯æ‰‹ä½œæ¥­ã§å®Ÿæ–½ã™ã‚‹ã“ã¨ã«ãªã‚‹ã»ã‹ã€æœ¬ç•ªç’°å¢ƒã®ç§»è¡Œã«ã‚ãŸã£ã¦ã€ã‚ã‚‰ã‹ã˜ã‚ç§»è¡Œæ‰‹é †ã®ãƒ†ã‚¹ãƒˆã‚’è¡Œã†å¿…è¦ã‚‚ã‚ã‚Šã¾ã™ã€‚</para>
   
  <sect2 xml:id="sec-security-ldap-migrate-test">
  <title>OpenLDAP ã‹ã‚‰ã®ãƒ†ã‚¹ãƒˆç§»è¡Œ</title>
   <para>OpenLDAP ã¨ &ds389; ã¨ã®é–“ã«ã¯ãã‚Œãªã‚Šã®å·®ç•°ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã‹ã‚‰ã€ç§»è¡Œã‚’è¡Œã†ã«ã‚ãŸã£ã¦ã‚‚äº‹å‰ã®ãƒ†ã‚¹ãƒˆã¨èª¿æ•´ã‚’ç¹°ã‚Šè¿”ã—å®Ÿæ–½ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã§ã—ã‚‡ã†ã€‚ãã®ãŸã‚ã€æ‰‹æ—©ãç§»è¡Œãƒ†ã‚¹ãƒˆã‚’å®Ÿæ–½ã—ã¦ã€å¿…è¦ãªè¿½åŠ æ‰‹é †ã‚’ç´ æ—©ãæ´—ã„å‡ºã™ã“ã¨ãŒè‚å¿ƒã§ã™ã€‚</para>
   <para>ã‚ã‚‰ã‹ã˜ã‚ç”¨æ„ã—ã¦ãŠãã¹ãã‚‚ã®:</para>
   <itemizedlist>
    <listitem>
      <para>ä½•ã‚ˆã‚Šã‚‚ &ds389; ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®å‹•ä½œã™ã‚‹ãƒã‚·ãƒ³ãŒå¿…è¦ã§ã™ã€‚</para>
    </listitem>
    <listitem>
     <para>OpenLDAP <filename>slapd</filename> ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã€ã‚‚ã—ãã¯ ldif å½¢å¼ã«ã‚ˆã‚‹å‹•çš„ãªè¨­å®šãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã€‚</para>
    </listitem>
    <listitem>
     <para>OpenLDAP ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã® ldif å½¢å¼ã«ã‚ˆã‚‹ãƒ•ãƒ«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã€‚</para>
    </listitem>
   </itemizedlist>
   <para>slapd ã®è¨­å®šãŒå‹•çš„ãª ldif å½¢å¼ã§ã¯ãªã„å ´åˆã€ã¾ãšã¯ <command>slaptest</command> ã‚’åˆ©ç”¨ã—ã¦å‹•çš„ãªã‚³ãƒ”ãƒ¼ã‚’ä½œæˆã—ã¾ã™ã€‚ <filename>slapd.d</filename> ã¨ã„ã†ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã¦ã€ä¸‹è¨˜ã®ã‚ˆã†ãªã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™:</para>
   <screen>&prompt.sudo;slaptest -f /etc/openldap/slapd.conf -F /root/slapd.d
     </screen>
     <para>ä¸Šè¨˜ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ä¸‹è¨˜ã®ã‚ˆã†ãªãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã‚‹ã¯ãšã§ã™:</para>
     <screen>&prompt.sudo;ls  slapd.d/*
slapd.d/cn=config.ldif

slapd.d/cn=config:
cn=module{0}.ldif  cn=schema.ldif                 olcDatabase={0}config.ldif
cn=schema          olcDatabase={-1}frontend.ldif  olcDatabase={1}mdb.ldif
</screen>
   <para>ã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹ã”ã¨ã« 1 ã¤ã® ldif ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã¾ã™ã€‚ç§»è¡Œã®ä¾‹ã§ã¯ã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹ãŒ <replaceable>dc=ldap1,dc=com</replaceable> ã§ã‚ã‚‹ã‚‚ã®ã¨ã—ã¾ã™ã€‚ã¾ãŸã€ <filename>/etc/openldap/slapd.conf</filename> å½¢å¼ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã¯ã€ä¸‹è¨˜ã®ã‚ˆã†ãªã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ã€ ldif ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™:</para>
   <screen>&prompt.sudo;slapcat -f /etc/openldap/slapd.conf -b <replaceable>dc=ldap1,dc=com</replaceable> -l /root/<replaceable>ldap1-com</replaceable>.ldif
   </screen>
   <para><filename>/etc/openldap/slapd.d</filename> å½¢å¼ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã¯ã€ä¸‹è¨˜ã®ã‚ˆã†ãªã‚³ãƒãƒ³ãƒ‰ã«ãªã‚Šã¾ã™:</para>
   <screen>&prompt.sudo;slapcat -f /etc/openldap/slapd.conf -b <replaceable>dc=ldap1,dc=com</replaceable> -l /root/<replaceable>ldap1-com</replaceable>.ldif</screen>   
   <para>ã‚ã¨ã¯ <command>openldap_to_ds</command> ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚’åˆ©ç”¨ã—ã¦è¨­å®šã¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ†æã•ã›ã€ç§»è¡Œãƒ—ãƒ©ãƒ³ã‚’è¡¨ç¤ºã•ã›ã¾ã™ (ã“ã®æ™‚ç‚¹ã§ã¯ä½•ã‚‚å¤‰æ›´ã¯è¡Œã‚ã‚Œã¾ã›ã‚“):</para>
   <screen>&prompt.sudo;openldap_to_ds <replaceable>ldap1</replaceable> /root/slapd.d <replaceable>ldap1-com</replaceable>.ldif</screen>
   <para>å‰è¿°ã®ã¨ãŠã‚Šä¸Šè¨˜ã§ã¯ä½•ã‚‚å¤‰æ›´ã•ã‚Œã¾ã›ã‚“ãŒã€ä¸‹è¨˜ã®ã‚ˆã†ãªå‡ºåŠ›ãŒç¾ã‚Œã‚‹ã¯ãšã§ã™:</para>
   <screen>Examining OpenLDAP Configuration ...
Completed OpenLDAP Configuration Parsing.
Examining Ldifs ...
Completed Ldif Metadata Parsing.
The following migration steps will be performed:
 * Schema Skip Unsupported Attribute -&gt; otherMailbox (0.9.2342.19200300.100.1.22)
 * Schema Skip Unsupported Attribute -&gt; dSAQuality (0.9.2342.19200300.100.1.49)
 * Schema Skip Unsupported Attribute -&gt; singleLevelQuality (0.9.2342.19200300.100.1.50)
 * Schema Skip Unsupported Attribute -&gt; subtreeMinimumQuality (0.9.2342.19200300.100.1.51)
 * Schema Skip Unsupported Attribute -&gt; subtreeMaximumQuality (0.9.2342.19200300.100.1.52)
 * Schema Create Attribute -&gt; suseDefaultBase (SUSE.YaST.ModuleConfig.Attr:2)
 * Schema Create Attribute -&gt; suseNextUniqueId (SUSE.YaST.ModuleConfig.Attr:3)
[...]
 * Schema Create ObjectClass -&gt; suseDhcpConfiguration (SUSE.YaST.ModuleConfig.OC:10)
 * Schema Create ObjectClass -&gt; suseMailConfiguration (SUSE.YaST.ModuleConfig.OC:11)
 * Database Reindex -&gt; dc=example,dc=com
 * Database Import Ldif -&gt; dc=example,dc=com from example.ldif - excluding entry attributes = [{'structuralobjectclass', 'entrycsn'}]
No actions taken. To apply migration plan, use '--confirm'
</screen>
   <para>ã‚ã¨ã¯ä¸‹è¨˜ã®ã‚ˆã†ã«å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ã€å®Ÿéš›ã®ç§»è¡Œã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚å¤‰æ›´ã—ãªã„å ´åˆã¨ã¯å‡ºåŠ›ãŒç•°ãªã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„:</para>
   <screen>&prompt.sudo;openldap_to_ds <replaceable>ldap1</replaceable> /root/slapd.d <replaceable>ldap1-com</replaceable>.ldif --confirm
Starting Migration ... This may take some time ...
migration: 1 / 40 complete ...
migration: 2 / 40 complete ...
migration: 3 / 40 complete ...
[...]
Index task index_all_05252021_120216 completed successfully
post: 39 / 40 complete ...
post: 40 / 40 complete ...
ğŸ‰ Migration complete!
----------------------
You should now review your instance configuration and data:
 * [ ] - Create/Migrate Database Access Controls (ACI)
 * [ ] - Enable and Verify TLS (LDAPS) Operation
 * [ ] - Schedule Automatic Backups
 * [ ] - Verify Accounts Can Bind Correctly
 * [ ] - Review Schema Inconistent ObjectClass -&gt; pilotOrganization (0.9.2342.19200300.100.4.20)
 * [ ] - Review Database Imported Content is Correct -&gt; dc=ldap1,dc=com
</screen>
  
   <para>ç§»è¡ŒãŒå®Œäº†ã™ã‚‹ã¨ <command>openldap_to_ds</command> ã¯ã€å®Ÿæ–½ã—ã¦ãŠã‹ãªã‘ã‚Œã°ãªã‚‰ãªã„ç§»è¡Œå¾Œã®ãƒã‚§ãƒƒã‚¯ä½œæ¥­ã®ä¸€è¦§ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚ã“ã®ä½œæ¥­ã¯ã„ãšã‚Œã‚‚ç§»è¡Œã‚’æœ€é©ã«è¡Œã†ãŸã‚ã«å¿…è¦ãªæ‰‹é †ã§ã™ã®ã§ã€æœ¬ç•ªç’°å¢ƒã§ã‚‚åŒã˜ã‚ˆã†ã«ã—ã¦ãŠãã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚ã‚ã¨ã¯ãƒ†ã‚¹ãƒˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã€ç§»è¡Œå¾Œã® &ds389; ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«å‘ã‘ã¦ãƒ†ã‚¹ãƒˆã‚’è¡Œã£ã¦ãã ã•ã„ã€‚</para>
   <important>
     <title>ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ—ãƒ©ãƒ³ã®ç­–å®š</title>
     <para>ç§»è¡Œæ™‚ã€ã‚‚ã—ãã¯ç§»è¡Œå¾Œã«ä½•ã‚‰ã‹ã®å•é¡Œã«ç›´é¢ã™ã‚‹ã“ã¨ã‚’æƒ³å®šã—ã¦ã€ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ—ãƒ©ãƒ³ (æ‰‹æˆ»ã‚Šã®ãŸã‚ã®æ‰‹é †) ã¨ç§»è¡Œã®æˆåŠŸåˆ¤æ–­åŸºæº–ã‚’ç­–å®šã—ã¦ãŠãã“ã¨ãŒé‡è¦ã§ã™ã€‚å…·ä½“çš„ã«ã¯ã€å‹•ä½œã•ã›ãªã‘ã‚Œã°ãªã‚‰ãªã„ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ä½•ã‹ã€å¾Œã‹ã‚‰ç§»è¡Œã—ã¦ã‚‚å•é¡Œã®ãªã„ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ä½•ã‹ã€ãã‚Œã‚‰ã§ãƒ†ã‚¹ãƒˆã—ã¦ãŠãã¹ãã“ã¨ã¯ä½•ã‹ã€ã©ã®ã‚ˆã†ã«ã—ã¦æ‰‹æˆ»ã‚Šã®è¢«å®³ã‚’æœ€å°é™ã«ã™ã‚‹ã®ã‹ã€å·»ãè¾¼ã‚€ã¹ããƒãƒ¼ãƒ ã¯ã©ã“ãªã®ã‹ã‚’äº‹å‰ã«æ±ºã‚ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</para>
   </important>
   <para>ç”¨é€”ã‚„ç¯„å›²ãªã©ãŒç’°å¢ƒã«ã‚ˆã£ã¦æ§˜ã€…ã«ç•°ãªã‚‹ã“ã¨ã‹ã‚‰ã€ç”»ä¸€çš„ãªç§»è¡Œãƒ—ãƒ©ãƒ³ï¼æ‰‹æˆ»ã‚Šãƒ—ãƒ©ãƒ³ã‚’ç­–å®šã™ã‚‹ã“ã¨ã¯é›£ã—ã„ãƒ¢ãƒã§ã™ã€‚ã¾ãšã¯ç§»è¡Œå‡¦ç†ã‚’ãŠãŠã¾ã‹ã«ãƒ†ã‚¹ãƒˆã—ã¦ã¿ã¦ã€ãã“ã‹ã‚‰å°‘ã—ãšã¤å•é¡Œç‚¹ã‚’æ´—ã„å‡ºã—ã¦ã„ãã®ãŒã‚ˆã„ã§ã—ã‚‡ã†ã€‚ã¾ãŸã€ä¸‹è¨˜ã®ã‚ˆã†ãªä¸€èˆ¬çš„ãªæ‰‹æ³•ã‚‚å½¹ã«ç«‹ã¤ã¯ãšã§ã™ã€‚</para>
   <itemizedlist>
    <listitem>
      <para>ãƒ›ã‚¹ãƒˆåã‚„ DNS ã® TTL ã‚’ã€ä¸€èˆ¬çš„ãª 48 æ™‚é–“ã‹ã‚‰ 5 åˆ†ã«çŸ­ç¸®ã—ã¦ãŠãã“ã¨ã§ã€æ‰‹æˆ»ã‚Šã‚’ç´ æ—©ãå®Ÿæ–½ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</para>
    </listitem>
    <listitem>
      <para>å…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿åŒæœŸã‚„å—ä¿¡ãƒ‡ãƒ¼ã‚¿å‡¦ç†ã‚’ä¸€æ™‚çš„ã«åœæ­¢ã—ã¦ã‚‚ã‹ã¾ã„ã¾ã›ã‚“ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ç§»è¡Œæ™‚ã« OpenLDAP ç’°å¢ƒãŒå¤‰åŒ–ã—ãªããªã‚Šã¾ã™ã€‚</para>
    </listitem>
    <listitem>
      <para>ç§»è¡Œå‰ã« &ds389; ã®ãƒ›ã‚¹ãƒˆã‚’ã‚ˆãç¢ºèªã—ã¦ãŠãã“ã¨ã‚‚é‡è¦ã§ã™ã€‚</para>
    </listitem>
    <listitem>
      <para>ãƒ†ã‚¹ãƒˆç§»è¡Œæ™‚ã«ç™ºç”Ÿã—ãŸç´°ã‹ã„å•é¡Œãªã©ã‚’è©³ã—ãè¨˜éŒ²ã—ã¦ãŠãã“ã¨ã‚‚é‡è¦ã§ã™ã€‚</para>
    </listitem> 
   </itemizedlist>    
  </sect2>     
 <sect2 xml:id="sec-security-ldap-migrate-plan">
  <title>Planning your migration</title>
  <para>
   As OpenLDAP is a "box of parts" and highly customisable, it is not possible
   to prescribe a one size fits all migration. It is necessary to assess your
   current environment and configuration with OpenLDAP and other integrations.
   This includes, and is not limited to:
  </para>
  <itemizedlist>
   <listitem>
    <para>
     Replication topology.
    </para>
   </listitem>
   <listitem>
    <para>
     High availability and load balancer configurations.
    </para>
   </listitem>
   <listitem>
    <para>
     External data flows (IGA, HR, AD, etc.).
    </para>
   </listitem>
   <listitem>
    <para>
     Configured overlays (plugins in &ds389;).
    </para>
   </listitem>
   <listitem>
    <para>
     Client configuration and expected server features.
    </para>
   </listitem>
   <listitem>
    <para>
     Customized schema.
    </para>
   </listitem>
   <listitem>
    <para>
     TLS configuration.
    </para>
   </listitem>
  </itemizedlist>
  <para>
   Plan what your &ds389; deployment will look like in the end. This includes
   the same list, except replace overlays with plugins. Once you have assessed
   your current environment, and planned what your &ds389; environment will
   look like, you can then form a migration plan. It is recommended you build
   the &ds389; environment in parallel to your OpenLDAP environment to allow
   you to switch between them.
  </para>
  <para>
   Migrating from OpenLDAP to &ds389; is a one-way migration. There are enough
   differences between the two that they cannot interoperate, and there is not
   a migration path from &ds389; to OpenLDAP. The following table highlights
   the major similarities and differences.
  </para>
  <informaltable>
   <tgroup cols="4">
    <thead>
     <row>
      <entry>Feature</entry>
      <entry>OpenLDAP</entry>
      <entry>&ds389;</entry>
      <entry>Compatible</entry>
     </row>
    </thead>
    <tbody>
     <row>
      <entry>Two-way replication</entry>
      <entry>SyncREPL</entry>
      <entry>389-specific system</entry>
      <entry>No</entry>
     </row>
     <row>
      <entry>MemberOf</entry>
      <entry>Overlay</entry>
      <entry>Plugin</entry>
      <entry>Yes, simple configs only</entry>
     </row>
     <row>
      <entry>External Auth</entry>
      <entry>Proxy</entry>
      <entry>-</entry>
      <entry>No</entry>
     </row>
     <row>
      <entry>Active Directory Synchronisation</entry>
      <entry>-</entry>
      <entry>Winsync Plugin</entry>
      <entry>No</entry>
     </row>
     <row>
      <entry>Inbuilt Schema</entry>
      <entry>OLDAP Schemas</entry>
      <entry>389 Schemas</entry>
      <entry>Yes, supported by migration tool</entry>
     </row>
     <row>
      <entry>Custom Schema</entry>
      <entry>OLDAP Schemas</entry>
      <entry>389 Schemas</entry>
      <entry>Yes, supported by migration tool</entry>
     </row>
     <row>
      <entry>Database Import</entry>
      <entry>LDIF</entry>
      <entry>LDIF</entry>
      <entry>Yes, supported by migration tool</entry>
     </row>
     <row>
      <entry>Password hashes</entry>
      <entry>Varies</entry>
      <entry>Varies</entry>
      <entry>Yes, all formats supported excluding Argon2</entry>
     </row>
     <row>
      <entry>OpenLDAP to &ds389; replication</entry>
      <entry>-</entry>
      <entry>-</entry>
      <entry>No mechanism to replicate to 389 is possible</entry>
     </row>
     <row>
      <entry>Time-based one-time password(TOTP)</entry>
      <entry>TOTP overlay</entry>
      <entry>-</entry>
      <entry>No, may be supported in the future</entry>
     </row>
     <row>
      <entry>EntryUUID</entry>
      <entry>Part of OpenLDAP</entry>
      <entry>Plugin</entry>
      <entry>Yes</entry>
     </row>
    </tbody>
   </tgroup>
  </informaltable>
 </sect2>
</sect1>
