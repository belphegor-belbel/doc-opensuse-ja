<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 [
<!ENTITY % entities SYSTEM "entity-decl.ent">
%entities;
]>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0" xml:id="sec-security-ldap-server-users">
  
 <title>LDAP でのユーザとグループの管理</title>

 <para>ユーザとグループは <command>dsidm</command> コマンドで作成および管理を行います。</para>

 <para>下記ではインスタンス名が <replaceable>LDAP1</replaceable> である場合の例を示しています。お使いのインスタンス名に置き換えて実行してください。</para>

 <para>現時点で設定済みのユーザとグループの一覧を表示するには、下記のように入力して実行します:</para>

<screen>&prompt.sudo;<command>dsidm <replaceable>LDAP1</replaceable> user list</command>
&prompt.sudo;<command>dsidm <replaceable>LDAP1</replaceable> group list</command></screen>

 <para>特定のユーザに対する全ての情報を表示させるには、下記のように入力して実行します:</para>

<screen>&prompt.sudo;<command>dsidm <replaceable>LDAP1</replaceable> user get <replaceable>ユーザ名</replaceable></command></screen>

 <para>特定のグループに対する全ての情報を表示させるには、下記のように入力して実行します:</para>

<screen>&prompt.sudo;<command>dsidm <replaceable>LDAP1</replaceable> group get <replaceable>グループ名</replaceable></command></screen>

 <para>グループのメンバー一覧を表示するには、下記のように入力して実行します:</para>

<screen>&prompt.sudo;<command>dsidm <replaceable>LDAP1</replaceable> group members <replaceable>グループ名</replaceable></command></screen>

 <para>下記の例では 2 人のユーザ &exampleuserII; と &exampleuserIII; を作成します。このとき、必要なデータはコマンドラインパラメータで指定し、サーバインスタンスは <literal>LDAP1</literal> 、サフィックスは dc= <replaceable>LDAP1</replaceable> ,dc= <replaceable>COM</replaceable> であるものとします。</para>

 <procedure xml:id="pro-security-ldap-server-users">
  <title>LDAP ユーザの作成</title>
  <para>下記の例では、 &ds389a; インスタンス内にユーザ &exampleuserIIfull; を作成しています:</para>
  <step>
<screen>&prompt.sudo;<command>dsidm <replaceable>LDAP1</replaceable> user create --uid &exampleuserII_plain; \</command>
  <command>--cn &exampleuserII_plain; --displayName '&exampleuserIIfull;' --uidNumber 1001 --gidNumber 101 \</command>
 <command> --homeDirectory /home/&exampleuserII_plain;</command></screen>
  </step>
  <step>
   <para>ユーザの <literal>distinguished name</literal> (DN) 名 (ディレクトリオブジェクトに対する完全修飾名、つまり唯一性の保証された名前) を参照するには、下記のように入力して実行します:</para>
<screen>&prompt.sudo;<command>dsidm <replaceable>LDAP1</replaceable> user get &exampleuserII_plain;</command>
dn: uid=&exampleuserII_plain;,ou=people,dc=<replaceable>LDAP1</replaceable>,dc=<replaceable>COM</replaceable>
[...]</screen>
   <para>ユーザのパスワード変更などの処理を行うには、 <literal>distinguished name</literal> (DN) を指定する必要があります。</para>
  </step>
  <step>
   <para>&exampleuserII; ユーザに対するパスワードを作成するには、下記のように入力して実行します:</para>
   <substeps>
    <step>
<screen>&prompt.sudo;<command>dsidm <replaceable>LDAP1</replaceable> account reset_password \</command>
  <command>uid=&exampleuserII_plain;,ou=people,dc=<replaceable>LDAP1</replaceable>,dc=<replaceable>COM</replaceable></command></screen>
    </step>
    <step>
     <para>あとは &exampleuserII; に設定するパスワードを 2 回入力します。</para>
     <para>パスワードの設定が完了すると、下記のようなメッセージが表示されるはずです:</para>
<screen>
reset password for uid=&exampleuserII_plain;,ou=people,dc=<replaceable>LDAP1</replaceable>,dc=<replaceable>COM</replaceable>
</screen>
     <para>設定済みのパスワードを変更したい場合も、同じコマンドで行うことができます。</para>
    </step>
   </substeps>
  </step>
  <step>
   <para>認証が正しく動作することを確認します:</para>
<screen>
&prompt.user;<command>ldapwhoami -D uid=&exampleuserII_plain;,ou=people,dc=<replaceable>LDAP1</replaceable>,dc=<replaceable>COM</replaceable> -W</command>
Enter LDAP Password: <replaceable>PASSWORD</replaceable>
dn: uid=&exampleuserII_plain;,ou=people,dc=<replaceable>LDAP1</replaceable>,dc=<replaceable>COM</replaceable>
     </screen>
  </step>
 </procedure>

 <para>最後に &exampleuserII; ユーザを削除します:</para>

<screen>&prompt.sudo;<command>dsidm <replaceable>LDAP1</replaceable> user delete</command>
   Enter dn to delete : uid=wilber,ou=people,dc=<replaceable>LDAP1</replaceable>,dc=<replaceable>COM</replaceable>
   Deleting nsUserAccount uid=wilber,ou=people,dc=<replaceable>LDAP1</replaceable>,dc=<replaceable>COM</replaceable> :
   Type 'Yes I am sure' to continue: <command>Yes I am sure</command>
   Successfully deleted uid=wilber,ou=people,dc=<replaceable>LDAP1</replaceable>,dc=<replaceable>COM</replaceable></screen>

 <procedure xml:id="pro-security-ldap-server-groups">
  <title>LDAP グループの作成とユーザの割り当て</title>
  <para>下記の手順では <replaceable>server_admins</replaceable> という名前のグループを作成し、そのグループに &exampleuserII; ユーザを所属させます。このとき、インスタンス名は <literal>LDAP1</literal> 、サフィックスは dc= <replaceable>LDAP1</replaceable> ,dc= <replaceable>COM</replaceable> であるものとします。</para>
  <step>
   <para>まずはグループを作成します:</para>
<screen>&prompt.sudo;<command>dsidm <replaceable>LDAP1</replaceable> group create</command></screen>
   <para>すると、グループ名の入力を求められます。たとえば <replaceable>SERVER_ADMINS</replaceable> というグループを作成するには、下記のように入力します:</para>
<screen>Enter value for cn : <replaceable>SERVER_ADMINS</replaceable></screen>
  </step>
  <step>
   <para>&exampleuserII; ユーザをグループに追加します:</para>
<screen>
&prompt.sudo;<command>dsidm <replaceable>LDAP1</replaceable> group add_member <replaceable>SERVER_ADMINS</replaceable></command> \
<command>uid=&exampleuserII_plain;,ou=people,dc=<replaceable>LDAP1</replaceable>,dc=<replaceable>COM</replaceable></command>
added member: uid=&exampleuserII_plain;,ou=people,dc=<replaceable>LDAP1</replaceable>,dc=<replaceable>COM</replaceable></screen>
  </step>
 </procedure>
</sect1>
