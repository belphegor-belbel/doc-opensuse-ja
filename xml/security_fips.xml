<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 [
<!ENTITY % entities SYSTEM "entity-decl.ent">
%entities;
]>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0" xml:id="cha-security-fips">
 <title>FIPS 140-2 の有効化</title>
 <info>
  <abstract>
   <para>
     If your organization does any work for the United States federal
     government, it is likely that your cryptography applications (such
     as openSSL, GnuTLS, and OpenJDK) will be required to be in
     compliance with Federal Information Processing Standards (FIPS)
     140-2. FIPS 140-2 is a security accreditation program for validating  
     cryptographic modules produced by private companies. If your 
     organization is not required by compliance rules to run &sle; in
     FIPS mode, it is most likely best to not do it. This chapter 
     provides guidance on enabling FIPS mode, and links to resources with 
     detailed information.
   </para>
  </abstract>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>
 
<sect1 xml:id="sec-fips-concept">
  <title>FIPS 140-2 overview</title>
  
  <warning>
    <title>FIPS requires expertise</title>
    <para>
      Administering FIPS is complex and requires significant expertise.
      Implementing it correctly, testing, and troubleshooting all require
      a high degree of knowledge.
    </para>
  </warning>
  
  <para>
    Every vendor that develops and maintains cryptographic applications, and 
    wants them to be tested for FIPS compliance, must submit them to the 
    Cryptographic Module Validation Program (CMVP) (see
    <link xlink:href="https://csrc.nist.gov/projects/cryptographic-module-validation-program"/>).
  </para>
  <para>
    There are currently two FIPS cryptographic standards, FIPS 140-2 and FIPS 
    140-3. The FIPS 140-2 standard was finalized in 2002, and is valid until 
    September 22, 2026. The FIPS 140-3 standard was approved in March 2019, 
    and is replacing 140-2. CMVP is no longer accepting modules for 
    FIPS 140-2 testing, but only FIPS 140-3.
  </para>
  <para>
    &suse; maintains a list of certified modules at 
    <link xlink:href="https://www.suse.com/support/security/certifications/"/>, along with a lot of other useful information.
  </para>
</sect1>

<sect1 xml:id="sec-fips-use-case">
  <title>When to enable FIPS mode</title>
  <para>
    The use case for enabling FIPS mode on &sle; is simple: run your    
    server in FIPS mode it when it is required to meet compliance rules. 
  </para>
  <para>
     When you are not required to meet compliance rules, running your systems 
     in FIPS mode is most likely not a good idea. These are some of the reasons to not use FIPS mode:
  </para>
  <itemizedlist>
    <listitem>
      <para>
        FIPS is restrictive. It enforces the use of specific validated 
        cryptographic algorithms, and specific certified binaries that 
        implement these validated algorithms. You must use only the certified 
        binaries.
      </para>
    </listitem>
    <listitem>
      <para>
        Upgrades may break functionality.        
      </para>
    </listitem>
    <listitem>
      <para>
         The approval process is very long, so certified binaries are always
         several releases behind the newest release.
      </para>
    </listitem>
    <listitem>
      <para>
        Certified binaries, such as ssh, sshd, and sftp-server, run their own
        self-checks at startup, and run only when these checks succeed. 
        This creates some small performance degradation.
      </para>
    </listitem>    
    <listitem>
      <para>
        Administering FIPS is complex and requires significant expertise.
      </para>
    </listitem>
  </itemizedlist>
</sect1>
 
<sect1 xml:id="sec-fips-install">
  <title>FIPS のインストール</title>
  <para>&sle; を新規にインストールしている場合は、 <package>patterns-server-enterprise-fips</package> という名称のパターンを選択してください。インストールが完了したあとは、 <xref linkend="sec-fips-enable"/> に示された手順に従って、 FIPS を有効化してください。</para>
  <para>
    You may install <package>patterns-server-enterprise-fips</package>
    and enable FIPS mode on a running system, but then it is likely you will 
    have to make adjustments, such as regenerating keys, and auditing your 
    setup to ensure it is set up correctly.
  </para>
</sect1>    
    
<sect1 xml:id="sec-fips-enable">
  <title>FIPS の有効化</title>

<!-- The file paths for the two READMEs are different than in earlier 
  releases. In SLE 15 SP2 and older the path is /usr/share/doc/packages/openssh/
  cschroder Jan 13, 2022 -->  
<para>FIPS の有効化を行うには、いくつかの作業が必要となります。まずは <package>openssh-common</package> パッケージに含まれる <filename>/usr/share/doc/packages/openssh-common/README.FIPS</filename> と <filename>/usr/share/doc/packages/openssh-common/README.SUSE</filename> のファイルをお読みください (いずれも英語) 。これらのファイルには、 &sle; における FIPS の重要な情報が書かれています。</para>
  <para>FIPS が既に有効化されているかどうかを確認するには、下記のように実行します:</para>
  <screen>&prompt.sudo;<command>sysctl -a | grep fips</command>
crypto.fips_enabled = 0</screen>
  <para><literal>crypto.fips_enabled = 0</literal> が出力された場合、 FIPS は有効化されていません。有効化されていれば 1 になるはずです。</para>  
  <para>その後 <filename>/etc/default/grub</filename> ファイルを編集します。 <filename>/boot</filename> が個別のパーティションに存在していない場合であれば、 <literal>GRUB_CMDLINE_LINUX_DEFAULT</literal> に <literal>fips=1</literal> を追加します・たとえば下記のようになります:</para>
  <screen>GRUB_CMDLINE_LINUX_DEFAULT="splash=silent mitigations=auto quiet fips=1"</screen>
  <para><filename>/boot</filename> が個別のパーティションとして存在する場合は、下記のようにしてそのパーティションを指定します。下記の例のうち、デバイス名をお使いの環境に合わせて指定してください:</para>
  <screen>GRUB_CMDLINE_LINUX_DEFAULT="splash=silent mitigations=auto quiet fips=1 boot=<replaceable>/dev/sda1"</replaceable></screen>
  <para>あとは設定を保存して、 GRUB の設定と initramfs イメージを再構築します (<replaceable>名前</replaceable> には現在の initrd ファイルの名前を、 <replaceable>カーネルバージョン</replaceable> には現在実行しているカーネルのバージョンをそれぞれ入力します):</para>
  <screen>&prompt.sudo;<command>grub2-mkconfig -o /boot/grub2/grub.cfg</command>
&prompt.sudo;<command>/usr/bin/dracut --logfile /var/log/YaST2/mkinitrd.log --force /boot/$initrd-<replaceable>名前</replaceable> $<replaceable>カーネルバージョン</replaceable></command></screen>
  <para>あとはシステムを再起動するだけです。再起動後に再度確認を行うと、下記のように FIPS が有効化されているはずです:</para>
<screen>&prompt.sudo;<command>sysctl -a | grep fips</command>
crypto.fips_enabled = 1</screen>
  <para>FIPS を有効化すると、システムがうまく起動しなくなってしまうことがあります。このような場合は、再起動時に GRUB メニューが表示された際、 <keycap>E</keycap> を押して編集モードに移行し、 <literal>linux</literal> の行内にある <literal>fips=1</literal> を削除したあと、 <keycap>F10</keycap> キーを押して起動してください。たいていは <filename>/etc/default/grub</filename> ファイルの記述ミスですので、この手順で一時的に FIPS を無効化して起動したあと、ファイルを修正して GRUB と initramfs を再構築し、起動し直してください。</para>
 </sect1>
</chapter>
