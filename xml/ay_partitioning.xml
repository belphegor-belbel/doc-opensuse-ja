<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 [
<!ENTITY % entities SYSTEM "entity-decl.ent">
%entities;
]>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0" xml:id="CreateProfile-Partitioning">
  <title>パーティション設定</title>

 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>

  <para>パーティション設定に対して、 &ay; では 3 つの種類に分類して扱っています:</para>

   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>自動的なパーティション設定。ユーザ側にはパーティション設定に対する問い合わせを行わず、 &ay; 側で設定を全て賄うことを指します。</para>
    </listitem>
    <listitem>
     <para>ガイド付きのパーティション設定。ユーザ側で LVM を使用するかどうかなどの基本設定を行うものの、詳しいパーティション設定やボリュームグループの設定など、詳細箇所については行わないものを指します。</para>
    </listitem>
    <listitem>
     <para>熟練者向けのパーティション設定。ユーザ側で詳細な配置の設定を行うことを指します。ただし、全ての設定までを指定する必要はなく、必要に応じて環境に合わせた既定値を提案するものとします。</para>
    </listitem>
   </itemizedlist>

   <para>これらの分類は、通常のインストーラでも選択することができます。 <guimenu>ガイド付き設定</guimenu> を使用すれば詳細なパーティション設定画面を飛ばして &yast; 側に設定を任せることができますし、 <guimenu>熟練者向けパーティション設定</guimenu> を使用すれば、詳細な配置を設定することができます。</para>

   <sect2 xml:id="CreateProfile-Automatic-Partitioning">
    <title>自動的なパーティション設定</title>

    <para>&ay; では、ユーザに対して一切問い合わせを行わずに賢くパーティション設定を行うことができます。インストールする製品にも依存しますが、 &ay; では通常、ルートファイルシステムに対して btrfs を、個別の <literal>/home</literal> パーティションに対して XFS をそれぞれ作成し、スワップパーティションを加えた 3 つのパーティションを作成します。これに加えて、アーキテクチャによっては起動に必要なパーティション (BIOS GRUB パーティションなど) を追加で作成することもあります。</para>

    <para>しかしながら、これらの既定値はディスク領域などの状況によっても変化します。たとえばディスク容量が少ない場合、個別の <literal>/home</literal> パーティションが作成されなかったりします。</para>

    <para>これらの既定値を調整したい場合は、 <xref linkend="CreateProfile-Guided-Partitioning"/> で説明している設定項目を調整してください。</para>
   </sect2>

   <sect2 xml:id="CreateProfile-Guided-Partitioning">
<!-- this section differs from older releases, do not backport, 
      see https://github.com/SUSE/doc-sle/pull/513. (cjs, feb 4 2020) -->       
    <title>ガイド付きのパーティション設定</title>

    <para>&ay; には、一切ユーザに対して問い合わせを行うことなくパーティション設定を行う機能がありますが、いくつかの一般的なパラメータのみを指定しておいて、残りを &ay; に任せたほうが都合の良い場合があります。たとえば詳細なパラメータを指定せずに LVM を使用したい場合や、ファイルシステムの暗号化を行いたいような場合がそれにあたります。これは通常のインストール処理でも同様で、ガイド付きの設定を利用することで、基本的なパラメータのみを指定したパーティション設定を行うことができます。</para>

    <para><xref linkend="example-lvm-guided"/> で示している <literal>storage</literal> セクションでは、 LVM を利用するとともに、必要かどうかにかかわらず全ての Windows パーティションを削除するような設定を示しています。</para>

    <example xml:id="example-lvm-guided">
     <title>LVM ベースのガイド付きパーティション設定</title>
     <screen>&lt;general&gt;
   &lt;storage&gt;
     &lt;proposal&gt;
       &lt;lvm config:type="boolean"&gt;true&lt;lvm&gt;
       &lt;windows_delete_mode config:type="symbol"&gt;all&lt;windows_delete_mode&gt;
     &lt;/proposal&gt;
   &lt;storage&gt;
&lt;general&gt;</screen>
    </example>

    <variablelist>
      <title/>
     <varlistentry>
      <term>lvm</term>
      <listitem>
       <para>LVM ベースの提案を作成するかどうかを指定します。既定値は <literal>false</literal> です。</para>
       <screen>&lt;lvm config:type="boolean"&gt;true&lt;/lvm&gt;</screen>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>resize_windows</term>
      <listitem>
       <para><literal>true</literal> に設定した場合、 &ay; はインストールに必要な領域を確保するため、 Windows のパーティションのサイズ変更を行うようになります。</para>
       <screen>&lt;resize_windows config:type="boolean"&gt;false&lt;/resize_windows&gt;</screen>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>windows_delete_mode</term>
      <listitem>
        <itemizedlist mark="bullet" spacing="normal">
         <listitem>
          <para><literal>none</literal> を指定すると、 Windows パーティションを削除しないようになります。</para>
         </listitem>
         <listitem>
          <para><literal>ondemand</literal> を指定すると、必要に応じて Windows パーティションを削除するようになります。</para>
         </listitem>
         <listitem>
          <para><literal>all</literal> を指定すると、全ての Windows パーティションを削除するようになります。</para>
         </listitem>
        </itemizedlist>
       <screen>&lt;windows_delete_mode config:type="symbol"&gt;ondemand&lt;/windows_delete_mode&gt;</screen>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>linux_delete_mode</term>
      <listitem>

        <itemizedlist mark="bullet" spacing="normal">
         <listitem>
          <para><literal>none</literal> を指定すると、 Linux パーティションを削除しないようになります。</para>
         </listitem>
         <listitem>
          <para><literal>ondemand</literal> を指定すると、必要に応じて Linux パーティションを削除するようになります。</para>
         </listitem>
         <listitem>
          <para><literal>all</literal> を指定すると、全ての Linux パーティションを削除するようになります。</para>
         </listitem>
        </itemizedlist>
       <screen>&lt;linux_delete_mode config:type="symbol"&gt;ondemand&lt;/linux_delete_mode&gt;</screen>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>other_delete_mode</term>
      <listitem>
        <itemizedlist mark="bullet" spacing="normal">
         <listitem>
          <para><literal>none</literal> を指定すると、その他のパーティションを削除しないようになります。</para>
         </listitem>
         <listitem>
          <para><literal>ondemand</literal> を指定すると、必要に応じてその他のパーティションを削除するようになります。</para>
         </listitem>
         <listitem>
          <para><literal>all</literal> を指定すると、全てのその他のパーティションを削除するようになります。</para>
         </listitem>
        </itemizedlist>
       <screen>&lt;other_delete_mode config:type="symbol"&gt;ondemand&lt;/other_delete_mode&gt;</screen>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>encryption_password</term>
      <listitem>
       <para>指定したパスワードで暗号化を行うようにします。既定では暗号化を行いません。</para>
       <screen>&lt;encryption_password&gt;some-secret&lt;/encryption_password&gt;</screen>
      </listitem>
     </varlistentry>
    </variablelist>
   </sect2>

   <sect2 xml:id="CreateProfile-Expert-Partitioning">
    <title>熟練者向けパーティション設定</title>

    <para>ガイド付きパーティション設定よりも詳しく設定を行いたい場合は、 &ay; のプロファイル内に <literal>partitioning</literal> セクションを挿入して指定を行います。ただし、 &ay; では全ての詳細までを指定する必要はありません。不完全な指定を行っていても、適切な既定値を割り当てて設定するようになっています。</para>

    <para><literal>partitioning</literal> セクション内には <literal>drive</literal> 要素の羅列を設定します。それぞれの <literal>drive</literal> 要素には、ディスクや LVM のボリュームグループ、 RAID やマルチデバイス型の btrfs ファイルシステムなどの配置要素を設定します。</para>

    <para><xref linkend="example-partitioning"/> の例では、 &ay; に対して、ディスク全体を使用して <literal>/</literal> , <literal>/home</literal> , <literal>swap</literal> の各パーティションを作成する設定例を示しています。なお、パーティション内で使用すべきファイルシステムの情報などの指定が省略されていることに注意してください。このような指定を行った場合は、 &ay; 側で自動的に判断して設定を行います。</para>

    <example xml:id="example-partitioning">
     <title><literal>/</literal> , <literal>/home</literal> , <literal>swap</literal> の各パーティションを作成する場合の例</title>
     <screen>&lt;partitioning config:type="list"&gt;
  &lt;drive&gt;
    &lt;use&gt;all&lt;/use&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;mount&gt;/&lt;/mount&gt;
        &lt;size&gt;20GiB&lt;/size&gt;
      &lt;/partition&gt;
      &lt;partition&gt;
        &lt;mount&gt;/home&lt;/mount&gt;
        &lt;size&gt;max&lt;/size&gt;
      &lt;/partition&gt;
      &lt;partition&gt;
        &lt;mount&gt;swap&lt;/mount&gt;
        &lt;size&gt;1GiB&lt;/size&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
  &lt;/drive&gt;</screen>
    </example>

    <tip xml:id="ay-boot-partition">
     <title>起動パーティションの提案</title>
     <para>&ay; では、プロファイル内に指定されたパーティション設定で問題なく起動できるかどうかを自動的に判断します。もしも起動できないものと判断された場合は、必要なパーティションを自動的に追加します。そのため、起動用のパーティションが必要かどうかがわからないような状況でも、 &ay; に設定を任せておけば正しい選択を行ってくれることになります。</para>
    </tip>

    <sect3 xml:id="CreateProfile-Partitioning-config">
     <title>ドライブの設定</title>
     <para>下記のような XML 構造内に、必要な要素を追加していきます:</para>

     <screen>&lt;profile&gt;
  &lt;partitioning config:type="list"&gt;
    &lt;drive&gt;
     ...
    &lt;/drive&gt;
  &lt;/partitioning&gt;
&lt;/profile&gt;</screen>

<variablelist>
  <title>属性／値／説明</title>
    <varlistentry>
        <term>device</term>
        <listitem>
          <para>任意指定です。ここでは設定対象のデバイスを指定しますが、何も指定しない場合は &ay; が自動的にデバイスを判断します。判断を調整する方法については、 <xref linkend="ay-partitioning-skip-devices"/> をお読みください。</para>
          <para>値に <literal>ask</literal> を指定すると、 &ay; はインストール時に使用するデバイスをユーザに対して尋ねるようになります。</para>
          <para>また、デバイス名を ID で指定することで、システム構成の変更に影響を受けないようにすることもできます。たとえば <filename>/dev/disk/by-id/<replaceable>ata-WDC_WD3200AAKS-75L9A0_WD-WMAV27368122</replaceable></filename> のように <emphasis>by-id</emphasis> で指定したり、 <filename>/dev/disk/by-path/<replaceable>pci-0001:00:03.0-scsi-0:0:0:0</replaceable></filename> のように <emphasis>by-path</emphasis> で指定したりすることができます。</para>
          <screen>&lt;device&gt;/dev/sda&lt;/device&gt;</screen>
          <para>ボリュームグループやソフトウエア RAID 、 &bcache; デバイスの場合は、インストール後のシステムで使用するデバイス名は別のものになります (既存のデバイスとの衝突を避けるためのものです) 。</para>
          <para>マルチパスデバイスの扱いについて、詳しくは <xref linkend="ay-partition-multipath"/> をお読みください。</para>
      </listitem>      
  </varlistentry>
  
  <varlistentry>
      <term>initialize</term>
      <listitem>
          <para>任意指定です。既定値は <literal>false</literal> で、 <literal>true</literal> に設定すると、 &ay; がパーティションの計算を行う前に、パーティションテーブルを消去するようになります。</para>
          <screen>&lt;initialize config:type="boolean"&gt;true&lt;/initialize&gt;</screen>
      </listitem>
  </varlistentry>
  
  <varlistentry>
      <term>partitions</term>
      <listitem>
          <para>任意指定です。ここには &lt;partition&gt; 項目を入れます (詳しくは <xref linkend="ay-partition-configuration"/> をお読みください) 。</para>
          <screen>&lt;partitions config:type="list"&gt;
          &lt;partition&gt;...&lt;/partition&gt;
          ...
          &lt;/partitions&gt;</screen>
          <para>何もパーティションを指定しない場合、 &ay; は適切なパーティション設定を自動で作成します (詳しくは <xref linkend="ay-auto-partitioning"/> をお読みください) 。</para>
      </listitem>
  </varlistentry>  
  <varlistentry>
      <term>pesize</term>
      <listitem>
          <para>任意指定で、 LVM でのみ意味のある項目です。 LVM ボリュームグループの場合、 4M が既定値となります。</para>
          <screen>&lt;pesize&gt;8M&lt;/pesize&gt;</screen>
      </listitem>
  </varlistentry>
  
  <varlistentry>
      <term>use</term>
      <listitem>
          <para>設定しておくことをお勧めします。 &ay; がハードディスクに対してパーティション設定を行うにあたって、その大まかな方針を指定します。下記のいずれかを指定します:</para>
          <para><literal>all</literal>: 新しいパーティションを作成する際、ディスク全体を使用するようにします。</para>
          <para><literal>linux</literal>: 既存の Linux パーティションのみを使用します。</para>
          <para><literal>free</literal>: デバイス内の未使用領域のみを使用し、それ以外のパーティションについては何も変更しないようにします。</para>
          <para><replaceable>1,2,3</replaceable>: 使用すべきパーティションの番号をカンマ区切りで指定します。</para>
      </listitem>
  </varlistentry>
  
  <varlistentry>
      <term>type</term>
      <listitem>
          <para>任意指定です。 <literal>drive</literal> の種類を指定します。通常の物理ハードディスクの場合、既定値は <literal>CT_DISK</literal> になります。下記のいずれかを指定してください:</para>
          <para><literal>CT_DISK</literal>: 物理的なハードディスク (既定値)</para>
           <para><literal>CT_LVM</literal>: LVM ボリュームグループ</para>
           <para><literal>CT_MD</literal>: ソフトウエア RAID デバイス</para>
           <para><literal>CT_BCACHE</literal>: ソフトウエア &bcache; デバイス</para>
           <para><literal>CT_BTRFS</literal>: マルチデバイス型の btrfs ファイルシステム</para>
           <para><literal>CT_NFS</literal>: NFS</para>
           <para><literal>CT_TMPFS</literal>: <literal>tmpfs</literal> ファイルシステム</para>
          <screen>&lt;type config:type="symbol"&gt;CT_LVM&lt;/type&gt;</screen>
      </listitem>
  </varlistentry>
  
  <varlistentry>
      <term>disklabel</term>
      <listitem>
          <para>任意指定です。既定では &yast; 側で自動的に判断します。異なる種類のパーティションテーブルが既に存在している場合、そのままにしておくべきパーティションや再利用可能なパーティションが含まれている場合を除き、指定した種類のパーティションテーブルを再作成します。何もパーティションを作成せずにディスクを使用したい場合は、この要素を <literal>none</literal> にしてください。</para>
          <para><literal>msdos</literal></para>
            <para><literal>gpt</literal></para>
            <para><literal>none</literal></para>
          <screen>&lt;disklabel&gt;gpt&lt;/disklabel&gt;</screen>
      </listitem>
  </varlistentry>
  
  <varlistentry>
      <term>keep_unknown_lv</term>
      <listitem>
          <para>任意指定です。既定値は <literal>false</literal> です。</para>
          <para>type=CT_LVM のドライブでのみ意味のある項目です。論理ボリュームグループを再利用している場合、この値を <literal>true</literal> に設定すると、そのグループ内に存在する全ての既存論理ボリュームは、それらが &lt;partitioning&gt; で指定されている場合を除き、何も変更が加えられないようになります。そのため、そのままにしておくべき論理ボリュームについては、何も指定しなくて良いことになります。</para>
          <screen>&lt;keep_unknown_lv config:type="boolean"&gt;false&lt;/keep_unknown_lv&gt;</screen>          
      </listitem>
  </varlistentry> 
  
  <varlistentry>
      <term>enable_snapshots</term>
      <listitem>
          <para>任意指定です。既定値は <literal>true</literal> です。</para>
          <para><literal>/</literal> にマウントされている btrfs ファイルシステムに対して、スナップショットを有効化します (その他のファイルシステムや、 <literal>/</literal> にマウントされていない btrfs ファイルシステムには適用されません) 。</para>
          <screen>&lt;enable_snapshots config:type="boolean"&gt;false&lt;/enable_snapshots&gt;</screen>          
      </listitem>
  </varlistentry>
  <varlistentry>
      <term>quotas</term>
      <listitem>
          <para>任意指定です。既定値は <literal>false</literal> です。</para>
          <para>btrfs サブボリュームに対するクォータサポートを有効化します。この要素を <literal>true</literal> に設定すると、ファイルシステムに対するクォータサポートを有効化します。なお、制限の設定は各サブボリューム側で行ってください。詳しくは <xref linkend="ay-btrfs-subvolumes"/> をお読みください。</para>
          <screen>&lt;quotas config:type="boolean"&gt;true&lt;/quotas&gt;</screen>          
      </listitem>
  </varlistentry>
</variablelist>

     <important>
      <title>データ損失への警告</title>
      <para><literal>use</literal> プロパティに設定した値に従って、既存のデータとパーティションの取り扱いが決まります。このプロパティに <literal>all</literal> を指定すると、ディスク全体が消去されます。いずれかのパーティション内に重要なデータが含まれる場合は、あらかじめバックアップを採取するものとし、 <literal>confirm</literal> を指定して確認を行うようにしてください。確認を行うように設定しないと、何もメッセージが表示されないままパーティションが削除されてしまいます。</para>
     </important>

     <tip xml:id="ay-partitioning-skip-devices">
      <title>ドライブを読み飛ばす設定について</title>
      <para>&ay; の制御ファイル内で &lt;device&gt; 項目を指定せず、 &ay; の自動デバイス判断に任せたい場合、その判断基準を設定することができます。通常は適切なデバイスのうち最初のデバイスを使用するようになっていますが、下記のように設定することで、条件に合致するデバイスを除外できるようになります:</para>
      <screen>&lt;partitioning config:type="list"&gt;
  &lt;drive&gt;
    &lt;initialize config:type="boolean"&gt;true&lt;/initialize&gt;
    &lt;skip_list config:type="list"&gt;
      &lt;listentry&gt;
        &lt;!-- usb-storage ドライバを使用しているデバイスを読み飛ばす --&gt;
        &lt;skip_key&gt;driver&lt;/skip_key&gt;
        &lt;skip_value&gt;usb-storage&lt;/skip_value&gt;
      &lt;/listentry&gt;
      &lt;listentry&gt;
        &lt;!-- 1GB より小さいデバイスを読み飛ばす --&gt;
        &lt;skip_key&gt;size_k&lt;/skip_key&gt;
        &lt;skip_value&gt;1048576&lt;/skip_value&gt;
        &lt;skip_if_less_than config:type="boolean"&gt;true&lt;/skip_if_less_than&gt;
      &lt;/listentry&gt;
      &lt;listentry&gt;
        &lt;!-- 100GB より大きいデバイスを読み飛ばす --&gt;
        &lt;skip_key&gt;size_k&lt;/skip_key&gt;
        &lt;skip_value&gt;104857600&lt;/skip_value&gt;
        &lt;skip_if_more_than config:type="boolean"&gt;true&lt;/skip_if_more_than&gt;
      &lt;/listentry&gt;
    &lt;/skip_list&gt;
  &lt;/drive&gt;
&lt;/partitioning&gt;</screen>
      <para>&lt;skip_key&gt; で設定できる値の一覧について、詳しくはインストール済みのシステムで <command>yast2 ayast_probe</command> を実行してください。</para>
     </tip>
    </sect3>

    <sect3 xml:id="ay-partition-configuration">
     <title>パーティションの設定</title>
     <para>下記のような XML 構造内に、必要な要素を追加していきます:</para>
     <screen>&lt;drive&gt;
  &lt;partitions config:type="list"&gt;
    &lt;partition&gt;
      ...
    &lt;/partition&gt;
  &lt;/partitions&gt;
&lt;/drive&gt;</screen>
     <variablelist>
         <varlistentry>
             <term>create</term>
             <listitem>
                 <para>対象のパーティションや論理ボリュームを作成しなければならない場合、もしくは既に存在しているような場合に指定します。 <literal>false</literal> に設定した場合、 &ay; に対して使用すべきデバイスを指示するため、 <literal>partition_nr</literal> , <literal>lv_name</literal>, <literal>label</literal>, <literal>uuid</literal> のいずれかを指定する必要があります。</para>
<screen>&lt;create config:type="boolean"&gt;false&lt;/create&gt;</screen>                 
             </listitem>
         </varlistentry>

         <varlistentry>
             <term>crypt_method</term>
             <listitem>
                 <para>任意指定です。パーティションの暗号化方式を指定します。下記のいずれかを指定してください:</para>
                     <itemizedlist mark="bullet" spacing="normal">
           <listitem>
            <para><literal>luks1</literal> : 通常の LUKS1 形式での暗号化を行います。</para>
           </listitem>
           <listitem>
            <para><literal>pervasive_luks2</literal> : 普及型のボリュームの暗号化を行います。</para>
           </listitem>
           <listitem>
            <para><literal>protected_swap</literal> : 暫定的な保護鍵を利用して暗号化します。</para>
           </listitem>
           <listitem>
            <para><literal>secure_swap</literal> : 暫定的な機密鍵を利用して暗号化します。</para>
           </listitem>
           <listitem>
            <para><literal>random_swap</literal> : 暫定的な乱数鍵を利用して暗号化します。</para>
           </listitem>
          </itemizedlist>
          <screen>&lt;crypt_method config:type="symbol"&gt;luks1&lt;/crypt_method&gt;</screen>
          <para os="sles;sled;osuse">暗号化方式の選択機能は &productname; <phrase os="sles;sled">15 SP2</phrase> <phrase os="osuse">15.2</phrase> もしくはそれ以降のバージョンで使用することができます。以前のバージョンと同じ動作にしたい場合は、 <literal>luks1</literal> を指定してください。</para>
          <para>暗号化パスワードの指定方法については、 <literal>crypt_key</literal> 要素の説明をお読みください。</para>
             </listitem>
         </varlistentry>

         <varlistentry>
             <term>crypt_fs</term>
             <listitem>
                 <para>パーティションを暗号化するよう指定します (既定値は <literal>false</literal> です)。ただし、この要素は廃止予定になっています。代わりに <literal>crypt_method</literal> を使用してください。</para>
<screen>&lt;crypt_fs config:type="boolean"&gt;true&lt;/crypt_fs&gt;</screen>
             </listitem>
         </varlistentry>

         <varlistentry>
             <term>crypt_key</term>
             <listitem>
                 <para><literal>crypt_method</literal> でパスワードを設定する必要のある方式 (<literal>luks1</literal> もしくは <literal>pervasive_luks2</literal>) を選択した場合に必要となります。</para>
<screen>&lt;crypt_key&gt;xxxxxxxx&lt;/crypt_key&gt;</screen>                 
             </listitem>
         </varlistentry>

         <varlistentry>
             <term>mount</term>
             <listitem>
                 <para>少なくとも 1 つのルートパーティション (/) とスワップパーティションを設定する必要があります。</para>
 <screen>&lt;mount&gt;/&lt;/mount&gt;&lt;mount&gt;swap&lt;/mount&gt;</screen>                
             </listitem>
         </varlistentry>

         <varlistentry>
             <term>fstopt</term>
             <listitem>
                 <para>対象のパーティションに対して設定するマウントオプションを指定します。詳しくは <command>man mount</command> をお読みください。</para>
<screen>&lt;fstopt&gt;ro,noatime,user,data=ordered,acl,user_xattr&lt;/fstopt&gt;</screen>                 
             </listitem>
         </varlistentry>

         <varlistentry>
             <term>label</term>
             <listitem>
                 <para>パーティションのラベルを指定します。デバイスをフォーマットする場合 (特に <literal>mountby</literal> パラメータを <literal>label</literal> にする場合) に有用であるほか、既に存在するデバイスを識別するような場合にも使用します (上述の <literal>create</literal> もお読みください) 。指定例について、詳しくは <command>man e2label</command> をお読みください。</para>
<screen>&lt;label&gt;mydata&lt;/label&gt;</screen>               
             </listitem>
         </varlistentry>

         <varlistentry>
             <term>uuid</term>
             <listitem>
                 <para>パーティションの UUID を指定します。既に存在するデバイスを識別する場合にのみ使用します (上述の <literal>create</literal> もお読みください) 。なお、新しく作成するデバイスの場合は UUID を事前に決めることができませんので、指定することもできません (詳しくは <command>man uuidgen</command> をお読みください)。</para>
<screen>&lt;uuid&gt;1b4e28ba-2fa1-11d2-883f-b9a761bde3fb&lt;/uuid&gt;</screen>                
             </listitem>
         </varlistentry>

         <varlistentry>
             <term>size</term>
             <listitem>
                 <para>4G, 4500M などのように、パーティションのサイズを指定します。 /boot パーティションとスワップパーティションに対しては、 <literal>auto</literal> を指定することもできます。この場合、 &ay; 側で適切なサイズを設定します。また、いずれか 1 つのパーティションに対して <literal>max</literal> を指定すると、残りの領域全てを使用することができるようになります。</para>
                 <para>サイズは割合で設定することもできます。たとえば 10% と指定すると、ハードディスク全体もしくはボリュームグループの 10% 分を使用することができます。必要に応じて <literal>auto</literal> , <literal>max</literal> , <literal>size</literal>, 割合を組み合わせて使用することもできます。</para>
<screen>&lt;size&gt;10G&lt;/size&gt;</screen>                    
                 <para os="sles;sled;osuse">&productname; 15 以降では、全ての値 (<literal>auto</literal> と <literal>max</literal> を含む) をパーティションのサイズ変更時にも使用できるようになっています。</para>
                 <para os="slemicro">ここには全ての値 (<literal>auto</literal> と <literal>max</literal> を含む) を指定できるほか、パーティションのサイズ変更でも使用することができます。</para>
             </listitem>
         </varlistentry>

         <varlistentry>
             <term>format</term>
             <listitem>
                 <para>&ay; 側でパーティションのフォーマットを行うかどうかを指定します。 <literal>create</literal> を <literal>true</literal> に設定した場合は、この値についても <literal>true</literal> を設定しておいたほうが良いでしょう。</para>
<screen>&lt;format config:type="boolean"&gt;false&lt;/format&gt;</screen>                
             </listitem>
         </varlistentry>

         <varlistentry>
             <term>filesystem</term>
             <listitem>
                 <para>任意指定です。ルートパーティション ( <filename>/</filename> ) の場合、既定値は <literal>btrfs</literal> に、データパーティションの場合、既定値は <literal>xfs</literal> になります。指定可能な値は下記のとおりです:</para>
         <itemizedlist mark="bullet" spacing="normal">
           <listitem>
            <para><literal>btrfs</literal></para>
           </listitem>
           <listitem>
            <para><literal>ext2</literal></para>
           </listitem>
           <listitem>
            <para><literal>ext3</literal></para>
           </listitem>
           <listitem>
            <para><literal>ext4</literal></para>
           </listitem>
           <listitem>
            <para><literal>fat</literal></para>
           </listitem>
           <listitem>
            <para><literal>xfs</literal></para>
           </listitem>
           <listitem>
            <para><literal>swap</literal></para>
<screen>&lt;filesystem config:type="symbol"&gt;ext3&lt;/filesystem&gt;</screen>            
           </listitem>
          </itemizedlist>
             </listitem>
         </varlistentry>

         <varlistentry>
             <term>mkfs_options</term>
             <listitem>
                 <para>任意指定です。 <command>mkfs</command> に渡すオプション文字列を指定します。なお、この文字列はどうしても必要な場合にのみ設定してください (詳しくは、作成するファイルシステムの mkfs マニュアルページをお読みください) 。</para>
<screen>&lt;mkfs_options&gt;-I 128&lt;/mkfs_options&gt;</screen>                 
             </listitem>
         </varlistentry>

         <varlistentry>
             <term>partition_nr</term>
             <listitem>
                 <para>このパーティションのパーティション番号を指定します。 <literal>create=false</literal> もしくは LVM を使用しようとしている場合、 <literal>partition_nr</literal> でパーティションの番号を指定することができます。</para>
<screen>&lt;partition_nr config:type="integer"&gt;2&lt;/partition_nr&gt;</screen>                 
             </listitem>
         </varlistentry>

         <varlistentry>
             <term>partition_id</term>
             <listitem>
                 <para><literal>partition_id</literal> ではパーティションの ID を設定します。 Linux パーティションでは 131 、スワップパーティションでは 130 が自動的に設定されますが、それ以外の ID を設定したい場合は、これで設定を行ってください。既定値は Linux パーティションの場合は <literal>131</literal>, スワップパーティションの場合は <literal>130</literal> です。</para>
<screen>&lt;partition_id config:type="integer"&gt;131&lt;/partition_id&gt;</screen>                 
<simplelist>
 <member>スワップ: <literal>130</literal></member>
 <member>Linux: <literal>131</literal></member>
 <member>LVM: <literal>142</literal></member>
 <member>MD RAID: <literal>253</literal></member>
 <member>EFI パーティション: <literal>259</literal></member>
</simplelist>
             </listitem>
         </varlistentry>

         <varlistentry>
             <term>partition_type</term>
             <listitem>
                 <para>任意指定です。指定可能な値は <literal>primary</literal> (既定値) もしくは <literal>logical</literal> のいずれかです。パーティションテーブルに <literal>msdos</literal> 形式を使用している場合、この要素でパーティションの種類を設定することができます。値には <literal>primary</literal> (プライマリパーティション) もしくは <literal>logical</literal> (論理パーティション) のいずれかを指定します。 <literal>gpt</literal> パーティションテーブルを使用している場合、このような区別はありませんので、値を設定しても無視されます。</para>
<screen>&lt;partition_type&gt;primary&lt;/partition_type&gt;</screen>                 
             </listitem>
         </varlistentry>

         <varlistentry>
             <term>mountby</term>
             <listitem>
                 <para>パーティション番号の代わりに、 <literal>device</literal> (デバイス), <literal>label</literal> (ラベル), <literal>uuid</literal> (UUID), <literal>path</literal> (udev パス), <literal>id</literal> (udev ID) などでパーティションをマウントするよう設定することができます。</para>
                 <para>上述の <literal>label</literal> と <literal>uuid</literal> の説明をお読みください。既定値は &yast; 側で規定されていますが、通常は <literal>id</literal> です。</para>
<screen>&lt;mountby config:type="symbol"&gt;label&lt;/mountby&gt;</screen>               
             </listitem>
         </varlistentry>

         <varlistentry>
             <term>subvolumes</term>
             <listitem>
                 <para>btrfs のファイルシステムで作成するサブボリュームの一覧を指定します。これは btrfs を使用する場合にのみ意味のある項目です。詳しくは <xref linkend="ay-btrfs-subvolumes"/> をお読みください。</para>
                 <para>パーティションの設定内に <tag>subvolumes</tag> セクションが存在しない場合、 &ay; は指定したマウントポイント内に、既定のサブボリュームセットを作成します。</para>
<screen>&lt;subvolumes config:type="list"&gt;
  &lt;path&gt;tmp&lt;/path&gt;
  &lt;path&gt;opt&lt;/path&gt;
  &lt;path&gt;srv&lt;/path&gt;
  &lt;path&gt;var&lt;/path&gt;
  ...
&lt;/subvolumes&gt;</screen>                 
             </listitem>
         </varlistentry>

         <varlistentry>
             <term>create_subvolumes</term>
             <listitem>
                 <para>btrfs のサブボリュームを作成すべきかどうかを指定します。既定値は <literal>true</literal> ですが、 <literal>false</literal> に設定した場合、サブボリュームは作成されなくなります。</para>
             </listitem>
         </varlistentry>

         <varlistentry>
             <term>subvolumes_prefix</term>
             <listitem>
                 <para>btrfs のサブボリュームに設定するプレフィクス (前置) 名を指定します。何もプレフィクスを指定したくない場合は、空の値を設定してください:</para>
<screen>&lt;subvolumes_prefix&gt;&lt;![CDATA[]]&gt;&lt;/subvolumes_prefix&gt;</screen>
                 <para>既定では <literal>@</literal> が設定されています。</para>
             </listitem>
         </varlistentry>

         <varlistentry>
             <term>lv_name</term>
             <listitem>
                 <para>このパーティションがボリュームグループ内の論理ボリュームである場合、ここで論理ボリュームの名前を指定します (<literal>drive</literal> 設定内の <literal>type</literal> パラメータもお読みください) 。</para>
<screen>&lt;lv_name&gt;opt_lv&lt;/lv_name&gt;</screen>                 
             </listitem>
         </varlistentry>

         <varlistentry>
             <term>stripes</term>
             <listitem>
                 <para>LVM のストライピングを設定するための整数です。どれだけの数のデバイスにデータを分散させるのかを指定します。</para>
<screen>&lt;stripes config:type="integer"&gt;2&lt;/stripes&gt;</screen>               
             </listitem>
         </varlistentry>

         <varlistentry>
             <term>stripesize</term>
             <listitem>
                 <para>各ブロックのサイズを KB 単位で指定します。</para>
<screen>&lt;stripesize config:type="integer"&gt;4&lt;/stripesize&gt;</screen>               
             </listitem>
         </varlistentry>

         <varlistentry>
             <term>lvm_group</term>
             <listitem>
                 <para>このパーティションが LVM のボリュームグループの一部として使用されている物理パーティションである場合は、ここでボリュームグループの名前を指定する必要があります。</para>
<screen>&lt;lvm_group&gt;system&lt;/lvm_group&gt;</screen>                 
             </listitem>
         </varlistentry>

         <varlistentry>
             <term>pool</term>
             <listitem>
                 <para>LVM 論理ボリュームが LVM の thin プール内に存在すべきである場合は、 <literal>pool</literal> の値を <literal>true</literal> にしなければなりません。</para>
<screen>&lt;pool config:type="boolean"&gt;true&lt;/pool&gt;</screen>              
             </listitem>
         </varlistentry>

         <varlistentry>
             <term>used_pool</term>
             <listitem>
                 <para>この thin 論理ボリュームに対して、データストアとして使用する LVM thin プールの名前を指定します。ここに何らかの値を設定すると、このボリュームは thin 論理ボリュームとして使用されるようになります。</para>
<screen>&lt;used_pool&gt;my_thin_pool&lt;/used_pool&gt;</screen>              
             </listitem>
         </varlistentry>

         <varlistentry>
             <term>raid_name</term>
             <listitem>
                 <para>この物理ボリュームが RAID アレイの一部である場合は、ここで RAID アレイの名前を指定します。</para>
<screen>&lt;raid_name&gt;/dev/md/0&lt;/raid_name&gt;</screen>               
             </listitem>
         </varlistentry>

         <varlistentry>
             <term>raid_options</term>
             <listitem>
                 <para>RAID のオプションを指定します。なお、 <literal>partition</literal> 内に RAID のオプションを設定するのは非推奨になっています。詳しくは <xref linkend="ay-partition-sw-raid"/> をお読みください。</para>
             </listitem>
         </varlistentry>

         <varlistentry>
             <term>bcache_backing_for</term>
             <listitem>
                 <para>このデバイスを <emphasis>&bcache; のバッキングデバイス</emphasis> として使用する場合は、ここで &bcache; のデバイス名を指定します。詳しくは <xref linkend="ay-partition-bcache"/> をお読みください。</para>
<screen>&lt;bcache_backing_for&gt;/dev/bcache0&lt;/bcache_backing_for&gt;</screen>              
             </listitem>
         </varlistentry>

         <varlistentry>
             <term>bcache_caching_for</term>
             <listitem>
                 <para>このデバイスを <emphasis>&bcache; のキャッシュデバイス</emphasis> として使用する場合は、ここで &bcache; のデバイス名を指定します。詳しくは <xref linkend="ay-partition-bcache"/> をお読みください。</para>
  <screen>&lt;bcache_caching_for config:type="list"&gt;&lt;listentry&gt;/dev/bcache0&lt;/listentry&gt;&lt;/bcache_caching_for&gt;</screen>               
             </listitem>
         </varlistentry>

         <varlistentry>
             <term>resize</term>
             <listitem>
                 <para os="sles;sled;osuse">&productname; 15 およびそれ以降では、サイズ変更は物理ディスクパーティションと LVM ボリュームの両方に対して動作するようになっています。</para>
                 <para os="slemicro">サイズ変更は物理ディスクパーティションと LVM ボリュームの両方に対して動作するようになっています。</para>
 <screen>&lt;resize config:type="boolean"&gt;false&lt;/resize&gt;</screen>                
             </listitem>
         </varlistentry>
     </variablelist>     
    </sect3>

    <sect3 xml:id="ay-btrfs-subvolumes">
     <title>btrfs サブボリューム</title>
     <para><xref linkend="ay-partition-configuration"/> で説明しているとおり、それぞれの btrfs ファイルシステムに対して、必要なサブボリュームを定義することができます。最もシンプルな形態では、下記のようになります:</para>

<screen>&lt;subvolumes config:type="list"&gt;
  &lt;path&gt;usr/local&lt;/path&gt;
  &lt;path&gt;tmp&lt;/path&gt;
  &lt;path&gt;opt&lt;/path&gt;
  &lt;path&gt;srv&lt;/path&gt;
  &lt;path&gt;var&lt;/path&gt;
&lt;/subvolumes&gt;</screen>

     <para>なお、各サブボリュームに対する追加設定を行うこともできます。たとえばクオータの設定やコピーオンライト機構の有効化などがそれにあたります。具体的には、下記の例のような形式で設定してください:</para>

<screen>&lt;subvolumes config:type="list"&gt;
  &lt;listentry&gt;usr/local&lt;/listentry&gt;
  &lt;listentry&gt;
    &lt;path&gt;tmp&lt;/path&gt;
    &lt;referenced_limit&gt;1 GiB&lt;/referenced_limit&gt;
  &lt;/listentry&gt;
  &lt;listentry&gt;opt&lt;/listentry&gt;
  &lt;listentry&gt;srv&lt;/listentry&gt;
  &lt;listentry&gt;
    &lt;path&gt;var/lib/pgsql&lt;/path&gt;
    &lt;copy_on_write config:type="boolean"&gt;false&lt;/copy_on_write&gt;
  &lt;/listentry&gt;
&lt;/subvolumes&gt;</screen>

     <para>

     </para>

<variablelist xml:id="foofoo">
  <varlistentry>
    <term><literal>path</literal></term>
    <listitem>
      <para>サブボリュームのマウントポイントを指定します。</para>
      <screen>&lt;path&gt;tmp&lt;/tmp&gt;</screen>
      <para>必須です。 <literal>path</literal> 要素が指定されていない場合、 &ay; はそのサブボリュームを無視するようになります。</para>
    </listitem>
  </varlistentry>
  <varlistentry>
    <term><literal>copy-on-write</literal></term>
    <listitem>
      <para>このサブボリュームに対して、コピーオンライト機構を有効化するかどうかを指定します。</para>
      <screen>&lt;copy-on-write config:type="boolean"&gt;false&lt;/copy-on-write&gt;</screen>
      <para>任意指定です。既定値は <literal>false</literal> です。</para>
    </listitem>
  </varlistentry>
  <varlistentry>
    <term><literal>referenced_limit</literal></term>
    <listitem>
      <para>サブボリュームに対するクォータを指定します。</para>
      <screen>&lt;referenced_limit&gt;1 GiB&lt;/referenced_limit&gt;</screen>
      <para>任意指定です。既定値は <literal>unlimited</literal> (無制限) です。 btrfs では、 2 種類の制限 (<literal>referenced</literal> (参照サイズ) および <literal>exclusive</literal> (排他サイズ)) を設定することができますが、この要素では前者を指定します。</para>
    </listitem>
  </varlistentry>
</variablelist>


     <para>ディストリビューション側で既定のサブボリュームが設定されている場合 (たとえば &productname; では <filename>@</filename>) 、この既定のサブボリュームの名前がこの一覧の中に自動的に追加されます。このような動作を無効化したい場合は、 <xref linkend="CreateProfile-Partitioning-config"/> で説明しているとおりに <literal>subvolumes_prefix</literal> を設定してください。</para>

     <screen>&lt;subvolumes_prefix&gt;&lt;![CDATA[]]&gt;&lt;/subvolumes_prefix&gt;</screen>
    </sect3>

    <sect3 xml:id="ay-use-whole-disk">
     <title>ディスク全体の使用</title>

     <para>&ay; では、 <xref linkend="CreateProfile-Partitioning-config"/> で説明している <literal>disklabel</literal> の値を <literal>none</literal> に設定することで、パーティションを作成せずにディスク全体を使用することができます。このような場合、 <literal>drive</literal> 内の最初の <literal>partition</literal> 内の設定が、ディスク全体に対して適用されるようになります。</para>

     <para>下記の例では、 2 番目のディスク ( <literal>/dev/sdb</literal> ) 全体を <literal>/home</literal> のファイルシステムとして使用しています。</para>

     <example>
      <title>ディスク全体をファイルシステムとして使用する設定</title>
      <screen>&lt;partitioning config:type="list"&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/sda&lt;/device&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;create config:type="boolean"&gt;true&lt;/create&gt;
        &lt;format config:type="boolean"&gt;true&lt;/format&gt;
        &lt;mount&gt;/&lt;/mount&gt;
        &lt;size&gt;max&lt;/size&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
  &lt;/drive&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/sdb&lt;/device&gt;
    &lt;disklabel&gt;none&lt;/disklabel&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;format config:type="boolean"&gt;true&lt;/format&gt;
        &lt;mount&gt;/home&lt;/mount&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
  &lt;/drive&gt;</screen>
     </example>

     <para>これに加えて、ディスク全体を LVM 物理ボリュームやソフトウエア RAID のメンバーとして使用することもできます。 LVM やソフトウエア RAID に関する詳細は、 <xref linkend="ay-partition-lvm"/> および <xref linkend="ay-partition-sw-raid"/> をお読みください。</para>

     <para os="sles;sled;osuse">後方互換性を確保する目的で、 <literal>&lt;partition_nr&gt;</literal> の要素を <literal>0</literal> に設定しても、同じ結果になるようになっています。ただし <literal>&lt;partition_nr&gt;</literal> 要素は、 &productname; 15 およびそれ以降で廃止予定とされていることに注意してください。</para>
    </sect3>

    <sect3 xml:id="ay-auto-partitioning">
     <title>不完全な設定の補完</title>
     <para><guimenu>熟練者向けパーティション設定</guimenu> の方式を使用している場合、 &ay; は不完全なプロファイルからでも適切なパーティションプランを作成することができます。下記のプロファイルでは、パーティション配置に関するいくつかの詳細のみを指定し、それ以外を &ay; 側に任せる設定を示しています。</para>
     <example>
      <title>選択したドライブに対する自動的なパーティション設定</title>
      <para>下記はドライブが 1 台だけ搭載されたシステムでの例で、事前には何もパーティションを作成していないため、指定されたパーティションプランに従って自動的にパーティションを作成するように指定しています。なお、何もドライブを指定しない場合、ドライブは自動的に検出されます。</para>
      <screen>&lt;partitioning config:type="list"&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/sda&lt;/device&gt;
    &lt;use&gt;all&lt;/use&gt;
  &lt;/drive&gt;
&lt;/partitioning&gt;
</screen>
     </example>
     <para>さらに詳しい例では、既存のパーティションが存在する場合や複数のドライブが存在する場合の処理方法について示しています。</para>
     <example>
      <title>複数ドライブへのインストール</title>
      <screen>&lt;partitioning config:type="list"&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/sda&lt;/device&gt;
    &lt;use&gt;all&lt;/use&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;mount&gt;/&lt;/mount&gt;
        &lt;size&gt;10G&lt;/size&gt;
      &lt;/partition&gt;
      &lt;partition&gt;
        &lt;mount&gt;swap&lt;/mount&gt;
        &lt;size&gt;1G&lt;/size&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
  &lt;/drive&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/sdb&lt;/device&gt;
    &lt;use&gt;free&lt;/use&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;filesystem config:type="symbol"&gt;ext4&lt;/filesystem&gt;
        &lt;mount&gt;/data1&lt;/mount&gt;
        &lt;size&gt;15G&lt;/size&gt;
      &lt;/partition&gt;
      &lt;partition&gt;
        &lt;filesystem config:type="symbol"&gt;xfs&lt;/filesystem&gt;
        &lt;mount&gt;/data2&lt;/mount&gt;
        &lt;size&gt;auto&lt;/size&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
  &lt;/drive&gt;
&lt;/partitioning&gt;
</screen>
     </example>
    </sect3>
   </sect2>

   <sect2 xml:id="ay-partition-advanced">
    <title>高度なパーティション設定</title>
    <para><remark role="fixme">Add a short description</remark></para>
    <sect3 xml:id="ay-partition-advanced-wipe">
     <title>パーティションテーブルの消去</title>
     <para>通常は &ay; が 1 つずつパーティションを削除していくことから、この設定を行う必要はありません。ですが、 &ay; に対してパーティションを個別に削除するのではなく、敢えて新しいパーティションテーブルを作成させたい場合、下記のような設定が必要になります。</para>
     <para>具体的には、 <literal>drive</literal> セクション内に下記を追加してください:</para>
<screen>&lt;initialize config:type="boolean"&gt;true&lt;/initialize&gt;</screen>
     <para>このような設定を行うことで、 &ay; は既存のパーティションの分析やパーティションプランの作成を行う前に、パーティションテーブルの消去を行うようになります。この設定を行うと、ご存じのとおり既存のパーティション内にある全てのデータは消去され、保持できなくなります。</para>
    </sect3>
    <sect3 xml:id="ay-partition-advanced-mount">
     <title>マウントオプション</title>
     <para>既定では、マウントすべきファイルシステムは <filename>/etc/fstab</filename> 内にデバイス名で指定されます。この指定方法は UUID やボリュームラベルに変更することもできます。ただし、全てのファイルシステムが UUID やボリュームラベルでのマウントに対応しているわけではないことに注意してください。パーティションのマウント方法を指定するには、 <literal>symbol</literal> 型で指定する <literal>mountby</literal> プロパティを設定してください。設定可能な値は下記のとおりです:</para>
     <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <para><literal>device</literal> (既定値)</para>
      </listitem>
      <listitem>
       <para><literal>label</literal></para>
      </listitem>
      <listitem>
       <para><literal>UUID</literal></para>
      </listitem>
     </itemizedlist>
     <para>ラベルを利用して新しいパーティションをマウントする場合、 <literal>label</literal> プロパティで指定した名前をボリュームラベルとして使用します。</para>
     <para>また、 <filename>/etc/fstab</filename> の 4 番目の列に指定することのできる、マウントオプションを追加することもできます。複数のオプションはカンマで区切ります。指定可能な値は下記のとおりです:</para>
     <variablelist>
      <varlistentry>
       <term>読み込み専用でマウント ( <literal>ro</literal> )</term>
       <listitem>
        <para>ファイルシステムに対して書き込みを行うことができなくなります。既定値は <literal>false</literal> です。</para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>アクセス日時を更新しない ( <literal>noatime</literal> )</term>
       <listitem>
        <para>ファイルが読み込まれた際、アクセス日時を更新しないようにします。既定値は <literal>false</literal> です。</para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>ユーザにマウントを許可 ( <literal>user</literal> )</term>
       <listitem>
        <para>一般ユーザからファイルシステムをマウントできるようにします。既定値は <literal>false</literal> です。</para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>データジャーナリングモード ( <literal>ordered</literal> , <literal>journal</literal> , <literal>writeback</literal> )</term>
       <listitem>
        <variablelist>
         <varlistentry>
          <term><literal>journal</literal></term>
          <listitem>
           <para>データを書き込む際、実際のファイルシステムに書き込む前にジャーナルに書き込むようにします。</para>
          </listitem>
         </varlistentry>
         <varlistentry>
          <term><literal>ordered</literal></term>
          <listitem>
           <para>メタデータをジャーナルに書き込む前に、全てのデータを直接実際のファイルシステムに書き込みます。</para>
          </listitem>
         </varlistentry>
         <varlistentry>
          <term><literal>writeback</literal></term>
          <listitem>
           <para>データの書き込み順序を維持しません。</para>
          </listitem>
         </varlistentry>
        </variablelist>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>アクセス制御リスト ( <literal>acl</literal> )</term>
       <listitem>
        <para>ファイルシステムに対してアクセス制御リストを有効化します。</para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>拡張ユーザ属性 ( <literal>user_xattr</literal> )</term>
       <listitem>
        <para>ファイルシステムに対して拡張ユーザ属性を使用できるようにします。</para>
       </listitem>
      </varlistentry>
     </variablelist>
     <example>
      <title>マウントオプション</title>
<screen>&lt;partitions config:type="list"&gt;
  &lt;partition&gt;
    &lt;filesystem config:type="symbol"&gt;ext4&lt;/filesystem&gt;
    &lt;format config:type="boolean"&gt;true&lt;/format&gt;
    &lt;fstopt&gt;ro,noatime,user,data=ordered,acl,user_xattr&lt;/fstopt&gt;
    &lt;mount&gt;/local&lt;/mount&gt;
    &lt;mountby config:type="symbol"&gt;uuid&lt;/mountby&gt;
    &lt;partition_id config:type="integer"&gt;131&lt;/partition_id&gt;
    &lt;size&gt;10G&lt;/size&gt;
  &lt;/partition&gt;
&lt;/partitions&gt;
</screen>
     </example>

    <note>
     <title>ファイルシステムごとに対応するオプションが異なる件について</title>
     <para>ファイルシステムの種類が異なると、使用できるオプションもこことなります。オプションを設定する倍は、あらかじめ対応するドキュメンテーションをお読みください。</para>
    </note>
    </sect3>
    <sect3 xml:id="ay-partition-advanced-keep">
     <title>特定のパーティションの維持</title>
     <para>状況によっては、特定のパーティションのみをフォーマットして、それ以外のパーティションを何もせずにそのままにしておきたいような場合があります。たとえば異なる Linux インストールを共存させたいような場合や、他のオペレーティングシステムをインストールしたままにしておきたいような場合、これらのパーティションは消去せずに維持したままにすることができます。もちろんパーティション内のデータについても維持することができます。</para>
     <para>このような構成を作成する場合、インストール先のシステムとそのハードディスクに対して、さまざまな考慮を行う必要があります。構成内容にもよりますが、インストール先のハードディスクのパーティションテーブルとパーティションの ID 、サイズと番号をそれぞれ知っておく必要があります。これらのデータをもとにして、 &ay; に対して特定のパーティションの維持を設定し、必要であれば新しいパーティションの作成を行うことになります。</para>
     <para>下記の例では、パーティション 1,2,5 をそれぞれ維持し、パーティション 6 を削除して新しい 2 つのパーティションを作成しています。また、パーティション 2 以外を全てフォーマットして使用しています。 <remark>emap 2011-11-05: Not the best example for the scenarios two paras up with coexisting operating systems or data partitions. Who'd want to format those?</remark></para>
     <example>
      <title>パーティションの維持</title>
<screen>&lt;partitioning config:type="list"&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/sdc&lt;/device&gt;
      &lt;partitions config:type="list"&gt;
        &lt;partition&gt;
          &lt;create config:type="boolean"&gt;false&lt;/create&gt;
          &lt;format config:type="boolean"&gt;true&lt;/format&gt;
          &lt;mount&gt;/&lt;/mount&gt;
          &lt;partition_nr config:type="integer"&gt;1&lt;/partition_nr&gt;
        &lt;/partition&gt;
        &lt;partition&gt;
          &lt;create config:type="boolean"&gt;false&lt;/create&gt;
          &lt;format config:type="boolean"&gt;false&lt;/format&gt;
          &lt;partition_nr config:type="integer"&gt;2&lt;/partition_nr&gt;
          &lt;mount&gt;/space&lt;/mount&gt;
        &lt;/partition&gt;
        &lt;partition&gt;
          &lt;create config:type="boolean"&gt;false&lt;/create&gt;
          &lt;format config:type="boolean"&gt;true&lt;/format&gt;
          &lt;filesystem config:type="symbol"&gt;swap&lt;/filesystem&gt;
          &lt;partition_nr config:type="integer"&gt;5&lt;/partition_nr&gt;
          &lt;mount&gt;swap&lt;/mount&gt;
        &lt;/partition&gt;
        &lt;partition&gt;
          &lt;format config:type="boolean"&gt;true&lt;/format&gt;
          &lt;mount&gt;/space2&lt;/mount&gt;
          &lt;size&gt;5G&lt;/size&gt;
        &lt;/partition&gt;
        &lt;partition&gt;
          &lt;format config:type="boolean"&gt;true&lt;/format&gt;
          &lt;mount&gt;/space3&lt;/mount&gt;
          &lt;size&gt;max&lt;/size&gt;
        &lt;/partition&gt;
      &lt;/partitions&gt;
    &lt;use&gt;6&lt;/use&gt;
  &lt;/drive&gt;
&lt;/partitioning&gt;</screen>
     </example>
     <para>上記の例では、既存のパーティションテーブルの内容のほか、維持すべきパーティションの番号についても明示的に指定しています。ただし、さまざまな種類のハードディスクや設定が混在しているような環境の場合、これらを明示的に指定することができない場合もあります。下記のシナリオでは、非 Linux OS のシステムと Linux インストール用の専用領域を確保する構成を示しています。</para>
     <figure xml:id="partitioning-keep1">
      <title>パーティションの維持</title>
      <mediaobject>
       <imageobject role="html">
        <imagedata fileref="partitioning-keep1.png"/>
       </imageobject>
       <imageobject role="fo">
        <imagedata fileref="partitioning-keep1.png" width="75%"/>
       </imageobject>
      </mediaobject>
     </figure>
     <para>このシナリオでは、 <xref linkend="partitioning-keep1"/> の図に示しているとおり、 &ay; では新しいパーティションを作成しないように設定します。その代わり、システム内に存在する特定の種類のパーティションを検出し、制御ファイルに書かれたパーティション設定プランに従ってそれらを使用するように構成しています。この場合、パーティションの番号は全く指定しておらず、マウントポイントとパーティションの種類のみを指定しています (たとえばファイルシステムのオプションや暗号化、ファイルシステムの種類などの追加データを設定することもできます) 。</para>
     <example>
      <title>維持すべきパーティションの自動検出</title>
<screen>&lt;partitioning config:type="list"&gt;
  &lt;drive&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;create config:type="boolean"&gt;false&lt;/create&gt;
        &lt;format config:type="boolean"&gt;true&lt;/format&gt;
        &lt;mount&gt;/&lt;/mount&gt;
        &lt;partition_id config:type="integer"&gt;131&lt;/partition_id&gt;
      &lt;/partition&gt;
      &lt;partition&gt;
        &lt;create config:type="boolean"&gt;false&lt;/create&gt;
        &lt;format config:type="boolean"&gt;true&lt;/format&gt;
        &lt;filesystem config:type="symbol"&gt;swap&lt;/filesystem&gt;
        &lt;partition_id config:type="integer"&gt;130&lt;/partition_id&gt;
        &lt;mount&gt;swap&lt;/mount&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
  &lt;/drive&gt;
&lt;/partitioning&gt;</screen>
     </example>

     <note>
      <title>暗号化されたデバイスの維持について</title>
      <para>&ay; がストレージデバイスを検出する時点では、プロファイル内のパーティション設定セクションは解釈されていません。そのため、デバイスの暗号化を解除するために、どの鍵を使用すべきなのかを判別できません。たとえば、複数の暗号鍵を使用して暗号化を行っている場合がそれに該当します。このような問題を解決するため、 &ay; では設定されている全ての鍵を利用して、デバイスの暗号化解除を試みるようになっています。</para>
     </note>
    </sect3>
   </sect2>

   <sect2 xml:id="ay-partition-lvm">
    <title>論理ボリュームマネージャ (Logical Volume Manager (LVM))</title>
    <para>LVM を設定するには、上述の通常のパーティション作成を設定して、物理ボリュームを作成しておく必要があります。</para>
    <example>
     <title>LVM 物理ボリュームの作成</title>
     <para>下記の例は、 <literal>partitioning</literal> リソースで LVM 向けのパーティションを準備する場合の例です。この例では <filename>/dev/sda1</filename> を作成したあとフォーマットを行わず、 <literal>LVM</literal> の種類を設定し、ボリュームグループ <literal>system</literal> に追加を行います。なお、パーティションのサイズはドライブ内の全空き領域分になります。</para>
<screen>&lt;partitioning config:type="list"&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/sda&lt;/device&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;create config:type="boolean"&gt;true&lt;/create&gt;
        &lt;lvm_group&gt;system&lt;/lvm_group&gt;
        &lt;partition_type&gt;primary&lt;/partition_type&gt;
        &lt;partition_id config:type="integer"&gt;142&lt;/partition_id&gt;
        &lt;partition_nr config:type="integer"&gt;1&lt;/partition_nr&gt;
        &lt;size&gt;max&lt;/size&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
    &lt;use&gt;all&lt;/use&gt;
  &lt;/drive&gt;
&lt;/partitioning&gt;</screen>
    </example>
    <example>
     <title>LVM 論理ボリューム</title>
<screen>&lt;partitioning config:type="list"&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/sda&lt;/device&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;lvm_group&gt;system&lt;/lvm_group&gt;
        &lt;partition_type&gt;primary&lt;/partition_type&gt;
        &lt;size&gt;max&lt;/size&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
    &lt;use&gt;all&lt;/use&gt;
  &lt;/drive&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/system&lt;/device&gt;
      &lt;type config:type="symbol"&gt;CT_LVM&lt;/type&gt;
      &lt;partitions config:type="list"&gt;
        &lt;partition&gt;
          &lt;filesystem config:type="symbol"&gt;ext4&lt;/filesystem&gt;
          &lt;lv_name&gt;user_lv&lt;/lv_name&gt;
          &lt;mount&gt;/usr&lt;/mount&gt;
          &lt;size&gt;15G&lt;/size&gt;
        &lt;/partition&gt;
        &lt;partition&gt;
          &lt;filesystem config:type="symbol"&gt;ext4&lt;/filesystem&gt;
          &lt;lv_name&gt;opt_lv&lt;/lv_name&gt;
          &lt;mount&gt;/opt&lt;/mount&gt;
          &lt;size&gt;10G&lt;/size&gt;
        &lt;/partition&gt;
        &lt;partition&gt;
          &lt;filesystem config:type="symbol"&gt;ext4&lt;/filesystem&gt;
          &lt;lv_name&gt;var_lv&lt;/lv_name&gt;
          &lt;mount&gt;/var&lt;/mount&gt;
          &lt;size&gt;1G&lt;/size&gt;
        &lt;/partition&gt;
      &lt;/partitions&gt;
      &lt;pesize&gt;4M&lt;/pesize&gt;
    &lt;use&gt;all&lt;/use&gt;
  &lt;/drive&gt;
&lt;/partitioning&gt;
</screen>
    </example>
    <para>論理ボリュームに対しても <literal>size</literal> に <literal>max</literal> を指定することができます。もちろん、いずれか 1 つ (!) の論理ボリュームにしか指定できません。また、 1 つのボリュームグループ内で 2 つの論理ボリュームを <literal>max</literal> に設定することもできません。</para>
   </sect2>

   <sect2 xml:id="ay-partition-sw-raid">
    <title>ソフトウエア RAID</title>
    <para os="sles;sled;osuse">ソフトウエア RAID デバイスに対するサポートは、 &productname; <phrase os="sles;sled">15 SP2</phrase> <phrase os="osuse">15.2</phrase> で大幅に改善されています。</para>
     <para os="sles;sled;osuse">必要であれば、後方互換性維持の目的で残されているソフトウエア RAID の古い設定方法を利用することもできます。詳しくは <xref linkend="ay-partition-sw-raid-deprecated"/> をお読みください。</para>
     <para>&ay; を使用することで、ソフトウエア RAID デバイスを作成したり構成したりすることができます。対応する RAID レベルは下記のとおりです:</para>
    <variablelist>
     <varlistentry>
      <term>RAID 0</term>
      <listitem>
       <para>このレベルではディスク性能の強化が行われますが、冗長性は提供 <emphasis>されません</emphasis> 。いずれか 1 台のディスクがクラッシュすると、データの復元は不可能になります。</para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>RAID 1</term>
      <listitem>
       <para>このレベルでは最大限の冗長性を提供します。 2 台以上のディスクを使用することができます。このレベルでは、全てのディスクに対して同じデータが書き込まれます。いずれか 1 台のディスクが正しく動作している限り、データが失われることはありません。この RAID レベルを使用する場合、使用するパーティションはほぼ同じサイズである必要があります。</para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>RAID 5</term>
      <listitem>
       <para>このレベルでは多数のディスクの管理と冗長性の両方を提供します。このレベルを使用するには、 3 台以上のディスクが必要です。いずれか 1 台のディスクが壊れても、データが失われることはありませんが、 2 台のディスクが同時に壊れてしまうと、データの復元は不可能になります。</para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>マルチパス</term>
      <listitem>
       <para>このモードでは、複数のコントローラを介して同じ物理デバイスにアクセスを行います。これはコントローラカードの障害に対して冗長性を提供するものです。このモードを使用するには、少なくとも 2 枚のカードが必要になります。</para>
      </listitem>
     </varlistentry>
    </variablelist>
    <para>LVM と同様に、 &ay; プロファイル内でのソフトウエア RAID 定義は、 2 つの部品から構成されています:</para>

    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>どのディスクやパーティションを RAID のメンバーとして使用するのかの設定。 RAID メンバーとしての設定は、各デバイス要素内で <literal>raid_name</literal> を設定して行います。</para>
     </listitem>
     <listitem>
      <para><literal>drive</literal> セクションによる RAID そのものの定義。</para>
     </listitem>
    </itemizedlist>

    <para>下記の例は、 1 台目のディスクに存在するパーティションと、 2 台目のディスクに存在するパーティションを RAID のメンバーとして、 RAID1 を構成する場合の例です:</para>
    <example>
     <title>RAID1 設定</title>
<screen>&lt;partitioning config:type="list"&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/sda&lt;/device&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;mount&gt;/&lt;/mount&gt;
        &lt;size&gt;20G&lt;/size&gt;
      &lt;/partition&gt;
      &lt;partition&gt;
        &lt;raid_name&gt;/dev/md/0&lt;/raid_name&gt;
        &lt;size&gt;max&lt;/size&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
    &lt;use&gt;all&lt;/use&gt;
  &lt;/drive&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/sdb&lt;/device&gt;
    &lt;disklabel&gt;none&lt;/disklabel&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;raid_name&gt;/dev/md/0&lt;/raid_name&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
    &lt;use&gt;all&lt;/use&gt;
  &lt;/drive&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/md/0&lt;/device&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;mount&gt;/home&lt;/mount&gt;
        &lt;size&gt;40G&lt;/size&gt;
      &lt;/partition&gt;
      &lt;partition&gt;
        &lt;mount&gt;/srv&lt;/mount&gt;
        &lt;size&gt;10G&lt;/size&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
    &lt;raid_options&gt;
      &lt;chunk_size&gt;4&lt;/chunk_size&gt;
      &lt;parity_algorithm&gt;left_asymmetric&lt;/parity_algorithm&gt;
      &lt;raid_type&gt;raid1&lt;/raid_type&gt;
    &lt;/raid_options&gt;
    &lt;use&gt;all&lt;/use&gt;
  &lt;/drive&gt;
&lt;/partitioning&gt;</screen>
    </example>

    <para>ソフトウエア RAID 内にパーティションを作成したくない場合は、通常のディスクと同様に <literal>disklabel</literal> を <literal>none</literal> に設定してください。下記の例では、単純化のために RAID の <literal>drive</literal> セクションのみを示しています:</para>

    <example>
     <title>パーティションを使用しない RAID1</title>
<screen>&lt;drive&gt;
  &lt;device&gt;/dev/md/0&lt;/device&gt;
  &lt;disklabel&gt;none&lt;/disklabel&gt;
  &lt;partitions config:type="list"&gt;
    &lt;partition&gt;
      &lt;mount&gt;/home&lt;/mount&gt;
      &lt;size&gt;40G&lt;/size&gt;
    &lt;/partition&gt;
  &lt;/partitions&gt;
  &lt;raid_options&gt;
    &lt;chunk_size&gt;4&lt;/chunk_size&gt;
    &lt;parity_algorithm&gt;left_asymmetric&lt;/parity_algorithm&gt;
    &lt;raid_type&gt;raid1&lt;/raid_type&gt;
  &lt;/raid_options&gt;
  &lt;use&gt;all&lt;/use&gt;
&lt;/drive&gt;</screen>
    </example>

   <sect3 os="sles;sled;osuse" xml:id="ay-partition-sw-raid-deprecated">
    <title>古い書式の使用</title>
    <para>インストーラの自己更新機能が有効化されている場合、 &productname; 15 でソフトウエア RAID のパーティションを作成することができます。ただし、それ以前のバージョンではこのような仕組みには対応していないため、ソフトウエア RAID の定義が少し異なることになります。</para>

    <para>本章では、後方互換性のために提供されている古い形式の設定について説明しています。</para>

    <para>古い形式で RAID を設定する場合、下記の点に注意してください:</para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>RAID デバイスは必ず <filename>/dev/md</filename> になります。</para>
     </listitem>
     <listitem>
      <para><literal>partition_nr</literal> プロパティは、 MD デバイスの番号を判断するために使用します。たとえば <literal>partition_nr</literal> に 0 を設定すると、 <filename>/dev/md/0</filename> が設定されます。複数の <literal>partition</literal> セクションを設定すると、複数のソフトウエア RAID ( <filename>/dev/md/0</filename> , <filename>/dev/md/1</filename> ,...) を作成する意味になります。</para>
     </listitem>
     <listitem>
      <para>RAID 関連の全てのオプションは、 <literal>raid_options</literal> 内に含める必要があります。</para>
     </listitem>
    </itemizedlist>

    <example>
     <title>古い書式の RAID1 設定</title>
<screen>&lt;partitioning config:type="list"&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/sda&lt;/device&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;partition_id config:type="integer"&gt;253&lt;/partition_id&gt;
        &lt;format config:type="boolean"&gt;false&lt;/format&gt;
        &lt;raid_name&gt;/dev/md0&lt;/raid_name&gt;
        &lt;raid_type&gt;raid1&lt;/raid_type&gt;
        &lt;size&gt;4G&lt;/size&gt;
      &lt;/partition&gt;

        &lt;!-- /dev/sda に配置する通常のパーティション設定 (例: /, swap)
                をここに記述します --&gt;

    &lt;/partitions&gt;
    &lt;use&gt;all&lt;/use&gt;
  &lt;/drive&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/sdb&lt;/device&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;format config:type="boolean"&gt;false&lt;/format&gt;
        &lt;partition_id config:type="integer"&gt;253&lt;/partition_id&gt;
        &lt;raid_name&gt;/dev/md0&lt;/raid_name&gt;
        &lt;size&gt;4gb&lt;/size&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
    &lt;use&gt;all&lt;/use&gt;
  &lt;/drive&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/md&lt;/device&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;filesystem config:type="symbol"&gt;ext4&lt;/filesystem&gt;
        &lt;format config:type="boolean"&gt;true&lt;/format&gt;
        &lt;mount&gt;/space&lt;/mount&gt;
        &lt;partition_id config:type="integer"&gt;131&lt;/partition_id&gt;
        &lt;partition_nr config:type="integer"&gt;0&lt;/partition_nr&gt;
        &lt;raid_options&gt;
          &lt;chunk_size&gt;4&lt;/chunk_size&gt;
          &lt;parity_algorithm&gt;left_asymmetric&lt;/parity_algorithm&gt;
        &lt;/raid_options&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
    &lt;use&gt;all&lt;/use&gt;
  &lt;/drive&gt;
&lt;/partitioning&gt;</screen>
    </example>
   </sect3>

   <sect3 xml:id="ay-raid-configuration">
    <title>RAID オプション</title>
    <para>下記のような XML 構造内に、必要な要素を追加していきます:</para>
<screen>&lt;partition&gt;
     &lt;raid_options&gt;
     ...
     &lt;/raid_options&gt;
     &lt;/partition&gt;</screen>
    
    <variablelist>
     <varlistentry>
      <term>chunk_size</term>
      <listitem>
<screen>&lt;chunk_size&gt;4&lt;/chunk_size&gt;</screen>
      </listitem>
     </varlistentry>
     
     <varlistentry>
      <term>parity_algorithm</term>
      <listitem>
       <para>設定可能な値は下記のとおりです:</para>
       <para><literal>left_asymmetric</literal> , <literal>left_symmetric</literal> , <literal>right_asymmetric</literal> , <literal>right_symmetric</literal> .</para>
       
       <para>RAID6 や RAID10 に対しては、下記の値を設定することができます:</para>
       <para><literal>parity_first</literal> , <literal>parity_last</literal> , <literal>left_asymmetric_6</literal> , <literal>left_symmetric_6</literal> , <literal>right_asymmetric_6</literal> , <literal>right_symmetric_6</literal> , <literal>parity_first_6</literal> , <literal>n2</literal> , <literal>o2</literal> , <literal>f2</literal> , <literal>n3</literal> , <literal>o3</literal> , <literal>f3</literal> .</para>
<screen>&lt;parity_algorithm&gt;left_asymmetric&lt;/parity_algorithm&gt;</screen>
      </listitem>
     </varlistentry>
     
     <varlistentry>
      <term>raid_type</term>
      <listitem>
       <para>値には <literal>raid0</literal> , <literal>raid1</literal> , <literal>raid5</literal> , <literal>raid6</literal> , <literal>raid10</literal> のいずれかを指定します。</para>
<screen>&lt;raid_type&gt;raid1&lt;/raid_type&gt;</screen>
       <para>既定値は <literal>raid1</literal> です。</para>
      </listitem>
     </varlistentry>
     
     <varlistentry>
      <term>device_order</term>
      <listitem>
       <para>この一覧には、物理デバイスの設定順序を指定します:</para>
<screen>&lt;device_order config:type="list"&gt;&lt;device&gt;/dev/sdb2&lt;/device&gt;&lt;device&gt;/dev/sda1&lt;/device&gt;...&lt;/device_order&gt;</screen>
       <para>この設定は任意設定で、既定ではアルファベット順です。</para>
      </listitem>
     </varlistentry>
     
    </variablelist>
    
   </sect3>
  </sect2>

  <sect2 xml:id="ay-partition-multipath">
<!-- this section differs from older releases, do not backport, 
      see https://github.com/SUSE/doc-sle/pull/535. (cjs, feb 4 2020) -->      
   <title>マルチパスサポート</title>
   <para>&ay; ではマルチパスデバイスを処理することができます。マルチパスデバイスを使用するには、まず <xref linkend="multipath-example"/> で説明しているように、マルチパスサポートの有効化を行う必要があります。それ以外にも、カーネルのコマンドラインに <literal>LIBSTORAGE_MULTIPATH_AUTOSTART=ON</literal> を追加してもかまいません。</para>

   <para os="sles;sled">ただし、 &sle; 12 とは異なり、ドライブセクションのタイプを <literal>CT_DMMULTIPATH</literal> にする必要はありません。代わりに <literal>CT_DISK</literal> を指定してください。ただし、従来バージョンとの互換性維持を目的として、いずれの値も同じ意味になっています。</para>

    <example xml:id="multipath-example">
     <title>マルチパスデバイスの使用</title>
     <screen><![CDATA[<general>
  <storage>
    <start_multipath config:type="boolean">true</start_multipath>
  <storage>
</general>
<partitioning>
  <drive>
    <partitions config:type="list">
      <partition>
        <size>20G</size>
        <mount>/</mount>
        <filesystem config:type="symbol">ext4</filesystem>
      </partition>
      <partition>
        <size>auto</size>
        <mount>swap</mount>
      </partition>
    </partitions>
    <type config:type="symbol">CT_DISK</type>
    <use>all</use>
  </drive>
</partitioning>]]></screen>
    </example>

    <para>デバイスを指定したい場合は、マルチパスデバイスを表わす World Wide Identifier (WWID) かデバイス名 (例: <literal>/dev/dm-0</literal> ) 、もしくは <literal>/dev/disk</literal> 以下のデバイスパスを指定してください。</para>

    <para>たとえば <xref linkend="multipath-ll-output"/> のような <literal>multipath</literal> コマンドの出力があった場合、 <literal>/dev/mapper/14945540000000000f86756dce9286158be4c6e3567e75ba5</literal> のほか、 <literal>/dev/dm-3</literal> や <literal>/dev/disk</literal> 以下のデバイスパス (例: <xref linkend="multipath-wwid-example"/>) を指定することができるほか、いずれかのデバイスパス (例: <literal>/dev/sda</literal> or <literal>/dev/sdb</literal> を指定してもかまいません。</para>

    <example xml:id="multipath-ll-output">
     <title>マルチパスデバイスの列挙</title>
     <screen><![CDATA[# multipath -l
14945540000000000f86756dce9286158be4c6e3567e75ba5 dm-3 ATA,VIRTUAL-DISK
size=40G features='0' hwhandler='0' wp=rw
|-+- policy='service-time 0' prio=1 status=active
| `- 2:0:0:0 sda 8:0  active ready running
`-+- policy='service-time 0' prio=1 status=enabled
  `- 3:0:0:0 sdb 8:16 active ready running]]></screen>
    </example>

    <example xml:id="multipath-wwid-example">
     <title>WWID を使用してマルチパスデバイスを指定する場合の例</title>
     <screen><![CDATA[<drive>
  <partitions config:type="list">
    <device>/dev/mapper/14945540000000000f86756dce9286158be4c6e3567e75ba5</device>
    <partition>
      <size>20G</size>
      <mount>/</mount>
      <filesystem config:type="symbol">ext4</filesystem>
    </partition>
  </partitions>
  <type config:type="symbol">CT_DISK</type>
  <use>all</use>
</drive>]]></screen>
    </example>
  </sect2>

  <sect2 xml:id="ay-partition-bcache">
   <title>&bcache; の設定</title>
   <para>&bcache; は複数の高速なドライブを利用して、 1 つまたは複数の低速なドライブを高速化するための仕組みです。たとえば特定の高速なドライブをキャッシュとして使用し、巨大で遅いドライブの性能を改善したりすることができます。</para>

   <para>&productname; での bcache に関する詳細は、 <link xlink:href="https://www.suse.com/c/combine-the-performance-of-solid-state-drive-with-the-capacity-of-a-hard-drive-with-bcache-and-yast/"/> (英語) に書かれているブログの記事をお読みください。</para>

   <para>&bcache; のデバイスを設定するには、 &ay; 側で下記のようなプロファイル設定が必要となります:</para>

   <itemizedlist>
    <listitem>
     <para>(遅いほうの) ブロックデバイスを <emphasis>バッキングデバイス</emphasis> として設定するには、 <literal>bcache_backing_for</literal> 要素を使用します。</para>
    </listitem>
    <listitem>
     <para>(早いほうの) ブロックデバイスを <emphasis>キャッシュデバイス</emphasis> して設定するには、 <literal>bcache_caching_for</literal> 要素を使用します。複数のドライブの速度を上げるために、 1 台のデバイスを使用するような設定も行うことができます。</para>
    </listitem>
    <listitem>
     <para>&bcache; デバイスの配置方法を指定するには、 <literal>drive</literal> セクション内に <literal>type</literal> 要素が <literal>CT_BCACHE</literal> であるものを設定します。 &bcache; デバイス内には、パーティションを含めることもできます。</para>
    </listitem>
   </itemizedlist>

   <example>
    <title>&bcache; の定義</title>
<screen>&lt;partitioning config:type="list"&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/sda&lt;/device&gt;
    &lt;type config:type="symbol"&gt;CT_DISK&lt;/type&gt;
    &lt;use&gt;all&lt;/use&gt;
    &lt;enable_snapshots config:type="boolean"&gt;true&lt;/enable_snapshots&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;filesystem config:type="symbol"&gt;btrfs&lt;/filesystem&gt;
        &lt;mount&gt;/&lt;/mount&gt;
        &lt;create config:type="boolean"&gt;true&lt;/create&gt;
        &lt;size&gt;max&lt;/size&gt;
      &lt;/partition&gt;
      &lt;partition&gt;
        &lt;filesystem config:type="symbol"&gt;swap&lt;/filesystem&gt;
        &lt;mount&gt;swap&lt;/mount&gt;
        &lt;create config:type="boolean"&gt;true&lt;/create&gt;
        &lt;size&gt;2GiB&lt;/size&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
  &lt;/drive&gt;

  &lt;drive&gt;
    &lt;type config:type="symbol"&gt;CT_DISK&lt;/type&gt;
    &lt;device&gt;/dev/sdb&lt;/device&gt;
    &lt;disklabel&gt;msdos&lt;/disklabel&gt;
    &lt;use&gt;all&lt;/use&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;!-- It can serve as caching device for several bcaches --&gt;
        &lt;bcache_caching_for config:type="list"&gt;
          &lt;listentry&gt;/dev/bcache0&lt;/listentry&gt;
        &lt;/bcache_caching_for&gt;
        &lt;size&gt;max&lt;/size&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
  &lt;/drive&gt;

  &lt;drive&gt;
    &lt;type config:type="symbol"&gt;CT_DISK&lt;/type&gt;
    &lt;device&gt;/dev/sdc&lt;/device&gt;
    &lt;use&gt;all&lt;/use&gt;
    &lt;disklabel&gt;msdos&lt;/disklabel&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;!-- It can serve as backing device for one bcache --&gt;
        &lt;bcache_backing_for&gt;/dev/bcache0&lt;/bcache_backing_for&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
  &lt;/drive&gt;

  &lt;drive&gt;
    &lt;type config:type="symbol"&gt;CT_BCACHE&lt;/type&gt;
    &lt;device&gt;/dev/bcache0&lt;/device&gt;
    &lt;bcache_options&gt;
      &lt;cache_mode&gt;writethrough&lt;/cache_mode&gt;
    &lt;/bcache_options&gt;
    &lt;use&gt;all&lt;/use&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;mount&gt;/data&lt;/mount&gt;
        &lt;size&gt;20GiB&lt;/size&gt;
      &lt;/partition&gt;
      &lt;partition&gt;
        &lt;mount&gt;swap&lt;/mount&gt;
        &lt;filesystem config:type="symbol"&gt;swap&lt;/filesystem&gt;
        &lt;size&gt;1GiB&lt;/size&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
  &lt;/drive&gt;
&lt;/partitioning&gt;
</screen>
</example>

   <para>現時点では、 <literal>bcache_options</literal> で使用することのできるオプションは <literal>cache_mode</literal> だけとなります。</para>
   <variablelist>
    <varlistentry>
     <term>cache_mode</term>
     <listitem>
      <para>&bcache; のキャッシュモードを設定します。設定可能な値は下記のとおりです:</para>
      <itemizedlist>
       <listitem>
        <para><literal>writethrough</literal></para>
       </listitem>
       <listitem>
        <para><literal>writeback</literal></para>
       </listitem>
       <listitem>
        <para><literal>writearound</literal></para>
       </listitem>
       <listitem>
        <para><literal>none</literal></para>
       </listitem>
      </itemizedlist>
<screen>&lt;cache_mode&gt;writethrough&lt;/cache_mode&gt;</screen>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  <sect2 xml:id="ay-multidevice-btrfs">
   <title>マルチデバイス型 btrfs の設定</title>

   <para>btrfs では複数のデバイスにまたがった単一ボリュームを作成することができます。この仕組みにより、 Linux カーネル内蔵の <command>mdraid</command> サブシステムのようなソフトウエア RAID に似た実装を使用することができるようになります。 <emphasis>マルチデバイス型の btrfs</emphasis> には、他の RAID 実装では提供されていないいくつかの利点があります。たとえば一方の RAID レベルから他方の RAID レベルに動的に移行できる機能や、ファイル単位での RAID レベルの設定などがあります。ただし、 &productname; &product-ga; SP&product-sp; では、これら全ての機能をサポートしているわけではないことに注意してください。</para>
    
   <para>&ay; では <literal>CT_BTRFS</literal> を指定することで、マルチデバイス型の btrfs を設定することができます。また、 <literal>device</literal> 属性では任意の名前を設定して、マルチデバイス型の btrfs を識別することができます。</para>

   <para>RAID として使用する場合は、まず必要な全てのブロックデバイス (パーティション、 LVM 論理ボリュームなど) を作成しておいて、それらを btrfs ファイルシステムに割り当てておく必要があります。</para>

   <para>下記の例では、シンプルなマルチデバイス型 btrfs 設定を示しています:</para>

   <example>
    <title>マルチデバイス型 btrfs の設定</title>
      <screen>&lt;partitioning config:type="list"&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/sda&lt;/device&gt;
    &lt;disklabel&gt;none&lt;/disklabel&gt;
    &lt;partitions&gt;
      &lt;partition&gt;
        &lt;btrfs_name&gt;root_fs&lt;/btrfs_name&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
    &lt;use&gt;all&lt;/use&gt;
  &lt;/drive&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/sdb&lt;/device&gt;
    &lt;disklabel&gt;gpt&lt;/disklabel&gt;
    &lt;partitions&gt;
      &lt;partition&gt;
        &lt;partition_nr&gt;1&lt;/partition_nr&gt;
        &lt;size&gt;4gb&lt;/size&gt;
        &lt;filesystem&gt;ext4&lt;/filesystem&gt;
        &lt;btrfs_name&gt;root_fs&lt;/btrfs_name&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
    &lt;use&gt;all&lt;/use&gt;
  &lt;/drive&gt;
  &lt;drive&gt;
    &lt;device&gt;root_fs&lt;/device&gt;
    &lt;type config:type="symbol"&gt;CT_BTRFS&lt;/type&gt;
    &lt;partitions&gt;
      &lt;partition config:type="list&gt;
        &lt;mount&gt;/&lt;/mount&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
    &lt;btrfs_options&gt;
      &lt;raid_leve&gt;raid1&lt;/raid_level&gt;
      &lt;metadata_raid_leve&gt;raid1&lt;/metadata_raid_level&gt;
    &lt;/btrfs_options&gt;
  &lt;/drive&gt;
&lt;/partitioning&gt;</screen>
   </example>

   <para>サポート対象となるデータおよびメタデータの RAID レベルは、 <literal>default</literal> , <literal>single</literal> , <literal>dup</literal> , <literal>raid0</literal> , <literal>raid1</literal> , <literal>raid10</literal> のいずれかです。既定ではファイルシステムのメタデータは 2 つのデバイスに複製され、データは全てのデバイスに複製されます。デバイスが 1 つしか存在しない場合、メタデータは 1 つのデバイス内で複製されます。</para>
   
<!--lproven 2020-06-30: omitting raid5 & raid6 for now as unsupported in 15SP2
as per ancorgs' comment on Github-->
 
   <para>マルチデバイス型の btrfs ファイルシステムを設定する際には、下記の点に注意してください:</para>

   <itemizedlist>
    <listitem>
     <para>マルチデバイス型の btrfs ファイルシステム内に組み込まれるよう、必要なデバイスに対しては <literal>btrfs_name</literal> 属性を設定する必要があります。</para>
    </listitem>
    <listitem>
     <para>btrfs 関連のオプションを設定する場合は、 <literal>CT_BTRFS</literal> ドライブの <literal>btrfs_options</literal> リソース内に記述します。</para>
    </listitem>
   </itemizedlist>
  </sect2>


  <sect2 xml:id="ay-partition-nfs">
   <title>NFS の設定</title>

   <para>&ay; では、 &productname; を <emphasis>Network File System</emphasis> (NFS) の共有内にインストールすることもできます。これを実現するには、まず <literal>CT_NFS</literal> の種類でドライブを作成し、デバイス名として NFS の共有名を ( <replaceable>サーバ:パス</replaceable> ) の形式で指定します。マウントポイントに関する情報は、最初のパーティションセクション内に記述します。なお、 NFS ドライブの場合、最初のパーティションしか使用されないことに注意してください。</para>
   <para os="sles;sled;osuse">システムをインストールした後の NFS クライアントやサーバの設定方法については、 <xref linkend="ay-nfs"/> をお読みください。</para>

   <example>
    <title>NFS 共有の定義</title>
      <screen>
        &lt;partitioning config:type="list"&gt;
          &lt;drive&gt;
            &lt;device&gt;192.168.1.1:/exports/root_fs&lt;/device&gt;
            &lt;type config:type="symbol"&gt;CT_NFS&lt;/type&gt;
            &lt;use&gt;all&lt;/use&gt;
            &lt;partitions config:type="list"&gt;
              &lt;partition&gt;
                &lt;mount&gt;/&lt;/mount&gt;
                &lt;fstopt&gt;nolock&lt;/fstopt&gt;
              &lt;/partition&gt;
            &lt;/partitions&gt;
          &lt;/drive&gt;
        &lt;/partitioning&gt;
      </screen>
    </example>
  </sect2>

  <sect2 xml:id="ay-partition-tmpfs">
   <title><literal>tmpfs</literal> の設定</title>

   <para>&ay; では <literal>type</literal> 要素に <literal>CT_TMPFS</literal> を指定することで、 <literal>tmpfs</literal> 仮想ファイルシステムを設定することができます。この場合、 1 つの <literal>partition</literal> セクションが 1 つの <literal>tmpfs</literal> ファイルシステムを表わすように設定します。</para>

   <example>
    <title><literal>tmpfs</literal> の設定例</title>
    <screen>
      &lt;partitioning config:type="list"&gt;
        &lt;drive&gt;
          &lt;type config:type="symbol"&gt;CT_TMPFS&lt;/type&gt;
          &lt;partitions config:type="list"&gt;
            &lt;partition&gt;
              &lt;mount&gt;/srv&lt;/mount&gt;
              &lt;fstopt&gt;size=512M&lt;/fstopt&gt;
            &lt;/partition&gt;
            &lt;partition&gt;
              &lt;mount&gt;/temp&lt;/mount&gt;
            &lt;/partition&gt;
          &lt;/partitions&gt;
        &lt;drive&gt;
      &lt;partitioning&gt;
     </screen>
   </example>

   <para><literal>tmpfs</literal> は ext4 や btrfs などの通常のファイルシステムとは異なり、 <literal>mount</literal> 要素 (必須) と <literal>fstopt</literal> 要素のみを指定します。 <literal>fstopt</literal> 要素はサイズや制限、モードなどのファイルシステムの属性を設定します。設定可能な値について、詳しくは <literal>tmpfs</literal> のマニュアルページをお読みください。</para>
  </sect2>

   <sect2 os="sles" xml:id="ay-partition-s390">
    <title>&zseries; 固有の設定</title>
    <para/>
    <sect3 xml:id="ay-partition-s390-dasd">
     <title>DASD ディスクの設定</title>
     <para>下記のような XML 構造内に、必要な要素を追加していきます:</para>
<screen>&lt;dasd&gt;
 &lt;devices config:type="list"&gt;
  &lt;listentry&gt;
   ...
  &lt;/listentry&gt;
 &lt;/devices&gt;
&lt;/dasd&gt;</screen>
     <para>上記のような内容を &lt;profile&gt; セクション内に記述します。それぞれのディスクは、それぞれ別々の &lt;listentry&gt; ... &lt;/listentry&gt; セクション内に記述する必要があります。</para>

     <variablelist>
      <title>DASD 設定</title>
      
      <varlistentry>
       <term>device</term>
       <listitem>
        <para><literal>DASD</literal> だけを指定することができます</para>
<screen>&lt;device&gt;DASD&lt;/dev_name&gt;</screen>
       </listitem>
      </varlistentry>
      
      <varlistentry>
       <term>dev_name</term>
       <listitem>
        <para>このセクションで設定したいデバイス ( <literal>dasd<replaceable>N</replaceable></literal> ) を指定します。</para>
<screen>&lt;dev_name&gt;/dev/dasda&lt;/dev_name&gt;</screen>
        <para>任意指定ですが、できれば指定しておくことをお勧めします。何も指定しない場合、 &ay; がデバイスを自動的に判断します。</para>
       </listitem>
      </varlistentry>
      
      <varlistentry>
       <term>channel</term>
       <listitem>
        <para>ディスクにアクセスする際のチャネルを指定します。</para>
<screen>&lt;channel&gt;0.0.0150&lt;/channel&gt;</screen>
        <para>必須です。</para>
       </listitem>
      </varlistentry>
      
      <varlistentry>
       <term>diag</term>
       <listitem>
        <para><literal>DIAG</literal> を使用するかどうかを指定します。指定可能な値は <literal>true</literal> (有効化) もしくは <literal>false</literal> (無効化) のいずれかです。</para>
<screen>&lt;diagconfig:type="boolean"&gt;true&lt;/diag&gt;</screen>
         <para>任意指定です。</para>
       </listitem>
      </varlistentry>
      
     </variablelist>
    </sect3>
    
    <sect3 xml:id="ay-partition-s390-zfcp">
     <title>zFCP ディスクの設定</title>
     <para>下記のような XML 構造内に、必要な要素を追加していきます:</para>
<screen>&lt;profile&gt;
  &lt;zfcp&gt;
    &lt;devices config:type="list"&gt;
      &lt;listentry&gt;
        ...
      &lt;/listentry&gt;
    &lt;/devices&gt;
  &lt;/zfcp&gt;
&lt;profile&gt;</screen>
     <para>なお、各ディスクはそれぞれ別々の <literal>listentry</literal> セクション内に記述します。</para>

     <variablelist>
      <varlistentry>
       <term>controller_id</term>
       <listitem>
       <para>チャネル番号</para>
<screen>&lt;controller_id&gt;0.0.fc00&lt;/controller_id&gt;</screen>
       </listitem>
      </varlistentry>
     </variablelist>
     
     <para><literal>controller_id</literal> の要素が必要です。</para>
     <para>ここには 2 種類の任意要素を設定することができます。それぞれ <literal>wwpn</literal> (Worldwide Port Number; SCSI デバイスが接続されているターゲットのポート) と、 <literal>fcp_lun</literal> (SCSI デバイスの論理ユニット番号) です。 NPIV (Node Port ID Virtualization) モードで FCP デバイスを動作させている場合、これらの要素は必須ではありませんし、 zfcp モジュールのパラメータとして <literal>allow_lun_scan</literal> を 1 (既定値) に設定している場合、 zfcp デバイスドライバ側で自動的に LUN を検出するようになります。</para>
     <para>自動的な LUN 検出が利用できない場合は、それぞれ <literal>wwpn</literal> と <literal>fcp_lun</literal> のオプションを指定してください。</para>

     <variablelist>
      <varlistentry>
        <term>wwpn</term>
       <listitem>
       <para>Worldwide port number</para>
<screen>&lt;wwpn&gt;0x500507630300c562&lt;/wwpn&gt;</screen>
       </listitem>
      </varlistentry>
      <varlistentry>
        <term>fcp_lun</term>
       <listitem>
       <para>論理ユニット番号 (LUN)</para>
<screen>&lt;fcp_lun&gt;0x4010403200000000&lt;/fcp_lun&gt;</screen>
       </listitem>
      </varlistentry>
     </variablelist>
     
     <para>詳しくは IBM 社提供のドキュメンテーション (<link xlink:href=" https://www.ibm.com/docs/en/linux-on-systems?topic=wsd-configuring-devices"/>) をお読みください。</para>
    </sect3>
   </sect2>
  </sect1>
