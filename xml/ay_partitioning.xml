<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 [
<!ENTITY % entities SYSTEM "entity-decl.ent">
%entities;
]>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0" xml:id="CreateProfile-Partitioning">
  <title>パーティション設定</title>

 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>

  <para>パーティション設定に対して、 &ay; では 3 つの種類に分類して扱っています:</para>

   <itemizedlist mark="bullet" spacing="normal">
    <listitem>
     <para>自動的なパーティション設定。ユーザ側にはパーティション設定に対する問い合わせを行なわず、 &ay; 側で設定を全て賄うことを指します。</para>
    </listitem>
    <listitem>
     <para>ガイド付きのパーティション設定。ユーザ側で LVM を使用するかどうかなどの基本設定を行なうものの、詳しいパーティション設定やボリュームグループの設定など、詳細箇所については行なわないものを指します。</para>
    </listitem>
    <listitem>
     <para>熟練者向けのパーティション設定。ユーザ側で詳細な配置の設定を行なうことを指します。ただし、全ての設定までを指定する必要はなく、必要に応じて環境に合わせた既定値を提案するものとします。</para>
    </listitem>
   </itemizedlist>

   <para>これらの分類は、通常のインストーラでも選択することができます。 <emphasis>ガイド付き設定</emphasis> を使用すれば詳細なパーティション設定画面を飛ばして &yast; 側に設定を任せることができますし、 <emphasis>熟練者向けパーティション設定</emphasis> を使用すれば、詳細な配置を設定することができます。</para>

   <sect2 xml:id="CreateProfile-Automatic-Partitioning">
    <title>自動的なパーティション設定</title>

    <para>&ay; では、ユーザに対して一切問い合わせを行なわずに賢くパーティション設定を行なうことができます。インストールする製品にも依存しますが、 &ay; では通常、ルートファイルシステムに対して btrfs を、個別の <literal>/home</literal> パーティションに対して XFS をそれぞれ作成し、スワップパーティションを加えた 3 つのパーティションを作成します。これに加えて、アーキテクチャによっては起動に必要なパーティション (BIOS GRUB パーティションなど) を追加で作成することもあります。</para>

    <para>しかしながら、これらの既定値はディスク領域などの状況によっても変化します。たとえばディスク容量が少ない場合、個別の <literal>/home</literal> パーティションが作成されなかったりします。</para>

    <para>これらの既定値を調整したい場合は、 <xref linkend="CreateProfile-Guided-Partitioning"/> で説明している設定項目を調整してください。</para>
   </sect2>

   <sect2 xml:id="CreateProfile-Guided-Partitioning">
<!-- this section differs from older releases, do not backport, 
      see https://github.com/SUSE/doc-sle/pull/513. (cjs, feb 4 2020) -->       
    <title>ガイド付きのパーティション設定</title>

    <para>&ay; には、一切ユーザに対して問い合わせを行なうことなくパーティション設定を行なう機能がありますが、いくつかの一般的なパラメータのみを指定しておいて、残りを &ay; に任せたほうが都合の良い場合があります。たとえば詳細なパラメータを指定せずに LVM を使用したい場合や、ファイルシステムの暗号化を行ないたいような場合がそれにあたります。これは通常のインストール処理でも同様で、ガイド付きの設定を利用することで、基本的なパラメータのみを指定したパーティション設定を行なうことができます。</para>

    <para><xref linkend="example-lvm-guided"/> で示している <literal>storage</literal> セクションでは、 LVM を利用するとともに、必要かどうかにかかわらず全ての Windows パーティションを削除するような設定を示しています。</para>

    <example xml:id="example-lvm-guided">
     <title>LVM ベースのガイド付きパーティション設定</title>
     <screen>&lt;general&gt;
   &lt;storage&gt;
     &lt;proposal&gt;
       &lt;lvm config:type="boolean"&gt;true&lt;lvm&gt;
       &lt;windows_delete_mode config:type="symbol"&gt;all&lt;windows_delete_mode&gt;
     &lt;/proposal&gt;
   &lt;storage&gt;
&lt;general&gt;</screen>
    </example>

    <variablelist>
     <varlistentry>
      <term>lvm</term>
      <listitem>
       <para>LVM ベースの提案を作成するかどうかを指定します。既定値は <literal>false</literal> です。</para>
       <screen>&lt;lvm config:type="boolean"&gt;true&lt;/lvm&gt;</screen>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>resize_windows</term>
      <listitem>
       <para><literal>true</literal> に設定した場合、 &ay; はインストールに必要な領域を確保するため、 Windows のパーティションのサイズ変更を行なうようになります。</para>
       <screen>&lt;resize_windows config:type="boolean"&gt;false&lt;/resize_windows&gt;</screen>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>windows_delete_mode</term>
      <listitem>
        <itemizedlist mark="bullet" spacing="normal">
         <listitem>
          <para><literal>none</literal> を指定すると、 Windows パーティションを削除しないようになります。</para>
         </listitem>
         <listitem>
          <para><literal>ondemand</literal> を指定すると、必要に応じて Windows パーティションを削除するようになります。</para>
         </listitem>
         <listitem>
          <para><literal>all</literal> を指定すると、全ての Windows パーティションを削除するようになります。</para>
         </listitem>
        </itemizedlist>
       <screen>&lt;windows_delete_mode config:type="symbol"&gt;ondemand&lt;/windows_delete_mode&gt;</screen>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>linux_delete_mode</term>
      <listitem>

        <itemizedlist mark="bullet" spacing="normal">
         <listitem>
          <para><literal>none</literal> を指定すると、 Linux パーティションを削除しないようになります。</para>
         </listitem>
         <listitem>
          <para><literal>ondemand</literal> を指定すると、必要に応じて Linux パーティションを削除するようになります。</para>
         </listitem>
         <listitem>
          <para><literal>all</literal> を指定すると、全ての Linux パーティションを削除するようになります。</para>
         </listitem>
        </itemizedlist>
       <screen>&lt;linux_delete_mode config:type="symbol"&gt;ondemand&lt;/linux_delete_mode&gt;</screen>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>other_delete_mode</term>
      <listitem>
        <itemizedlist mark="bullet" spacing="normal">
         <listitem>
          <para><literal>none</literal> を指定すると、その他のパーティションを削除しないようになります。</para>
         </listitem>
         <listitem>
          <para><literal>ondemand</literal> を指定すると、必要に応じてその他のパーティションを削除するようになります。</para>
         </listitem>
         <listitem>
          <para><literal>all</literal> を指定すると、全てのその他のパーティションを削除するようになります。</para>
         </listitem>
        </itemizedlist>
       <screen>&lt;other_delete_mode config:type="symbol"&gt;ondemand&lt;/other_delete_mode&gt;</screen>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>encryption_password</term>
      <listitem>
       <para>指定したパスワードで暗号化を行なうようにします。既定では暗号化を行ないません。</para>
       <screen>&lt;encryption_password&gt;some-secret&lt;/encryption_password&gt;</screen>
      </listitem>
     </varlistentry>
    </variablelist>
   </sect2>

   <sect2 xml:id="CreateProfile-Expert-Partitioning">
    <title>熟練者向けパーティション設定</title>

    <para>ガイド付きパーティション設定よりも詳しく設定を行ないたい場合は、 &ay; のプロファイル内に <literal>partitioning</literal> セクションを挿入して指定を行ないます。ただし、 &ay; では全ての詳細までを指定する必要はありません。不完全な指定を行なっていても、適切な既定値を割り当てて設定するようになっています。</para>

    <para><literal>partitioning</literal> セクション内には <literal>drive</literal> 要素の羅列を設定します。それぞれの <literal>drive</literal> 要素には、ディスクや LVM のボリュームグループ、 RAID やマルチデバイス型の btrfs ファイルシステムなどの配置要素を設定します。</para>

    <para><xref linkend="example-partitioning"/> の例では、 &ay; に対して、ディスク全体を使用して <literal>/</literal> , <literal>/home</literal> , <literal>swap</literal> の各パーティションを作成する設定例を示しています。なお、パーティション内で使用すべきファイルシステムの情報などの指定が省略されていることに注意してください。このような指定を行なった場合は、 &ay; 側で自動的に判断して設定を行ないます。</para>

    <example xml:id="example-partitioning">
     <title><literal>/</literal> , <literal>/home</literal> , <literal>swap</literal> の各パーティションを作成する場合の例</title>
     <screen>&lt;partitioning config:type="list"&gt;
  &lt;drive&gt;
    &lt;use&gt;all&lt;/use&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;mount&gt;/&lt;/mount&gt;
        &lt;size&gt;20GiB&lt;/size&gt;
      &lt;/partition&gt;
      &lt;partition&gt;
        &lt;mount&gt;/home&lt;/mount&gt;
        &lt;size&gt;max&lt;/size&gt;
      &lt;/partition&gt;
      &lt;partition&gt;
        &lt;mount&gt;swap&lt;/mount&gt;
        &lt;size&gt;1GiB&lt;/size&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
  &lt;/drive&gt;</screen>
    </example>

    <tip xml:id="ay-boot-partition">
     <title>起動パーティションの提案</title>
     <para>&ay; では、プロファイル内に指定されたパーティション設定で問題なく起動できるかどうかを自動的に判断します。もしも起動できないものと判断された場合は、必要なパーティションを自動的に追加します。そのため、起動用のパーティションが必要かどうかがわからないような状況でも、 &ay; に設定を任せておけば正しい選択を行なってくれることになります。</para>
    </tip>

    <sect3 xml:id="CreateProfile-Partitioning-config">
     <title>ドライブの設定</title>
     <para>下記のような XML 構造内に、必要な要素を追加していきます:</para>

     <screen>&lt;profile&gt;
  &lt;partitioning config:type="list"&gt;
    &lt;drive&gt;
     ...
    &lt;/drive&gt;
  &lt;/partitioning&gt;
&lt;/profile&gt;</screen>
     <informaltable>
      <tgroup cols="3">
       <thead>
        <row>
         <entry>
          <para>属性</para>
         </entry>
         <entry>
          <para>値</para>
         </entry>
         <entry>
          <para>説明</para>
         </entry>
        </row>
       </thead>
       <tbody>
        <row>
         <entry>
          <para><literal>device</literal></para>
         </entry>
         <entry>
          <para>このセクションで設定したいデバイスを指定します。 <filename>/dev/disk/by-id/ata-WDC_WD3200AAKS-75L9A0_WD-WMAV27368122</filename> のような ID 形式の名前を指定するか、 <filename>/dev/disk/by-path/pci-0001:00:03.0-scsi-0:0:0:0</filename> のように <emphasis>by-path</emphasis> 形式で指定を行なうことで、一貫性のある名前を使用することができるようになります。</para>
          <screen>&lt;device&gt;/dev/sda&lt;/device&gt;</screen>
          <para>ボリュームグループやソフトウエア RAID 、 &bcache; デバイスの場合は、インストール後のシステムで使用するデバイス名は別のものになります (既存のデバイスとの衝突を避けるためのものです) 。</para>
          <para>マルチパスデバイスの扱いについて、詳しくは <xref linkend="ay-partition-multipath"/> をお読みください。</para>
         </entry>
         <entry>
          <para>任意指定です。何も指定しない場合、 &ay; は自動的にデバイスを判断します。判断を調整する方法については、 <xref linkend="ay-partitioning-skip-devices"/> をお読みください。</para>
          <para>値に <literal>ask</literal> を指定すると、 &ay; はインストール時に使用するデバイスをユーザに対して尋ねるようになります。</para>
         </entry>
        </row>
        <row>
         <entry>
          <para><literal>initialize</literal></para>
         </entry>
         <entry>
          <para><literal>true</literal> に設定すると、 &ay; がパーティションの計算を行なう前に、パーティションテーブルを消去するようになります。</para>
          <screen>&lt;initialize config:type="boolean"&gt;true&lt;/initialize&gt;</screen>
         </entry>
         <entry>
          <para>任意指定です。既定値は <literal>false</literal> です。</para>
         </entry>
        </row>
        <row>
         <entry>
          <para><literal>partitions</literal></para>
         </entry>
         <entry>
          <para>&lt;partition&gt; 項目を入れる箇所です (詳しくは <xref linkend="ay-partition-configuration"/> をお読みください) 。</para>
          <screen>&lt;partitions config:type="list"&gt;
          &lt;partition&gt;...&lt;/partition&gt;
          ...
          &lt;/partitions&gt;</screen>
         </entry>
         <entry>
          <para>任意指定です。何もパーティションを指定しない場合、 &ay; は適切なパーティション設定を自動で作成します (詳しくは <xref linkend="ay-auto-partitioning"/> をお読みください) 。</para>
         </entry>
        </row>
        <row>
         <entry>
          <para><literal>pesize</literal></para>
         </entry>
         <entry>
          <para>LVM の場合にのみ意味がある値です。</para>
          <screen>&lt;pesize&gt;8M&lt;/pesize&gt;</screen>
         </entry>
         <entry>
          <para>任意指定です。 LVM ボリュームグループの場合、 4M が既定値となります。</para>
         </entry>
        </row>
        <row>
         <entry>
          <para><literal>use</literal></para>
         </entry>
         <entry>
          <para>&ay; がハードディスクのパーティション設定を行なう際の方針を指定します:</para>
          <para>下記の中からいずれかを指定します:</para>
          <itemizedlist mark="bullet" spacing="normal">
           <listitem>
            <para><literal>all</literal>: 新しいパーティションを作成する際、ディスク全体を使用するようにします。</para>
           </listitem>
           <listitem>
            <para><literal>linux</literal>: 既存の Linux パーティションのみを使用します。</para>
           </listitem>
           <listitem>
            <para><literal>free</literal>: デバイス内の未使用領域のみを使用し、それ以外のパーティションについては何も変更しないようにします。</para>
           </listitem>
           <listitem>
            <para>1,2,3 (使用すべきパーティションの番号をカンマ区切りで指定します) 。</para>
           </listitem>
          </itemizedlist>
         </entry>
         <entry>
          <para>このパラメータは指定しておくべきものです。</para>
         </entry>
        </row>
        <row>
         <entry>
          <para><literal>type</literal></para>
         </entry>
         <entry>
          <para><literal>drive</literal> の種類を指定します:</para>
          <para>下記の中からいずれかを指定します:</para>
          <itemizedlist mark="bullet" spacing="normal">
           <listitem>
            <para><literal>CT_DISK</literal>: 物理的なハードディスク (既定値)</para>
           </listitem>
           <listitem>
            <para><literal>CT_LVM</literal>: LVM ボリュームグループ</para>
           </listitem>
           <listitem>
            <para><literal>CT_RAID</literal>: ソフトウエア RAID デバイス</para>
           </listitem>
           <listitem>
            <para><literal>CT_BCACHE</literal>: ソフトウエア &bcache; デバイス</para>
           </listitem>
          </itemizedlist>
          <screen>&lt;type config:type="symbol"&gt;CT_LVM&lt;/type&gt;</screen>
         </entry>
         <entry>
          <para>任意指定です。通常の物理ハードディスクの場合、既定値は <literal>CT_DISK</literal> になります。</para>
         </entry>
        </row>
        <row>
         <entry>
          <para><literal>disklabel</literal></para>
         </entry>
         <entry>
          <para>パーティションテーブルの種類を選択します。</para>
          <para>下記の中からいずれかを指定します:</para>
          <itemizedlist mark="bullet" spacing="normal">
           <listitem>
            <para><literal>msdos</literal></para>
           </listitem>
           <listitem>
            <para><literal>gpt</literal></para>
           </listitem>
           <listitem>
            <para><literal>none</literal> (無し)</para>
           </listitem>
          </itemizedlist>
          <screen>&lt;disklabel&gt;gpt&lt;/disklabel&gt;</screen>
         </entry>
         <entry>
          <para>任意指定です。既定では &yast; 側で自動的に判断します。異なる種類のパーティションテーブルが既に存在している場合、そのままにしておくべきパーティションや再利用可能なパーティションが含まれている場合を除き、指定した種類のパーティションテーブルを再作成します。何もパーティションを作成せずにディスクを使用したい場合は、この要素を <literal>none</literal> にしてください。</para>
         </entry>
        </row>
        <row>
         <entry>
          <para><literal>keep_unknown_lv</literal></para>
         </entry>
         <entry>
          <para>type=CT_LVM のドライブでのみ意味のある項目です。論理ボリュームグループを再利用している場合、この値を <literal>true</literal> に設定すると、そのグループ内に存在する全ての既存論理ボリュームは、それらが &lt;partitioning&gt; で指定されている場合を除き、何も変更が加えられないようになります。そのため、そのままにしておくべき論理ボリュームについては、何も指定しなくて良いことになります。</para>
          <screen>&lt;keep_unknown_lv config:type="boolean"
          &gt;false&lt;/keep_unknown_lv&gt;</screen>
         </entry>
         <entry>
          <para>任意指定です。既定値は <literal>false</literal> です。</para>
         </entry>
        </row>
        <row>
         <entry>
          <para><literal>enable_snapshots</literal></para>
         </entry>
         <entry>
          <para><literal>/</literal> にマウントされている btrfs ファイルシステムに対して、スナップショットを有効化します (その他のファイルシステムや、 <literal>/</literal> にマウントされていない btrfs ファイルシステムには適用されません) 。</para>
          <screen>&lt;enable_snapshots config:type="boolean"
          &gt;false&lt;/enable_snapshots&gt;</screen>
         </entry>
         <entry>
          <para>任意指定です。既定値は <literal>true</literal> です。</para>
         </entry>
        </row>
       </tbody>
      </tgroup>
     </informaltable>

     <important>
      <title>データ損失への警告</title>
      <para><literal>use</literal> プロパティに設定した値に従って、既存のデータとパーティションの取り扱いが決まります。このプロパティに <literal>all</literal> を指定すると、ディスク全体が消去されます。いずれかのパーティション内に重要なデータが含まれる場合は、あらかじめバックアップを採取するものとし、 <literal>confirm</literal> を指定して確認を行なうようにしてください。確認を行なうように設定しないと、何もメッセージが表示されないままパーティションが削除されてしまいます。</para>
     </important>

     <tip xml:id="ay-partitioning-skip-devices">
      <title>ドライブを読み飛ばす設定について</title>
      <para>&ay; の制御ファイル内で &lt;device&gt; 項目を指定せず、 &ay; の自動デバイス判断に任せたい場合、その判断基準を設定することができます。通常は適切なデバイスのうち最初のデバイスを使用するようになっていますが、下記のように設定することで、条件に合致するデバイスを除外できるようになります:</para>
      <screen>&lt;partitioning config:type="list"&gt;
  &lt;drive&gt;
    &lt;initialize config:type="boolean"&gt;true&lt;/initialize&gt;
    &lt;skip_list config:type="list"&gt;
      &lt;listentry&gt;
        &lt;!-- usb-storage ドライバを使用しているデバイスを読み飛ばす --&gt;
        &lt;skip_key&gt;driver&lt;/skip_key&gt;
        &lt;skip_value&gt;usb-storage&lt;/skip_value&gt;
      &lt;/listentry&gt;
      &lt;listentry&gt;
        &lt;!-- 1GB より小さいデバイスを読み飛ばす --&gt;
        &lt;skip_key&gt;size_k&lt;/skip_key&gt;
        &lt;skip_value&gt;1048576&lt;/skip_value&gt;
        &lt;skip_if_less_than config:type="boolean"&gt;true&lt;/skip_if_less_than&gt;
      &lt;/listentry&gt;
      &lt;listentry&gt;
        &lt;!-- 100GB より大きいデバイスを読み飛ばす --&gt;
        &lt;skip_key&gt;size_k&lt;/skip_key&gt;
        &lt;skip_value&gt;104857600&lt;/skip_value&gt;
        &lt;skip_if_more_than config:type="boolean"&gt;true&lt;/skip_if_more_than&gt;
      &lt;/listentry&gt;
    &lt;/skip_list&gt;
  &lt;/drive&gt;
&lt;/partitioning&gt;</screen>
      <para>&lt;skip_key&gt; で設定できる値の一覧について、詳しくはインストール済みのシステムで <command>yast2 ayast_probe</command> を実行してください。</para>
     </tip>
    </sect3>

    <sect3 xml:id="ay-partition-configuration">
     <title>パーティションの設定</title>
     <para>下記のような XML 構造内に、必要な要素を追加していきます:</para>
     <screen>&lt;drive&gt;
  &lt;partitions config:type="list"&gt;
    &lt;partition&gt;
      ...
    &lt;/partition&gt;
  &lt;/partitions&gt;
&lt;/drive&gt;</screen>
     <informaltable>
      <tgroup cols="3">
       <colspec colwidth="1*"/>
       <colspec colwidth="3*"/>
       <colspec colwidth="2*"/>
       <thead>
        <row>
         <entry>
          <para>属性</para>
         </entry>
         <entry>
          <para>値</para>
         </entry>
         <entry>
          <para>説明</para>
         </entry>
        </row>
       </thead>
       <tbody>
        <row>
         <entry>
          <para><literal>create</literal></para>
         </entry>
         <entry>
          <para>このパーティションもしくは論理ボリュームを作成しなければならない場合や、既に存在しているような場合に指定します。</para>
          <screen>&lt;create config:type="boolean" &gt;false&lt;/create&gt;</screen>
         </entry>
         <entry>
          <para><literal>false</literal> に設定した場合、 &ay; に対して使用すべきデバイスを指示するため、 <literal>partition_nr</literal> , <literal>lv_name</literal>, <literal>label</literal>, <literal>uuid</literal> のいずれかを指定する必要があります。</para>
         </entry>
        </row>
        <row>
         <entry>
          <para><literal>crypt_method</literal></para>
         </entry>
         <entry>
          <para>パーティションを下記のいずれかの方式で暗号化します:</para>

          <itemizedlist mark="bullet" spacing="normal">
           <listitem>
            <para><literal>luks1</literal> : 通常の LUKS1 形式での暗号化を行ないます。</para>
           </listitem>
           <listitem>
            <para><literal>pervasive_luks2</literal> : 普及型のボリュームの暗号化を行ないます。</para>
           </listitem>
           <listitem>
            <para><literal>protected_swap</literal> : 暫定的な保護鍵を利用して暗号化します。</para>
           </listitem>
           <listitem>
            <para><literal>secure_swap</literal> : 暫定的な機密鍵を利用して暗号化します。</para>
           </listitem>
           <listitem>
            <para><literal>random_swap</literal> : 暫定的な乱数鍵を利用して暗号化します。</para>
           </listitem>
          </itemizedlist>
          <screen>&lt;crypt_method config:type="symbol"&gt;luks1&lt;/crypt_method&gt;</screen>
         </entry>
         <entry>
          <para>任意指定です。暗号化方式の選択機能は &productname; <phrase os="sles;sled">15 SP2</phrase> <phrase os="osuse">15.2</phrase> もしくはそれ以降のバージョンで使用することができます。以前のバージョンと同じ動作にしたい場合は、 <literal>luks1</literal> を指定してください。</para>
          <para>暗号化パスワードを指定する必要がある場合は、 <literal>crypt_key</literal> 要素をお使いください。</para>
         </entry>
        </row>
        <row>
         <entry>
          <para><literal>crypt_fs</literal></para>
         </entry>
         <entry>
          <para>パーティションを暗号化するよう指定します。ただし、この要素は廃止予定としてマークされています。代わりに <literal>crypt_method</literal> を使用してください。</para>
          <screen>&lt;crypt_fs config:type="boolean"&gt;true&lt;/crypt_fs&gt;</screen>
         </entry>
         <entry>
          <para>既定値は <literal>false</literal> です。</para>
         </entry>
        </row>

        <row>
         <entry>
          <para><literal>crypt_key</literal></para>
         </entry>
         <entry>
          <para>暗号鍵を指定します。</para>
          <screen>&lt;crypt_key&gt;xxxxxxxx&lt;/crypt_key&gt;</screen>
         </entry>
         <entry>
          <para><literal>crypt_method</literal> でパスワードを設定する必要のある方式 (<literal>luks1</literal> もしくは <literal>pervasive_luks2</literal>) を選択した場合に必要となります。</para>
         </entry>
        </row>
        <row>
         <entry>
          <para><literal>mount</literal></para>
         </entry>
         <entry>
          <para>このパーティションのマウントポイントを指定します。</para>
          <screen>&lt;mount&gt;/&lt;/mount&gt;
&lt;mount&gt;swap&lt;/mount&gt;</screen>
         </entry>
         <entry>
          <para>少なくとも 1 つのルートパーティション (/) とスワップパーティションを設定する必要があります。</para>
         </entry>
        </row>
        <row>
         <entry>
          <para><literal>fstopt</literal></para>
         </entry>
         <entry>
          <para>このパーティションのマウントオプションを指定します。</para>
          <screen>&lt;fstopt&gt;
  ro,noatime,user,data=ordered,acl,user_xattr
&lt;/fstopt&gt;</screen>
         </entry>
         <entry>
          <para>指定可能なマウントオプションについて、詳しくは <command>man mount</command> をお読みください。</para>
         </entry>
        </row>
        <row>
         <entry>
          <para><literal>label</literal></para>
         </entry>
         <entry>
          <para>パーティションのラベルを指定します。デバイスをフォーマットする場合 (特に <literal>mountby</literal> パラメータを <literal>label</literal> にする場合) に有用であるほか、既に存在するデバイスを識別するような場合にも使用します (上述の <literal>create</literal> もお読みください) 。</para>
          <screen>&lt;label&gt;mydata&lt;/label&gt;</screen>
         </entry>
         <entry>
          <para>例については <command>man e2label</command> をお読みください。</para>
         </entry>
        </row>
        <row>
         <entry>
          <para><literal>uuid</literal></para>
         </entry>
         <entry>
          <para>パーティションの UUID を指定します。既に存在するデバイスを識別する場合にのみ使用します (上述の <literal>create</literal> もお読みください) 。なお、新しく作成するデバイスの場合は UUID を事前に決めることができませんので、指定することもできません。</para>
          <screen>&lt;uuid
&gt;1b4e28ba-2fa1-11d2-883f-b9a761bde3fb&lt;/uuid&gt;</screen>
         </entry>
         <entry>
          <para>詳しくは <command>man uuidgen</command> をお読みください。</para>
         </entry>
        </row>
        <row>
         <entry>
          <para><literal>size</literal></para>
         </entry>
         <entry>
          <para>4G, 4500M などのように、パーティションのサイズを指定します。 /boot パーティションとスワップパーティションに対しては、 <literal>auto</literal> を指定することもできます。この場合、 &ay; 側で適切なサイズを設定します。また、いずれか 1 つのパーティションに対して <literal>max</literal> を指定すると、残りの領域全てを使用することができるようになります。</para>
          <para>サイズは割合で設定することもできます。たとえば 10% と指定すると、ハードディスク全体もしくはボリュームグループの 10% 分を使用することができます。必要に応じて auto, max, サイズ指定, 割合を組み合わせて使用することもできます。</para>
          <screen>&lt;size&gt;10G&lt;/size&gt;</screen>
         </entry>
         <entry>
          <para>&productname; 15 以降では、全ての値 (<literal>auto</literal> と <literal>max</literal> を含む) をパーティションのサイズ変更時にも使用できるようになっています。</para>
         </entry>
        </row>
        <row>
         <entry>
          <para><literal>format</literal></para>
         </entry>
         <entry>
          <para>&ay; 側でパーティションをフォーマットするかどうかを指定します。</para>
          <screen>&lt;format config:type="boolean"&gt;false&lt;/format&gt;</screen>
         </entry>
         <entry>
          <para><literal>create</literal> を <literal>true</literal> に設定した場合は、この値についても <literal>true</literal> を設定しておいたほうが良いでしょう。</para>
         </entry>
        </row>
        <row>
         <entry>
          <para><literal>file system</literal></para>
         </entry>
         <entry>
          <para>このパーティションで使用するファイルシステムを指定します:</para>
          <itemizedlist mark="bullet" spacing="normal">
           <listitem>
            <para><literal>btrfs</literal></para>
           </listitem>
           <listitem>
            <para><literal>ext2</literal></para>
           </listitem>
           <listitem>
            <para><literal>ext3</literal></para>
           </listitem>
           <listitem>
            <para><literal>ext4</literal></para>
           </listitem>
           <listitem>
            <para><literal>fat</literal></para>
           </listitem>
           <listitem>
            <para><literal>xfs</literal></para>
           </listitem>
           <listitem>
            <para><literal>swap</literal></para>
           </listitem>
          </itemizedlist>
          <screen>&lt;filesystem config:type="symbol"
&gt;ext3&lt;/filesystem&gt;</screen>
         </entry>
         <entry>
          <para>任意指定です。ルートパーティションの場合、既定値は <literal>btrfs</literal> に、データパーティションの場合、既定値は <literal>xfs</literal> になります。</para>
         </entry>
        </row>
        <row>
         <entry>
          <para><literal>mkfs_options</literal></para>
         </entry>
         <entry>
          <para>mkfs コマンドを実行する際のオプション文字列を指定します。</para>
          <screen>&lt;mkfs_options&gt;-I 128&lt;/mkfs_options&gt;</screen>
         </entry>
         <entry>
          <para>任意指定です。どうしても必要な場合にのみ設定してください。</para>
         </entry>
        </row>
        <row>
         <entry>
          <para><literal>partition_nr</literal></para>
         </entry>
         <entry>
          <para>このパーティションのパーティション番号を指定します。 <literal>create=false</literal> もしくは LVM を使用しようとしている場合、 <literal>partition_nr</literal> でパーティションの番号を指定することができます。なお、 &ay; に対してプライマリパーティションを強制的に作成させたい場合は、 5 未満の数値を指定してください。</para>
          <screen>&lt;partition_nr config:type="integer"
&gt;2&lt;/partition_nr&gt;</screen>
         </entry>
         <entry>
          <para>通常は 1 から 4 までがプライマリパーティションに、 5 以上が論理パーティションになります。</para>
         </entry>
        </row>
        <row>
         <entry>
          <para><literal>partition_id</literal></para>
         </entry>
         <entry>
          <para><literal>partition_id</literal> ではパーティションの ID を設定します。 Linux パーティションでは 130 、スワップパーティションでは 131 が自動的に設定されますが、それ以外の ID を設定したい場合は、これで設定を行なってください。</para>
          <screen>&lt;partition_id config:type="integer"
&gt;131&lt;/partition_id&gt;</screen>
<para>設定可能な値は下記のとおりです:</para>
<simplelist>
 <member>スワップ: <literal>130</literal></member>
 <member>Linux: <literal>131</literal></member>
 <member>LVM: <literal>142</literal></member>
 <member>MD RAID: <literal>253</literal></member>
 <member>EFI パーティション: <literal>259</literal></member>
</simplelist>
         </entry>
         <entry>
          <para>既定では、 Linux パーティションに対しては <literal>131</literal> が、スワップパーティションに対しては <literal>130</literal> が設定されます。</para>
         </entry>
        </row>
        <row>
         <entry>
          <para><literal>partition_type</literal></para>
         </entry>
         <entry>
          <para>パーティションテーブルに <literal>msdos</literal> 形式を使用している場合、この要素でパーティションの種類を設定することができます。値には <literal>primary</literal> (プライマリパーティション) もしくは <literal>logical</literal> (論理パーティション) のいずれかを指定します。 <literal>gpt</literal> パーティションテーブルを使用している場合、このような区別はありませんので、値を設定しても無視されます。</para>
          <screen>&lt;partition_type&gt;primary&lt;/partition_type&gt;</screen>
         </entry>
         <entry>
          <para>任意指定です。 <literal>primary</literal> (既定値) もしくは <literal>logical</literal> のいずれかを指定します。</para>
         </entry>
        </row>
        <row>
         <entry>
          <para><literal>mountby</literal></para>
         </entry>
         <entry>
          <para>パーティション番号の代わりに、 <literal>device</literal> (デバイス), <literal>label</literal> (ラベル), <literal>uuid</literal> (UUID), <literal>path</literal> (udev パス), <literal>id</literal> (udev ID) などでパーティションをマウントするよう設定することができます。</para>
          <screen>&lt;mountby config:type="symbol"
&gt;label&lt;/mountby&gt;</screen>
         </entry>
         <entry>
          <para>上述の <literal>label</literal> と <literal>uuid</literal> の説明をお読みください。既定値は &yast; 側で規定されていますが、通常は <literal>id</literal> です。</para>
         </entry>
        </row>
        <row>
         <entry>
          <para><literal>subvolumes</literal></para>
         </entry>
         <entry>
          <para>btrfs のファイルシステムで作成するサブボリュームの一覧を指定します。これは btrfs を使用する場合にのみ意味のある項目です。詳しくは <xref linkend="ay-btrfs-subvolumes"/> をお読みください。</para>
          <screen>&lt;subvolumes config:type="list"&gt;
  &lt;path&gt;tmp&lt;/path&gt;
  &lt;path&gt;opt&lt;/path&gt;
  &lt;path&gt;srv&lt;/path&gt;
  &lt;path&gt;var/crash&lt;/path&gt;
  &lt;path&gt;var/lock&lt;/path&gt;
  &lt;path&gt;var/run&lt;/path&gt;
  &lt;path&gt;var/tmp&lt;/path&gt;
  &lt;path&gt;var/spool&lt;/path&gt;
  ...
&lt;/subvolumes&gt;</screen>
         </entry>
         <entry>
          <para>パーティションの設定内に <tag>subvolumes</tag> セクションが存在しない場合、 &ay; は指定したマウントポイント内に、既定のサブボリュームセットを作成します。</para>
         </entry>
        </row>
        <row>
         <entry>
          <para><literal>create_subvolumes</literal></para>
         </entry>
         <entry>
          <para>btrfs のサブボリュームを作成するかどうかを指定します。</para>
         </entry>
         <entry>
          <para>既定値は <literal>true</literal> です。 <literal>false</literal> に設定した場合、サブボリュームは作成されません。</para>
         </entry>
        </row>
        <row>
         <entry>
          <para><literal>subvolumes_prefix</literal></para>
         </entry>
         <entry>
          <para>btrfs のサブボリュームに設定するプレフィクス (前置) 名を指定します。何もプレフィクスを指定したくない場合は、空の値を設定してください:</para>
          <screen>&lt;subvolumes_prefix&gt;&lt;![CDATA[]]&gt;&lt;/subvolumes_prefix&gt;</screen>
         </entry>
         <entry>
          <para>既定では <literal>@</literal> が設定されています。</para>
         </entry>
        </row>
        <row>
         <entry>
          <para><literal>lv_name</literal></para>
         </entry>
         <entry>
          <para>このパーティションをボリュームグループ内の論理ボリュームに配置する場合、ここで論理ボリュームの名前を指定します (<literal>is_lvm_vg</literal> もお読みください) 。</para>
          <screen>&lt;lv_name&gt;opt_lv&lt;/lv_name&gt;</screen>
         </entry>
         <entry>
          <para/>
         </entry>
        </row>
        <row>
         <entry>
          <para><literal>stripes</literal></para>
         </entry>
         <entry>
          <para>LVM のストライピングを設定するための整数です。どれだけの数のデバイスにデータを分散させるのかを指定します。</para>
          <screen>&lt;stripes config:type="integer"&gt;2&lt;/stripes&gt;</screen>
         </entry>
         <entry>
          <para/>
         </entry>
        </row>
        <row>
         <entry>
          <para><literal>stripesize</literal></para>
         </entry>
         <entry>
          <para>各ブロックのサイズを KB 単位で指定します。</para>
          <screen>&lt;stripesize config:type="integer"
&gt;4&lt;/stripesize&gt;</screen>
         </entry>
         <entry>
          <para/>
         </entry>
        </row>
        <row>
         <entry>
          <para><literal>lvm_group</literal></para>
         </entry>
         <entry>
          <para>このパーティションが LVM のボリュームグループの一部として使用されている物理パーティションである場合は、ここでボリュームグループの名前を指定する必要があります。</para>
<screen>&lt;lvm_group&gt;system&lt;/lvm_group&gt;</screen>
         </entry>
         <entry>
          <para/>
         </entry>
        </row>
        <row>
         <entry>
          <para><literal>pool</literal></para>
         </entry>
         <entry>
          <para>LVM 論理ボリュームが LVM の thin プール内に存在すべきである場合は、 <literal>pool</literal> の値を <literal>true</literal> にしなければなりません。</para>
          <screen>&lt;pool config:type="boolean"&gt;false&lt;/pool&gt;</screen>
         </entry>
         <entry>
          <para/>
         </entry>
        </row>
        <row>
         <entry>
          <para><literal>used_pool</literal></para>
         </entry>
         <entry>
          <para>この thin 論理ボリュームに対して、データストアとして使用する LVM thin プールの名前を指定します。ここに何らかの値を設定すると、このボリュームは thin 論理ボリュームとして使用されるようになります。</para>
          <screen>&lt;used_pool&gt;my_thin_pool&lt;/used_pool&gt;</screen>
         </entry>
         <entry>
          <para/>
         </entry>
        </row>
        <row>
         <entry>
          <para><literal>raid_name</literal></para>
         </entry>
         <entry>
          <para>この物理ボリュームが RAID の一部である場合は、ここで RAID の名前を指定します。</para>
          <screen>&lt;raid_name&gt;/dev/md/0&lt;/raid_name&gt;</screen>
         </entry>
         <entry>
          <para/>
         </entry>
        </row>
        <row>
         <entry>
          <para><literal>raid_options</literal></para>
         </entry>
         <entry>
          <para>RAID オプションを指定します (説明欄もお読みください) 。</para>
          <screen>&lt;raid_options&gt;...&lt;/raid_options&gt;</screen>
         </entry>
         <entry>
          <para><literal>partition</literal> 内に RAID のオプションを設定するのは非推奨になっています。詳しくは <xref linkend="ay-partition-sw-raid"/> をお読みください。</para>
         </entry>
        </row>
        <row>
         <entry>
          <para>bcache_backing_for</para>
         </entry>
         <entry>
          <para>このデバイスを <emphasis>&bcache; のバッキングデバイス</emphasis> として使用する場合は、ここで &bcache; のデバイス名を指定します。</para>
          <screen>&lt;bcache_backing_for&gt;/dev/bcache0&lt;/bcache_backing_for&gt;</screen>
         </entry>
         <entry>
          <para>詳しくは <xref linkend="ay-partition-bcache"/> をお読みください。</para>
         </entry>
        </row>
        <row>
         <entry>
          <para>bcache_caching_for</para>
         </entry>
         <entry>
          <para>このデバイスを <emphasis>&bcache; のキャッシュデバイス</emphasis> として使用する場合は、ここで &bcache; のデバイス名を指定します。</para>
          <screen>&lt;bcache_caching_for config:type="list"&gt;
  &lt;listentry&gt;/dev/bcache0&lt;/listentry&gt;
&lt;/bcache_caching_for&gt;</screen>
         </entry>
         <entry>
          <para>詳しくは <xref linkend="ay-partition-bcache"/> をお読みください。</para>
         </entry>
        </row>
        <row>
         <entry>
          <para><literal>resize</literal></para>
         </entry>
         <entry>
          <para>既存のパーティションのサイズを変更すべきである場合、この値は <literal>true</literal> にします。この場合、 &ay; に対してデバイスの再利用 (<literal>create</literal>) を指定し、 <literal>size</literal> の値を設定する必要があります。</para>
          <screen>&lt;resize config:type="boolean"&gt;false&lt;/resize&gt;</screen>
         </entry>
         <entry>
          <para>&productname; 15 およびそれ以降では、サイズ変更は物理ディスクパーティションと LVM ボリュームの両方に対して動作するようになっています。</para>
         </entry>
        </row>
       </tbody>
      </tgroup>
     </informaltable>
    </sect3>

    <sect3 xml:id="ay-btrfs-subvolumes">
     <title>btrfs サブボリューム</title>
     <para><xref linkend="ay-partition-configuration"/> で説明しているとおり、それぞれの btrfs ファイルシステムに対して、必要なサブボリュームを定義することができます。最もシンプルな形態では、下記のようになります:</para>

<screen>&lt;subvolumes config:type="list"&gt;
  &lt;path&gt;tmp&lt;/path&gt;
  &lt;path&gt;opt&lt;/path&gt;
  &lt;path&gt;srv&lt;/path&gt;
  &lt;path&gt;var/crash&lt;/path&gt;
  &lt;path&gt;var/lock&lt;/path&gt;
  &lt;path&gt;var/run&lt;/path&gt;
  &lt;path&gt;var/tmp&lt;/path&gt;
  &lt;path&gt;var/spool&lt;/path&gt;
&lt;/subvolumes&gt;</screen>

     <para>&ay; では指定したサブボリュームに対して、 copy-on-write の無効化を設定することもできます。この場合、少し複雑な書式で設定する必要があります:</para>

<screen>&lt;subvolumes config:type="list"&gt;
&lt;listentry&gt;tmp&lt;/listentry&gt;
&lt;listentry&gt;opt&lt;/listentry&gt;
&lt;listentry&gt;srv&lt;/listentry&gt;
&lt;listentry&gt;
  &lt;path&gt;var/lib/pgsql&lt;/path&gt;
  &lt;copy_on_write config:type="boolean"&gt;false&lt;/copy_on_write&gt;
&lt;/listentry&gt;
&lt;/subvolumes&gt;</screen>

     <para>ディストリビューション側で既定のサブボリュームが設定されている場合 (たとえば &productname; では <filename>@</filename>) 、この既定のサブボリュームの名前がこの一覧の中に自動的に追加されます。このような動作を無効化したい場合は、下記のようにして <literal>subvolumes_prefix</literal> を設定してください。</para>

     <screen>&lt;subvolumes_prefix&gt;&lt;![CDATA[]]&gt;&lt;/subvolumes_prefix&gt;</screen>
    </sect3>

    <sect3 xml:id="ay-use-whole-disk">
     <title>ディスク全体の使用</title>

     <para>&ay; では、 <xref linkend="CreateProfile-Partitioning-config"/> で説明している <literal>disklabel</literal> の値を <literal>none</literal> に設定することで、パーティションを作成せずにディスク全体を使用することができます。このような場合、 <literal>drive</literal> 内の最初の <literal>partition</literal> 内の設定が、ディスク全体に対して適用されるようになります。</para>

     <para>下記の例では、 2 番目のディスク ( <literal>/dev/sdb</literal> ) 全体を <literal>/home</literal> のファイルシステムとして使用しています。</para>

     <example>
      <title>ディスク全体をファイルシステムとして使用する設定</title>
      <screen>&lt;partitioning config:type="list"&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/sda&lt;/device&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;create config:type="boolean"&gt;true&lt;/create&gt;
        &lt;format config:type="boolean"&gt;true&lt;/format&gt;
        &lt;mount&gt;/&lt;/mount&gt;
        &lt;size&gt;max&lt;/size&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
  &lt;/drive&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/sdb&lt;/device&gt;
    &lt;disklabel&gt;none&lt;/disklabel&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;format config:type="boolean"&gt;true&lt;/format&gt;
        &lt;mount&gt;/home&lt;/mount&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
  &lt;/drive&gt;</screen>
     </example>

     <para>これに加えて、ディスク全体を LVM 物理ボリュームやソフトウエア RAID のメンバーとして使用することもできます。 LVM やソフトウエア RAID に関する詳細は、 <xref linkend="ay-partition-lvm"/> および <xref linkend="ay-partition-sw-raid"/> をお読みください。</para>

     <para>後方互換性を確保する目的で、 <literal>&lt;partition_nr&gt;</literal> の要素を <literal>0</literal> に設定しても、同じ結果になるようになっています。ただし <literal>&lt;partition_nr&gt;</literal> 要素は、 &productname; 15 およびそれ以降で廃止予定とされていることに注意してください。</para>
    </sect3>

    <sect3 xml:id="ay-auto-partitioning">
     <title>不完全な設定の補完</title>
     <para>熟練者向けパーティション設定の方式を使用している場合、 &ay; は不完全なプロファイルからでも適切なパーティションプランを作成することができます。下記のプロファイルでは、パーティション配置に関するいくつかの詳細のみを指定し、それ以外を &ay; 側に任せる設定を示しています。</para>
     <example>
      <title>選択したドライブに対する自動的なパーティション設定</title>
      <para>下記はドライブが 1 台だけ搭載されたシステムでの例で、事前には何もパーティションを作成していないため、指定されたパーティションプランに従って自動的にパーティションを作成するように指定しています。なお、何もドライブを指定しない場合、ドライブは自動的に検出されます。</para>
      <screen>&lt;partitioning config:type="list"&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/sda&lt;/device&gt;
    &lt;use&gt;all&lt;/use&gt;
  &lt;/drive&gt;
&lt;/partitioning&gt;
</screen>
     </example>
     <para>さらに詳しい例では、既存のパーティションが存在する場合や複数のドライブが存在する場合の処理方法について示しています。</para>
     <example>
      <title>マルチパスドライブへのインストール</title>
      <screen>&lt;partitioning config:type="list"&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/sda&lt;/device&gt;
    &lt;use&gt;all&lt;/use&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;mount&gt;/&lt;/mount&gt;
        &lt;size&gt;10G&lt;/size&gt;
      &lt;/partition&gt;
      &lt;partition&gt;
        &lt;mount&gt;swap&lt;/mount&gt;
        &lt;size&gt;1G&lt;/size&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
  &lt;/drive&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/sdb&lt;/device&gt;
    &lt;use&gt;free&lt;/use&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;filesystem config:type="symbol"&gt;ext4&lt;/filesystem&gt;
        &lt;mount&gt;/data1&lt;/mount&gt;
        &lt;size&gt;15G&lt;/size&gt;
      &lt;/partition&gt;
      &lt;partition&gt;
        &lt;filesystem config:type="symbol"&gt;xfs&lt;/filesystem&gt;
        &lt;mount&gt;/data2&lt;/mount&gt;
        &lt;size&gt;auto&lt;/size&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
  &lt;/drive&gt;
&lt;/partitioning&gt;
</screen>
     </example>
    </sect3>
   </sect2>

   <sect2 xml:id="ay-partition-advanced">
    <title>高度なパーティション設定</title>
    <para><remark role="fixme">Add a short description</remark></para>
    <sect3 xml:id="ay-partition-advanced-wipe">
     <title>パーティションテーブルの消去</title>
     <para>通常は &ay; が 1 つずつパーティションを削除していくことから、この設定を行なう必要はありません。ですが、 &ay; に対してパーティションを個別に削除するのではなく、敢えて新しいパーティションテーブルを作成させたい場合、下記のような設定が必要になります。</para>
     <para>具体的には、 <literal>drive</literal> セクション内に下記を追加してください:</para>
<screen>&lt;initialize config:type="boolean"&gt;true&lt;/initialize&gt;</screen>
     <para>このような設定を行なうことで、 &ay; は既存のパーティションの分析やパーティションプランの作成を行なう前に、パーティションテーブルの消去を行なうようになります。この設定を行なうと、ご存じのとおり既存のパーティション内にある全てのデータは消去され、保持できなくなります。</para>
    </sect3>
    <sect3 xml:id="ay-partition-advanced-mount">
     <title>マウントオプション</title>
     <para>既定では、マウントすべきファイルシステムは <filename>/etc/fstab</filename> 内にデバイス名で指定されます。この指定方法は UUID やボリュームラベルに変更することもできます。ただし、全てのファイルシステムが UUID やボリュームラベルでのマウントに対応しているわけではないことに注意してください。パーティションのマウント方法を指定するには、 <literal>symbol</literal> 型で指定する <literal>mountby</literal> プロパティを設定してください。設定可能な値は下記のとおりです:</para>
     <itemizedlist mark="bullet" spacing="normal">
      <listitem>
       <para><literal>device</literal> (既定値)</para>
      </listitem>
      <listitem>
       <para><literal>label</literal></para>
      </listitem>
      <listitem>
       <para><literal>UUID</literal></para>
      </listitem>
     </itemizedlist>
     <para>ラベルを利用して新しいパーティションをマウントする場合、 <literal>label</literal> プロパティで指定した名前をボリュームラベルとして使用します。</para>
     <para>また、 <filename>/etc/fstab</filename> の 4 番目の列に指定することのできる、マウントオプションを追加することもできます。複数のオプションはカンマで区切ります。指定可能な値は下記のとおりです:</para>
     <variablelist>
      <varlistentry>
       <term>読み込み専用でマウント ( <literal>ro</literal> )</term>
       <listitem>
        <para>ファイルシステムに対して書き込みを行なうことができなくなります。既定値は <literal>false</literal> です。</para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>アクセス日時を更新しない ( <literal>noatime</literal> )</term>
       <listitem>
        <para>ファイルが読み込まれた際、アクセス日時を更新しないようにします。既定値は <literal>false</literal> です。</para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>ユーザにマウントを許可 ( <literal>user</literal> )</term>
       <listitem>
        <para>一般ユーザからファイルシステムをマウントできるようにします。既定値は <literal>false</literal> です。</para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>データジャーナリングモード ( <literal>ordered</literal> , <literal>journal</literal> , <literal>writeback</literal> )</term>
       <listitem>
        <variablelist>
         <varlistentry>
          <term><literal>journal</literal></term>
          <listitem>
           <para>データを書き込む際、実際のファイルシステムに書き込む前にジャーナルに書き込むようにします。</para>
          </listitem>
         </varlistentry>
         <varlistentry>
          <term><literal>ordered</literal></term>
          <listitem>
           <para>メタデータをジャーナルに書き込む前に、全てのデータを直接実際のファイルシステムに書き込みます。</para>
          </listitem>
         </varlistentry>
         <varlistentry>
          <term><literal>writeback</literal></term>
          <listitem>
           <para>データの書き込み順序を維持しません。</para>
          </listitem>
         </varlistentry>
        </variablelist>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>アクセス制御リスト ( <literal>acl</literal> )</term>
       <listitem>
        <para>ファイルシステムに対してアクセス制御リストを有効化します。</para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>拡張ユーザ属性 ( <literal>user_xattr</literal> )</term>
       <listitem>
        <para>ファイルシステムに対して拡張ユーザ属性を使用できるようにします。</para>
       </listitem>
      </varlistentry>
     </variablelist>
     <example>
      <title>マウントオプション</title>
<screen>&lt;partitions config:type="list"&gt;
  &lt;partition&gt;
    &lt;filesystem config:type="symbol"&gt;ext4&lt;/filesystem&gt;
    &lt;format config:type="boolean"&gt;true&lt;/format&gt;
    &lt;fstopt&gt;ro,noatime,user,data=ordered,acl,user_xattr&lt;/fstopt&gt;
    &lt;mount&gt;/local&lt;/mount&gt;
    &lt;mountby config:type="symbol"&gt;uuid&lt;/mountby&gt;
    &lt;partition_id config:type="integer"&gt;131&lt;/partition_id&gt;
    &lt;size&gt;10G&lt;/size&gt;
  &lt;/partition&gt;
&lt;/partitions&gt;
</screen>
     </example>

    <note>
     <title>ファイルシステムごとに対応するオプションが異なる件について</title>
     <para>ファイルシステムの種類が異なると、使用できるオプションもこことなります。オプションを設定する倍は、あらかじめ対応するドキュメンテーションをお読みください。</para>
    </note>
    </sect3>
    <sect3 xml:id="ay-partition-advanced-keep">
     <title>特定のパーティションの維持</title>
     <para>状況によっては、特定のパーティションのみをフォーマットして、それ以外のパーティションを何もせずにそのままにしておきたいような場合があります。たとえば異なる Linux インストールを共存させたいような場合や、他のオペレーティングシステムをインストールしたままにしておきたいような場合、これらのパーティションは消去せずに維持したままにすることができます。もちろんパーティション内のデータについても維持することができます。</para>
     <para>このような構成を作成する場合、インストール先のシステムとそのハードディスクに対して、さまざまな考慮を行なう必要があります。構成内容にもよりますが、インストール先のハードディスクのパーティションテーブルとパーティションの ID 、サイズと番号をそれぞれ知っておく必要があります。これらのデータをもとにして、 &ay; に対して特定のパーティションの維持を設定し、必要であれば新しいパーティションの作成を行なうことになります。</para>
     <para>下記の例では、パーティション 1,2,5 をそれぞれ維持し、パーティション 6 を削除して新しい 2 つのパーティションを作成しています。また、パーティション 2 以外を全てフォーマットして使用しています。 <remark>emap 2011-11-05: Not the best example for the scenarios two paras up with coexisting operating systems or data partitions. Who'd want to format those?</remark></para>
     <example>
      <title>パーティションの維持</title>
<screen>&lt;partitioning config:type="list"&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/sdc&lt;/device&gt;
      &lt;partitions config:type="list"&gt;
        &lt;partition&gt;
          &lt;create config:type="boolean"&gt;false&lt;/create&gt;
          &lt;format config:type="boolean"&gt;true&lt;/format&gt;
          &lt;mount&gt;/&lt;/mount&gt;
          &lt;partition_nr config:type="integer"&gt;1&lt;/partition_nr&gt;
        &lt;/partition&gt;
        &lt;partition&gt;
          &lt;create config:type="boolean"&gt;false&lt;/create&gt;
          &lt;format config:type="boolean"&gt;false&lt;/format&gt;
          &lt;partition_nr config:type="integer"&gt;2&lt;/partition_nr&gt;
          &lt;mount&gt;/space&lt;/mount&gt;
        &lt;/partition&gt;
        &lt;partition&gt;
          &lt;create config:type="boolean"&gt;false&lt;/create&gt;
          &lt;format config:type="boolean"&gt;true&lt;/format&gt;
          &lt;filesystem config:type="symbol"&gt;swap&lt;/filesystem&gt;
          &lt;partition_nr config:type="integer"&gt;5&lt;/partition_nr&gt;
          &lt;mount&gt;swap&lt;/mount&gt;
        &lt;/partition&gt;
        &lt;partition&gt;
          &lt;format config:type="boolean"&gt;true&lt;/format&gt;
          &lt;mount&gt;/space2&lt;/mount&gt;
          &lt;size&gt;5G&lt;/size&gt;
        &lt;/partition&gt;
        &lt;partition&gt;
          &lt;format config:type="boolean"&gt;true&lt;/format&gt;
          &lt;mount&gt;/space3&lt;/mount&gt;
          &lt;size&gt;max&lt;/size&gt;
        &lt;/partition&gt;
      &lt;/partitions&gt;
    &lt;use&gt;6&lt;/use&gt;
  &lt;/drive&gt;
&lt;/partitioning&gt;</screen>
     </example>
     <para>上記の例では、既存のパーティションテーブルの内容のほか、維持すべきパーティションの番号についても明示的に指定しています。ただし、さまざまな種類のハードディスクや設定が混在しているような環境の場合、これらを明示的に指定することができない場合もあります。下記のシナリオでは、非 Linux OS のシステムと Linux インストール用の専用領域を確保する構成を示しています。</para>
     <figure xml:id="partitioning-keep1">
      <title>パーティションの維持</title>
      <mediaobject>
       <imageobject role="html">
        <imagedata fileref="partitioning-keep1.png"/>
       </imageobject>
       <imageobject role="fo">
        <imagedata fileref="partitioning-keep1.png" width="75%"/>
       </imageobject>
      </mediaobject>
     </figure>
     <para>このシナリオでは、 <xref linkend="partitioning-keep1"/> の図に示しているとおり、 &ay; では新しいパーティションを作成しないように設定します。その代わり、システム内に存在する特定の種類のパーティションを検出し、制御ファイルに書かれたパーティション設定プランに従ってそれらを使用するように構成しています。この場合、パーティションの番号は全く指定しておらず、マウントポイントとパーティションの種類のみを指定しています (たとえばファイルシステムのオプションや暗号化、ファイルシステムの種類などの追加データを設定することもできます) 。</para>
     <example>
      <title>維持すべきパーティションの自動検出</title>
<screen>&lt;partitioning config:type="list"&gt;
  &lt;drive&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;create config:type="boolean"&gt;false&lt;/create&gt;
        &lt;format config:type="boolean"&gt;true&lt;/format&gt;
        &lt;mount&gt;/&lt;/mount&gt;
        &lt;partition_id config:type="integer"&gt;131&lt;/partition_id&gt;
      &lt;/partition&gt;
      &lt;partition&gt;
        &lt;create config:type="boolean"&gt;false&lt;/create&gt;
        &lt;format config:type="boolean"&gt;true&lt;/format&gt;
        &lt;filesystem config:type="symbol"&gt;swap&lt;/filesystem&gt;
        &lt;partition_id config:type="integer"&gt;130&lt;/partition_id&gt;
        &lt;mount&gt;swap&lt;/mount&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
  &lt;/drive&gt;
&lt;/partitioning&gt;</screen>
     </example>

     <note>
      <title>暗号化されたデバイスの維持について</title>
      <para>&ay; がストレージデバイスを検出する時点では、プロファイル内のパーティション設定セクションは解釈されていません。そのため、デバイスの暗号化を解除するために、どの鍵を使用すべきなのかを判別できません。たとえば、複数の暗号鍵を使用して暗号化を行なっている場合がそれに該当します。このような問題を解決するため、 &ay; では設定されている全ての鍵を利用して、デバイスの暗号化解除を試みるようになっています。</para>
     </note>
    </sect3>
   </sect2>

   <sect2 xml:id="ay-partition-lvm">
    <title>論理ボリュームマネージャ (Logical Volume Manager (LVM))</title>
    <para>LVM を設定するには、上述の通常のパーティション作成を設定して、物理ボリュームを作成しておく必要があります。</para>
    <example>
     <title>LVM 物理ボリュームの作成</title>
     <para>下記の例は、 <literal>partitioning</literal> リソースで LVM 向けのパーティションを準備する場合の例です。この例では <filename>/dev/sda1</filename> を作成したあとフォーマットを行なわず、 <literal>LVM</literal> の種類を設定し、ボリュームグループ <literal>system</literal> に追加を行ないます。なお、パーティションのサイズはドライブ内の全空き領域分になります。</para>
<screen>&lt;partitioning config:type="list"&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/sda&lt;/device&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;create config:type="boolean"&gt;true&lt;/create&gt;
        &lt;lvm_group&gt;system&lt;/lvm_group&gt;
        &lt;partition_type&gt;primary&lt;/partition_type&gt;
        &lt;partition_id config:type="integer"&gt;142&lt;/partition_id&gt;
        &lt;partition_nr config:type="integer"&gt;1&lt;/partition_nr&gt;
        &lt;size&gt;max&lt;/size&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
    &lt;use&gt;all&lt;/use&gt;
  &lt;/drive&gt;
&lt;/partitioning&gt;</screen>
    </example>
    <example>
     <title>LVM 論理ボリューム</title>
<screen>&lt;partitioning config:type="list"&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/sda&lt;/device&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;lvm_group&gt;system&lt;/lvm_group&gt;
        &lt;partition_type&gt;primary&lt;/partition_type&gt;
        &lt;size&gt;max&lt;/size&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
    &lt;use&gt;all&lt;/use&gt;
  &lt;/drive&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/system&lt;/device&gt;
      &lt;is_lvm_vg config:type="boolean"&gt;true&lt;/is_lvm_vg&gt;
      &lt;partitions config:type="list"&gt;
        &lt;partition&gt;
          &lt;filesystem config:type="symbol"&gt;ext4&lt;/filesystem&gt;
          &lt;lv_name&gt;user_lv&lt;/lv_name&gt;
          &lt;mount&gt;/usr&lt;/mount&gt;
          &lt;size&gt;15G&lt;/size&gt;
        &lt;/partition&gt;
        &lt;partition&gt;
          &lt;filesystem config:type="symbol"&gt;ext4&lt;/filesystem&gt;
          &lt;lv_name&gt;opt_lv&lt;/lv_name&gt;
          &lt;mount&gt;/opt&lt;/mount&gt;
          &lt;size&gt;10G&lt;/size&gt;
        &lt;/partition&gt;
        &lt;partition&gt;
          &lt;filesystem config:type="symbol"&gt;ext4&lt;/filesystem&gt;
          &lt;lv_name&gt;var_lv&lt;/lv_name&gt;
          &lt;mount&gt;/var&lt;/mount&gt;
          &lt;size&gt;1G&lt;/size&gt;
        &lt;/partition&gt;
      &lt;/partitions&gt;
      &lt;pesize&gt;4M&lt;/pesize&gt;
    &lt;use&gt;all&lt;/use&gt;
  &lt;/drive&gt;
&lt;/partitioning&gt;
</screen>
    </example>
    <para>論理ボリュームに対しても <literal>size</literal> に <literal>max</literal> を指定することができます。もちろん、いずれか 1 つ (!) の論理ボリュームにしか指定できません。また、 1 つのボリュームグループ内で 2 つの論理ボリュームを <literal>max</literal> に設定することもできません。</para>
   </sect2>

   <sect2 xml:id="ay-partition-sw-raid">
    <title>ソフトウエア RAID</title>
    <para>ソフトウエア RAID デバイスに対するサポートは、 &productname; <phrase os="sles;sled">15 SP2</phrase> <phrase os="osuse">15.2</phrase> で大幅に改善されています。</para>
     <para>必要であれば、後方互換性維持の目的で残されているソフトウエア RAID の古い設定方法を利用することもできます。詳しくは <xref linkend="ay-partition-sw-raid-deprecated"/> をお読みください。</para>
     <para>&ay; を使用することで、ソフトウエア RAID デバイスを作成したり構成したりすることができます。対応する RAID レベルは下記のとおりです:</para>
    <variablelist>
     <varlistentry>
      <term>RAID 0</term>
      <listitem>
       <para>このレベルではディスク性能の強化が行なわれますが、冗長性は提供 <emphasis>されません</emphasis> 。いずれか 1 台のディスクがクラッシュすると、データの復元は不可能になります。</para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>RAID 1</term>
      <listitem>
       <para>このレベルでは最大限の冗長性を提供します。 2 台以上のディスクを使用することができます。このレベルでは、全てのディスクに対して同じデータが書き込まれます。いずれか 1 台のディスクが正しく動作している限り、データが失われることはありません。この RAID レベルを使用する場合、使用するパーティションはほぼ同じサイズである必要があります。</para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>RAID 5</term>
      <listitem>
       <para>このレベルでは多数のディスクの管理と冗長性の両方を提供します。このレベルを使用するには、 3 台以上のディスクが必要です。いずれか 1 台のディスクが壊れても、データが失われることはありませんが、 2 台のディスクが同時に壊れてしまうと、データの復元は不可能になります。</para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term>マルチパス</term>
      <listitem>
       <para>このモードでは、複数のコントローラを介して同じ物理デバイスにアクセスを行ないます。これはコントローラカードの障害に対して冗長性を提供するものです。このモードを使用するには、少なくとも 2 枚のカードが必要になります。</para>
      </listitem>
     </varlistentry>
    </variablelist>
    <para>LVM と同様に、 &ay; プロファイル内でのソフトウエア RAID 定義は、 2 つの部品から構成されています:</para>

    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>どのディスクやパーティションを RAID のメンバーとして使用するのかの設定。 RAID メンバーとしての設定は、各デバイス要素内で <literal>raid_name</literal> を設定して行ないます。</para>
     </listitem>
     <listitem>
      <para><literal>drive</literal> セクションによる RAID そのものの定義。</para>
     </listitem>
    </itemizedlist>

    <para>下記の例は、 1 台目のディスクに存在するパーティションと、 2 台目のディスクに存在するパーティションを RAID のメンバーとして、 RAID1 を構成する場合の例です:</para>
    <example>
     <title>RAID1 設定</title>
<screen>&lt;partitioning config:type="list"&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/sda&lt;/device&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;mount&gt;/&lt;/mount&gt;
        &lt;size&gt;20G&lt;/size&gt;
      &lt;/partition&gt;
      &lt;partition&gt;
        &lt;raid_name&gt;/dev/md/0&lt;/raid_name&gt;
        &lt;size&gt;max&lt;/size&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
    &lt;use&gt;all&lt;/use&gt;
  &lt;/drive&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/sdb&lt;/device&gt;
    &lt;disklabel&gt;none&lt;/disklabel&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;raid_name&gt;/dev/md/0&lt;/raid_name&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
    &lt;use&gt;all&lt;/use&gt;
  &lt;/drive&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/md/0&lt;/device&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;mount&gt;/home&lt;/mount&gt;
        &lt;size&gt;40G&lt;/size&gt;
      &lt;/partition&gt;
      &lt;partition&gt;
        &lt;mount&gt;/srv&lt;/mount&gt;
        &lt;size&gt;10G&lt;/size&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
    &lt;raid_options&gt;
      &lt;chunk_size&gt;4&lt;/chunk_size&gt;
      &lt;parity_algorithm&gt;left_asymmetric&lt;/parity_algorithm&gt;
      &lt;raid_type&gt;raid1&lt;/raid_type&gt;
    &lt;/raid_options&gt;
    &lt;use&gt;all&lt;/use&gt;
  &lt;/drive&gt;
&lt;/partitioning&gt;</screen>
    </example>

    <para>ソフトウエア RAID 内にパーティションを作成したくない場合は、通常のディスクと同様に <literal>disklabel</literal> を <literal>none</literal> に設定してください。下記の例では、単純化のために RAID の <literal>drive</literal> セクションのみを示しています:</para>

    <example>
     <title>パーティションを使用しない RAID1</title>
<screen>&lt;drive&gt;
  &lt;device&gt;/dev/md/0&lt;/device&gt;
  &lt;disklabel&gt;none&lt;/disklabel&gt;
  &lt;partitions config:type="list"&gt;
    &lt;partition&gt;
      &lt;mount&gt;/home&lt;/mount&gt;
      &lt;size&gt;40G&lt;/size&gt;
    &lt;/partition&gt;
  &lt;/partitions&gt;
  &lt;raid_options&gt;
    &lt;chunk_size&gt;4&lt;/chunk_size&gt;
    &lt;parity_algorithm&gt;left_asymmetric&lt;/parity_algorithm&gt;
    &lt;raid_type&gt;raid1&lt;/raid_type&gt;
  &lt;/raid_options&gt;
  &lt;use&gt;all&lt;/use&gt;
&lt;/drive&gt;</screen>
    </example>

   <sect3 xml:id="ay-partition-sw-raid-deprecated">
    <title>古い書式の使用</title>
    <para>インストーラの自己更新機能が有効化されている場合、 &productname; 15 でソフトウエア RAID のパーティションを作成することができます。ただし、それ以前のバージョンではこのような仕組みには対応していないため、ソフトウエア RAID の定義が少し異なることになります。</para>

    <para>本章では、後方互換性のために提供されている古い形式の設定について説明しています。</para>

    <para>古い形式で RAID を設定する場合、下記の点に注意してください:</para>
    <itemizedlist mark="bullet" spacing="normal">
     <listitem>
      <para>RAID デバイスは必ず <filename>/dev/md</filename> になります。</para>
     </listitem>
     <listitem>
      <para><literal>partition_nr</literal> プロパティは、 MD デバイスの番号を判断するために使用します。たとえば <literal>partition_nr</literal> に 0 を設定すると、 <filename>/dev/md/0</filename> が設定されます。複数の <literal>partition</literal> セクションを設定すると、複数のソフトウエア RAID ( <filename>/dev/md/0</filename> , <filename>/dev/md/1</filename> ,...) を作成する意味になります。</para>
     </listitem>
     <listitem>
      <para>RAID 関連の全てのオプションは、 <literal>raid_options</literal> 内に含める必要があります。</para>
     </listitem>
    </itemizedlist>

    <example>
     <title>古い書式の RAID1 設定</title>
<screen>&lt;partitioning config:type="list"&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/sda&lt;/device&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;partition_id config:type="integer"&gt;253&lt;/partition_id&gt;
        &lt;format config:type="boolean"&gt;false&lt;/format&gt;
        &lt;raid_name&gt;/dev/md0&lt;/raid_name&gt;
        &lt;raid_type&gt;raid1&lt;/raid_type&gt;
        &lt;size&gt;4G&lt;/size&gt;
      &lt;/partition&gt;

        &lt;!-- /dev/sda に配置する通常のパーティション設定 (例: /, swap)
                をここに記述します --&gt;

    &lt;/partitions&gt;
    &lt;use&gt;all&lt;/use&gt;
  &lt;/drive&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/sdb&lt;/device&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;format config:type="boolean"&gt;false&lt;/format&gt;
        &lt;partition_id config:type="integer"&gt;253&lt;/partition_id&gt;
        &lt;raid_name&gt;/dev/md0&lt;/raid_name&gt;
        &lt;size&gt;4gb&lt;/size&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
    &lt;use&gt;all&lt;/use&gt;
  &lt;/drive&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/md&lt;/device&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;filesystem config:type="symbol"&gt;ext4&lt;/filesystem&gt;
        &lt;format config:type="boolean"&gt;true&lt;/format&gt;
        &lt;mount&gt;/space&lt;/mount&gt;
        &lt;partition_id config:type="integer"&gt;131&lt;/partition_id&gt;
        &lt;partition_nr config:type="integer"&gt;0&lt;/partition_nr&gt;
        &lt;raid_options&gt;
          &lt;chunk_size&gt;4&lt;/chunk_size&gt;
          &lt;parity_algorithm&gt;left_asymmetric&lt;/parity_algorithm&gt;
        &lt;/raid_options&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
    &lt;use&gt;all&lt;/use&gt;
  &lt;/drive&gt;
&lt;/partitioning&gt;</screen>
    </example>
   </sect3>

   <sect3 xml:id="ay-raid-configuration">
    <title>RAID オプション</title>
    <para>下記のような XML 構造内に、必要な要素を追加していきます:</para>
    <screen>&lt;partition&gt;
     &lt;raid_options&gt;
     ...
     &lt;/raid_options&gt;
     &lt;/partition&gt;</screen>
    <informaltable>
     <tgroup cols="3">
      <thead>
       <row>
        <entry>
         <para>属性</para>
        </entry>
        <entry>
         <para>値</para>
        </entry>
        <entry>
         <para>説明</para>
        </entry>
       </row>
      </thead>
      <tbody>
       <row>
        <entry>
         <para><literal>chunk_size</literal></para>
        </entry>
        <entry>
         <para/>
         <screen>&lt;chunk_size&gt;4&lt;/chunk_size&gt;</screen>
        </entry>
        <entry>
         <para/>
        </entry>
       </row>
       <row>
        <entry>
         <para><literal>parity_algorithm</literal></para>
        </entry>
        <entry>
         <para>設定可能な値は下記のとおりです:</para>
         <para><literal>left_asymmetric</literal> , <literal>left_symmetric</literal>, <literal>right_asymmetric</literal> , <literal>right_symmetric</literal> .</para>
         <para>RAID6 や RAID10 に対しては、下記の値を設定することができます:</para>
         <para><literal>parity_first</literal> , <literal>parity_last</literal> , <literal>left_asymmetric_6, left_symmetric_6</literal> , <literal>right_asymmetric_6</literal> , <literal>right_symmetric_6</literal> , <literal>parity_first_6</literal> , <literal>n2</literal> , <literal>o2</literal> , <literal>f2</literal> , <literal>n3</literal> , <literal>o3</literal> , <literal>f3</literal></para>
         <screen>&lt;parity_algorithm
          &gt;left_asymmetric&lt;/parity_algorithm&gt;</screen>
        </entry>
        <entry>
         <para/>
        </entry>
       </row>
       <row>
        <entry>
         <para><literal>raid_type</literal></para>
        </entry>
        <entry>
         <para>値には <literal>raid0</literal> , <literal>raid1</literal> , <literal>raid5</literal> , <literal>raid6</literal> , <literal>raid10</literal> のいずれかを指定します。</para>
         <screen>&lt;raid_type&gt;raid1&lt;/raid_type&gt;</screen>
        </entry>
        <entry>
         <para>既定値は <literal>raid1</literal> です。</para>
        </entry>
       </row>
       <row>
        <entry>
         <para><literal>device_order</literal></para>
        </entry>
        <entry>
         <para>この一覧には、物理デバイスの設定順序を指定します:</para>
         <screen>&lt;device_order config:type="list"&gt;
          &lt;device&gt;/dev/sdb2&lt;/device&gt;
          &lt;device&gt;/dev/sda1&lt;/device&gt;
          ...
          &lt;/device_order&gt;</screen>
        </entry>
        <entry>
         <para>この設定は任意設定で、既定ではアルファベット順です。</para>
        </entry>
       </row>
      </tbody>
     </tgroup>
    </informaltable>
   </sect3>
  </sect2>

  <sect2 xml:id="ay-partition-multipath">
<!-- this section differs from older releases, do not backport, 
      see https://github.com/SUSE/doc-sle/pull/535. (cjs, feb 4 2020) -->      
   <title>マルチパスサポート</title>
   <para>&ay; ではマルチパスデバイスを処理することができます。マルチパスデバイスを使用するには、まず <xref linkend="multipath-example"/> で説明しているように、マルチパスサポートの有効化を行なう必要があります。それ以外にも、カーネルのコマンドラインに <literal>LIBSTORAGE_MULTIPATH_AUTOSTART=ON</literal> を追加してもかまいません。</para>

   <para>ただし、 &sle; 12 とは異なり、ドライブセクションのタイプを <literal>CT_DMMULTIPATH</literal> にする必要はありません。代わりに <literal>CT_DISK</literal> を指定してください。ただし、従来バージョンとの互換性維持を目的として、いずれの値も同じ意味になっています。</para>

    <example xml:id="multipath-example">
     <title>マルチパスデバイスの使用</title>
     <screen><![CDATA[<general>
  <storage>
    <start_multipath config:type="boolean">true</start_multipath>
  <storage>
</general>
<partitioning>
  <drive>
    <partitions config:type="list">
      <partition>
        <size>20G</size>
        <mount>/</mount>
        <filesystem config:type="symbol">ext4</filesystem>
      </partition>
      <partition>
        <size>auto</size>
        <mount>swap</mount>
      </partition>
    </partitions>
    <type config:type="symbol">CT_DISK</type>
    <use>all</use>
  </drive>
</partitioning>]]></screen>
    </example>

    <para>デバイスを指定したい場合は、マルチパスデバイスを表わす World Wide Identifier (WWID) かデバイス名 (例: <literal>/dev/dm-0</literal> ) 、もしくは <literal>/dev/disk</literal> 以下のデバイスパスを指定してください。</para>

    <para>たとえば <xref linkend="multipath-ll-output"/> のような <literal>multipath</literal> コマンドの出力があった場合、 <literal>/dev/mapper/14945540000000000f86756dce9286158be4c6e3567e75ba5</literal> のほか、 <literal>/dev/dm-3</literal> や <literal>/dev/disk</literal> 以下のデバイスパス (例: <xref linkend="multipath-wwid-example"/>) を指定することができるほか、いずれかのデバイスパス (例: <literal>/dev/sda</literal> or <literal>/dev/sdb</literal> を指定してもかまいません。</para>

    <example xml:id="multipath-ll-output">
     <title>マルチパスデバイスの列挙</title>
     <screen><![CDATA[# multipath -l
14945540000000000f86756dce9286158be4c6e3567e75ba5 dm-3 ATA,VIRTUAL-DISK
size=40G features='0' hwhandler='0' wp=rw
|-+- policy='service-time 0' prio=1 status=active
| `- 2:0:0:0 sda 8:0  active ready running
`-+- policy='service-time 0' prio=1 status=enabled
  `- 3:0:0:0 sdb 8:16 active ready running]]></screen>
    </example>

    <example xml:id="multipath-wwid-example">
     <title>WWID を使用してマルチパスデバイスを指定する場合の例</title>
     <screen><![CDATA[<drive>
  <partitions config:type="list">
    <device>/dev/mapper/14945540000000000f86756dce9286158be4c6e3567e75ba5</device>
    <partition>
      <size>20G</size>
      <mount>/</mount>
      <filesystem config:type="symbol">ext4</filesystem>
    </partition>
  </partitions>
  <type config:type="symbol">CT_DISK</type>
  <use>all</use>
</drive>]]></screen>
    </example>
  </sect2>

  <sect2 xml:id="ay-partition-bcache">
   <title>&bcache; の設定</title>
   <para>&bcache; は複数の高速なドライブを利用して、 1 つまたは複数の低速なドライブを高速化するための仕組みです。たとえば特定の高速なドライブをキャッシュとして使用し、巨大で遅いドライブの性能を改善したりすることができます。</para>

   <para>&productname; での bcache に関する詳細は、 <link xlink:href="https://www.suse.com/c/combine-the-performance-of-solid-state-drive-with-the-capacity-of-a-hard-drive-with-bcache-and-yast/"/> (英語) に書かれているブログの記事をお読みください。</para>

   <para>&bcache; のデバイスを設定するには、 &ay; 側で下記のようなプロファイル設定が必要となります:</para>

   <itemizedlist>
    <listitem>
     <para>(遅いほうの) ブロックデバイスを <emphasis>バッキングデバイス</emphasis> として設定するには、 <literal>bcache_backing_for</literal> 要素を使用します。</para>
    </listitem>
    <listitem>
     <para>(早いほうの) ブロックデバイスを <emphasis>キャッシュデバイス</emphasis> して設定するには、 <literal>bcache_caching_for</literal> 要素を使用します。複数のドライブの速度を上げるために、 1 台のデバイスを使用するような設定も行なうことができます。</para>
    </listitem>
    <listitem>
     <para>&bcache; デバイスの配置方法を指定するには、 <literal>drive</literal> セクション内に <literal>type</literal> 要素が <literal>CT_BCACHE</literal> であるものを設定します。 &bcache; デバイス内には、パーティションを含めることもできます。</para>
    </listitem>
   </itemizedlist>

   <example>
    <title>&bcache; の定義</title>
<screen>&lt;partitioning config:type="list"&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/sda&lt;/device&gt;
    &lt;type config:type="symbol"&gt;CT_DISK&lt;/type&gt;
    &lt;use&gt;all&lt;/use&gt;
    &lt;enable_snapshots config:type="boolean"&gt;true&lt;/enable_snapshots&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;filesystem config:type="symbol"&gt;btrfs&lt;/filesystem&gt;
        &lt;mount&gt;/&lt;/mount&gt;
        &lt;create config:type="boolean"&gt;true&lt;/create&gt;
        &lt;size&gt;max&lt;/size&gt;
      &lt;/partition&gt;
      &lt;partition&gt;
        &lt;filesystem config:type="symbol"&gt;swap&lt;/filesystem&gt;
        &lt;mount&gt;swap&lt;/mount&gt;
        &lt;create config:type="boolean"&gt;true&lt;/create&gt;
        &lt;size&gt;2GiB&lt;/size&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
  &lt;/drive&gt;

  &lt;drive&gt;
    &lt;type config:type="symbol"&gt;CT_DISK&lt;/type&gt;
    &lt;device&gt;/dev/sdb&lt;/device&gt;
    &lt;disklabel&gt;msdos&lt;/disklabel&gt;
    &lt;use&gt;all&lt;/use&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;!-- It can serve as caching device for several bcaches --&gt;
        &lt;bcache_caching_for config:type="list"&gt;
          &lt;listentry&gt;/dev/bcache0&lt;/listentry&gt;
        &lt;/bcache_caching_for&gt;
        &lt;size&gt;max&lt;/size&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
  &lt;/drive&gt;

  &lt;drive&gt;
    &lt;type config:type="symbol"&gt;CT_DISK&lt;/type&gt;
    &lt;device&gt;/dev/sdc&lt;/device&gt;
    &lt;use&gt;all&lt;/use&gt;
    &lt;disklabel&gt;msdos&lt;/disklabel&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;!-- It can serve as backing device for one bcache --&gt;
        &lt;bcache_backing_for&gt;/dev/bcache0&lt;/bcache_backing_for&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
  &lt;/drive&gt;

  &lt;drive&gt;
    &lt;type config:type="symbol"&gt;CT_BCACHE&lt;/type&gt;
    &lt;device&gt;/dev/bcache0&lt;/device&gt;
    &lt;bcache_options&gt;
      &lt;cache_mode&gt;writethrough&lt;/cache_mode&gt;
    &lt;/bcache_options&gt;
    &lt;use&gt;all&lt;/use&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;mount&gt;/data&lt;/mount&gt;
        &lt;size&gt;20GiB&lt;/size&gt;
      &lt;/partition&gt;
      &lt;partition&gt;
        &lt;mount&gt;swap&lt;/mount&gt;
        &lt;filesystem config:type="symbol"&gt;swap&lt;/filesystem&gt;
        &lt;size&gt;1GiB&lt;/size&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
  &lt;/drive&gt;
&lt;/partitioning&gt;
</screen>
</example>

   <para>現時点では、 <literal>bcache_options</literal> で使用することのできるオプションは <literal>cache_mode</literal> だけとなります。説明は下記に示しています。</para>

   <informaltable>
    <tgroup cols="3">
     <thead>
      <row>
       <entry>
        <para>属性</para>
       </entry>
       <entry>
        <para>値</para>
       </entry>
       <entry>
        <para>説明</para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row>
       <entry>
        <para><literal>cache_mode</literal></para>
       </entry>
       <entry>
        <para/>
        <screen>&lt;cache_mode&gt;writethrough&lt;/cache_mode&gt;</screen>
       </entry>
       <entry>
        <para>&bcache; のキャッシュモードを指定します。設定可能な値は <literal>writethrough</literal> (ライトスルー), <literal>writeback</literal> (ライトバック), <literal>writearound</literal> (ライトアラウンド), <literal>none</literal> (無し) のいずれかです。</para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>

  <sect2 xml:id="ay-multidevice-btrfs">
   <title>ドライブの設定</title>

   <para>
    Btrfs supports creating a single volume that spans more than one
    storage device, offering similar features to software RAID implementations
    such as the Linux kernel's built-in <command>mdraid</command> subsystem.
    <emphasis>Multi-device Btrfs</emphasis> offers advantages over some other
    RAID implementations. For example, you can dynamically migrate a
    multi-device Btrfs volume from one RAID level to another, RAID levels can
    be set on a per-file basis, and more. However, not all of these features are
    fully supported yet in &productname; &product-ga; SP &product-sp;.
   </para>
    
   <para>With &ay;, a multi-device Btrfs can be configured by specifying a drive
    with the <literal>CT_BTRFS</literal> type. The <literal>device</literal>
    property is used as an arbitrary name to identify each multi-device Btrfs.
   </para>

   <para>
    As with RAID, you need to create all block devices first (e.g., partitions,
    LVM logical volumes, etc.) and assign them to the Btrfs file system you want
    to create over such block devices.
   </para>

   <para>
    The following example shows a simple multi-device Btrfs configuration:
   </para>

   <example>
    <title>ドライブの設定</title>
      <screen>&lt;partitioning config:type="list"&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/sda&lt;/device&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;mount&gt;/&lt;/mount&gt;
        &lt;size&gt;20G&lt;/size&gt;
      &lt;/partition&gt;
      &lt;partition&gt;
        &lt;raid_name&gt;/dev/md/0&lt;/raid_name&gt;
        &lt;size&gt;max&lt;/size&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
    &lt;use&gt;all&lt;/use&gt;
  &lt;/drive&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/sdb&lt;/device&gt;
    &lt;disklabel&gt;none&lt;/disklabel&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;raid_name&gt;/dev/md/0&lt;/raid_name&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
    &lt;use&gt;all&lt;/use&gt;
  &lt;/drive&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/md/0&lt;/device&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;mount&gt;/home&lt;/mount&gt;
        &lt;size&gt;40G&lt;/size&gt;
      &lt;/partition&gt;
      &lt;partition&gt;
        &lt;mount&gt;/srv&lt;/mount&gt;
        &lt;size&gt;10G&lt;/size&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
    &lt;raid_options&gt;
      &lt;chunk_size&gt;4&lt;/chunk_size&gt;
      &lt;parity_algorithm&gt;left_asymmetric&lt;/parity_algorithm&gt;
      &lt;raid_type&gt;raid1&lt;/raid_type&gt;
    &lt;/raid_options&gt;
    &lt;use&gt;all&lt;/use&gt;
  &lt;/drive&gt;
&lt;/partitioning&gt;</screen>
   </example>

   <para>
    The supported data and meta-data RAID levels are: <literal>default</literal>,
    <literal>single</literal>, <literal>dup</literal>, <literal>raid0</literal>,
    <literal>raid1</literal>, and <literal>raid10</literal>. By default, file
    system meta-data is mirrored across two devices and data is striped across
    all of the devices. If only one device is present, meta-data will be
    duplicated on that one device.
   </para>
   
<!--lproven 2020-06-30: omitting raid5 & raid6 for now as unsupported in 15SP2
as per ancorgs' comment on Github-->
 
   <para>古い形式で RAID を設定する場合、下記の点に注意してください:</para>

   <itemizedlist>
    <listitem>
     <para>
      Devices need to indicate the <literal>btrfs_name</literal> property to be
      included into a multi-device Btrfs file system.
     </para>
    </listitem>
    <listitem>
     <para>RAID 関連の全てのオプションは、 <literal>raid_options</literal> 内に含める必要があります。</para>
    </listitem>
   </itemizedlist>
  </sect2>


  <sect2 xml:id="ay-partition-nfs">
   <title>NFS の設定</title>

   <para>&ay; では、 &productname; を <emphasis>Network File System</emphasis> (NFS) の共有内にインストールすることもできます。これを実現するには、まず <literal>CT_NFS</literal> の種類でドライブを作成し、デバイス名として NFS の共有名を ( <replaceable>サーバ:パス</replaceable> ) の形式で指定します。マウントポイントに関する情報は、最初のパーティションセクション内に記述します。なお、 NFS ドライブの場合、最初のパーティションしか使用されないことに注意してください。</para>
   <para>システムをインストールした後の NFS クライアントやサーバの設定方法については、 <xref linkend="ay-partition-nfs"/> をお読みください。</para>

   <example>
    <title>NFS 共有の定義</title>
      <screen>
        &lt;partitioning config:type="list"&gt;
          &lt;drive&gt;
            &lt;device&gt;192.168.1.1:/exports/root_fs&lt;/device&gt;
            &lt;type config:type="symbol"&gt;CT_NFS&lt;/type&gt;
            &lt;use&gt;all&lt;/use&gt;
            &lt;partitions config:type="list"&gt;
              &lt;partition&gt;
                &lt;mount&gt;/&lt;/mount&gt;
                &lt;fstopt&gt;nolock&lt;/fstopt&gt;
              &lt;/partition&gt;
            &lt;/partitions&gt;
          &lt;/drive&gt;
        &lt;/partitioning&gt;
      </screen>
    </example>
  </sect2>

   <sect2 os="sles" xml:id="ay-partition-s390">
    <title>&zseries; 固有の設定</title>
    <para/>
    <sect3 xml:id="ay-partition-s390-dasd">
     <title>DASD ディスクの設定</title>
     <para>下記のような XML 構造内に、必要な要素を追加していきます:</para>
<screen>&lt;dasd&gt;
 &lt;devices config:type="list"&gt;
  &lt;listentry&gt;
   ...
  &lt;/listentry&gt;
 &lt;/devices&gt;
&lt;/dasd&gt;</screen>
     <para>上記のような内容を &lt;profile&gt; セクション内に記述します。それぞれのディスクは、それぞれ別々の &lt;listentry&gt; ... &lt;/listentry&gt; セクション内に記述する必要があります。</para>
     <informaltable>
      <tgroup cols="3">
       <thead>
        <row>
         <entry>
          <para>属性</para>
         </entry>
         <entry>
          <para>説明</para>
         </entry>
         <entry>
          <para>値</para>
         </entry>
        </row>
       </thead>
       <tbody>
        <row>
         <entry>
          <para><literal>device</literal></para>
         </entry>
         <entry>
          <para><literal>DASD</literal> だけを指定することができます</para>
<screen>&lt;device
&gt;DASD&lt;/dev_name&gt;</screen>
         </entry>
         <entry>
          <para/>
         </entry>
        </row>
        <row>
         <entry>
          <para><literal>dev_name</literal></para>
         </entry>
         <entry>
          <para>このセクションで設定したいデバイス ( <literal>dasd<replaceable>N</replaceable></literal> ) を指定します。</para>
<screen>&lt;dev_name
&gt;/dev/dasda&lt;/dev_name&gt;</screen>
         </entry>
         <entry>
          <para>任意指定ですが、できれば指定しておくことをお勧めします。何も指定しない場合、 &ay; がデバイスを自動的に判断します。</para>
         </entry>
        </row>
        <row>
         <entry>
          <para><literal>channel</literal></para>
         </entry>
         <entry>
          <para>ディスクにアクセスする際のチャネルを指定します。</para>
<screen>&lt;channel&gt;0.0.0150&lt;/channel&gt;</screen>
         </entry>
         <entry>
          <para>必須です。</para>
         </entry>
        </row>
        <row>
         <entry>
          <para><literal>diag</literal></para>
         </entry>
         <entry>
          <para><literal>DIAG</literal> を使用するかどうかを指定します。指定可能な値は <literal>true</literal> (有効化) もしくは <literal>false</literal> (無効化) のいずれかです。</para>
<screen>&lt;diag
config:type="boolean"&gt;true&lt;/diag&gt;</screen>
         </entry>
         <entry>
          <para>任意指定です。</para>
         </entry>
        </row>
       </tbody>
      </tgroup>
     </informaltable>
    </sect3>
    <sect3 xml:id="ay-partition-s390-zfcp">
     <title>zFCP ディスクの設定</title>
     <para>下記のような XML 構造内に、必要な要素を追加していきます:</para>
<screen>&lt;profile&gt;
  &lt;zfcp&gt;
    &lt;devices config:type="list"&gt;
      &lt;listentry&gt;
        ...
      &lt;/listentry&gt;
    &lt;/devices&gt;
  &lt;/zfcp&gt;
&lt;profile&gt;</screen>
     <para>なお、各ディスクはそれぞれ別々の <literal>listentry</literal> セクション内に記述します。</para>
     <informaltable>
      <tgroup cols="2">
       <thead>
        <row>
         <entry>
          <para>属性</para>
         </entry>
         <entry>
          <para>値</para>
         </entry>
        </row>
       </thead>
       <tbody>
        <row>
         <entry>
          <para><literal>controller_id</literal></para>
         </entry>
         <entry>
          <para>チャネル番号</para>
<screen>&lt;controller_id
&gt;0.0.fc00&lt;/controller_id&gt;</screen>
         </entry>
        </row>
       </tbody>
      </tgroup>
     </informaltable>
    </sect3>
   </sect2>
  </sect1>
