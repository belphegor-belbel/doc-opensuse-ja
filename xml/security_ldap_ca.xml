<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 [
<!ENTITY % entities SYSTEM "entity-decl.ent">
%entities;
]>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0" xml:id="sec-security-ldap-server-ca">
 <title>TLS 証明書の管理</title>
 <para>本章では、 &ds389; サーバとの間の通信を暗号化する際に使用する、 TLS 証明書の作成と管理方法について説明しています。</para>
 <para>証明書の管理にあたっては、 <command>pk12util</command> (<package>mozilla-nss-tools</package> パッケージに含まれています) や <command>openssl</command> (<package>openssl</package> パッケージに含まれています) などの従来型のユーティリティを使用してもかまいません。ですが、 &ds389a; には証明書を管理するための独自のユーティリティ <command>dsctl</command> が提供されていますので、こちらを利用することで、 LDAP サーバの証明書作成や管理を簡単に行うことができます。</para>
 <para>新しい &ds389a; インスタンスを作成すると、 <command>dscreate</command> は独自の証明機関を作成し、自己署名型のサーバ証明書を発行します。証明書のファイルは <filename>/etc/dirsrv/slapd-<replaceable>インスタンス名</replaceable>/</filename> 内に配置されます。それぞれ下記のようなファイルが存在します:</para>
 <variablelist>
   <varlistentry>
     <term><filename>Server-Cert.crt</filename></term>
   <listitem>
     <para>LDAP インスタンスの公開鍵。</para>
   </listitem>
 </varlistentry>
 <varlistentry>
   <term><filename>Server-Cert.csr</filename></term>
   <listitem>
     <para>インスタンスの証明書に対する署名要求。</para>
   </listitem>
 </varlistentry>
 <varlistentry>
   <term><filename>ca.crt</filename></term>
   <listitem>
     <para>インスタンスの証明機関。</para>
   </listitem>
 </varlistentry>
  <varlistentry> 
  <term><filename>pin.txt</filename></term>
   <listitem>
     <para>NSS データベースを管理する際に管理者が使用するパスワード。ただし、このパスワードは &ds389a; では使用していません。</para>
   </listitem>
 </varlistentry>
 <varlistentry> 
  <term><filename>cert9.db, key4.db</filename></term>
   <listitem>
     <para>これらはインスタンスの証明書と鍵を保存するための NSS データベースです。</para>
   </listitem>
 </varlistentry>
</variablelist>

<sect2 xml:id="sec-security-ldap-query-ca">
   <title>インストールされた証明書の確認</title>
   <para><command>dsctl</command> コマンドを利用することで、既存の TLS 証明書を表示することができます。たとえば下記のようになります:</para>
   <screen>&prompt.sudo;<command>dsctl 389-test3 tls show-server-cert</command>
 Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number:
            00:b6:f6:08:91
        Signature Algorithm: PKCS #1 SHA-256 With RSA Encryption
        Issuer: "CN=ssca.389ds.example.com,O=testing,L=389ds,ST=Queensland,C=
            AU"
        Validity:
            Not Before: Wed Dec 30 15:36:15 2020
            Not After : Fri Dec 30 15:36:15 2022
        Subject: "CN=localhost,givenName=c23c7a30-dd79-4256-9c7b-5fb77c6de0eb
            ,O=testing,L=389ds,ST=Queensland,C=AU"
        Subject Public Key Info:
        [...]</screen>
     </sect2>    
     </sect1>
