# SOME DESCRIPTIVE TITLE.
# FIRST AUTHOR <EMAIL@ADDRESS>, YEAR.
#
#, fuzzy
msgid ""
msgstr ""
"Project-Id-Version: PACKAGE VERSION\n"
"Report-Msgid-Bugs-To: https://github.com/belphegor-belbel/doc-opensuse-ja\n"
"POT-Creation-Date: 2022-08-29 22:11+0000\n"
"PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n"
"Last-Translator: FULL NAME <EMAIL@ADDRESS>\n"
"Language-Team: LANGUAGE <someuser@example.org>\n"
"MIME-Version: 1.0\n"
"Content-Type: text/x-po; charset=UTF-8\n"
"Content-Transfer-Encoding: 8bit\n"

#. Tag: title
#: art_virtualization-best-practices.xml:11
#, no-c-format
msgid "&sle_virt_bp_guide;"
msgstr ""

#. Tag: productname
#: art_virtualization-best-practices.xml:13
#, no-c-format
msgid "&productname;"
msgstr ""

#. Tag: productnumber
#: art_virtualization-best-practices.xml:14
#, no-c-format
msgid "&productnumber;"
msgstr ""

#. Tag: date
#: art_virtualization-best-practices.xml:15
#, no-c-format
msgid "<?dbtimestamp format=\"B d, Y\"?>"
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:30
#, no-c-format
msgid "Virtualization scenarios"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:32
#, no-c-format
msgid "Virtualization offers a lot of capabilities to your environment. It can be used in multiple scenarios. To get more details about it, refer to the <xref linkend=\"book-virtualization\"/> and in particular, to the following sections:"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:40
#, no-c-format
msgid "<xref linkend=\"sec-virtualization-scenarios-capabilities\"/>"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:45
#, no-c-format
msgid "<xref linkend=\"sec-virtualization-introduction-benefits\"/>"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:51
#, no-c-format
msgid "This best practice guide will provide advice for making the right choice in your environment. It will recommend or discourage the usage of options depending on your workload. Fixing configuration issues and performing tuning tasks will increase the performance of &vmguest;'s near to bare metal."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:137
#, no-c-format
msgid "Before you apply modifications"
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:140
#, no-c-format
msgid "Back up first"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:141
#, no-c-format
msgid "Changing the configuration of the &vmguest; or the &vmhost; can lead to data loss or an unstable state. It is really important that you do backups of files, data, images, etc. before making any changes. Without backups you cannot restore the original state after a data loss or a misconfiguration. Do not perform tests or experiments on production systems."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:151
#, no-c-format
msgid "Test your workloads"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:152
#, no-c-format
msgid "The efficiency of a virtualization environment depends on many factors. This guide provides a reference for helping to make good choices when configuring virtualization in a production environment. Nothing is <emphasis>carved in stone</emphasis> . Hardware, workloads, resource capacity, etc. should all be considered when planning, testing, and deploying your virtualization infrastructure. Testing your virtualized workloads is vital to a successful virtualization implementation."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:164
#, no-c-format
msgid "Recommendations"
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:167
#, no-c-format
msgid "Prefer the &libvirt; framework"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:170
#, no-c-format
msgid "&suse; strongly recommends using the &libvirt; framework to configure, manage, and operate &vmhost;s and &vmguest;. It offers a single interface (GUI and shell) for all supported virtualization technologies and therefore is easier to use than the hypervisor-specific tools."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:176
#, no-c-format
msgid "We do not recommend using libvirt and hypervisor-specific tools at the same time, because changes done with the hypervisor-specific tools may not be recognized by the libvirt tool set. See <xref linkend=\"cha-libvirt-overview\"/> for more information on libvirt."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:185
#, no-c-format
msgid "qemu-system-i386 compared to qemu-system-x86_64"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:188
#, no-c-format
msgid "Similar to real 64-bit PC hardware, <command>qemu-system-x86_64</command> supports &vmguest;s running a 32-bit or a 64-bit operating system. Because <command>qemu-system-x86_64</command> usually also provides better performance for 32-bit guests, &suse; generally recommends using <command>qemu-system-x86_64</command> for both 32-bit and 64-bit &vmguest;s on KVM. Scenarios where <command>qemu-system-i386</command> is known to perform better are not supported by &suse;."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:197
#, no-c-format
msgid "Xen also uses binaries from the qemu package but prefers <command>qemu-system-i386</command> , which can be used for both 32-bit and 64-bit Xen &vmguest;s. To maintain compatibility with the upstream Xen Community, SUSE encourages using <command>qemu-system-i386</command> for Xen &vmguest;s."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:207
#, no-c-format
msgid "&vmhost; configuration and resource allocation"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:209
#, no-c-format
msgid "Allocation of resources for &vmguest;s is a crucial point when administrating virtual machines. When assigning resources to &vmguest;s, be aware that overcommitting resources may affect the performance of the &vmhost; and the &vmguest;s. If all &vmguest;s request all their resources simultaneously, the host needs to be able to provide all of them. If not, the host's performance will be negatively affected and this will in turn also have negative effects on the &vmguest;'s performance."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:220
#, no-c-format
msgid "Memory"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:221
#, no-c-format
msgid "Linux manages memory in units called pages. On most systems the default page size is 4 KB. Linux and the CPU need to know which pages belong to which process. That information is stored in a page table. If a lot of processes are running, it takes more time to find where the memory is mapped, because of the time required to search the page table. To speed up the search, the TLB (Translation Lookaside Buffer) was invented. But on a system with a lot of memory, the TLB is not enough. To avoid any fallback to normal page table (resulting in a cache miss, which is time consuming), huge pages can be used. Using huge pages will reduce TLB overhead and TLB misses (pagewalk). A host with 32 GB (32*1014*1024 = 33,554,432 KB) of memory and a 4 KB page size has a TLB with <emphasis>33,554,432/4 = 8,388,608</emphasis> entries. Using a 2 MB (2048 KB) page size, the TLB only has <emphasis>33554432/2048 = 16384</emphasis> entries, considerably reducing TLB misses."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:238
#, no-c-format
msgid "Configuring the &vmhost; and the &vmguest; to use huge pages"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:239
#, no-c-format
msgid "The &x86-64; CPU architecture supports larger pages than 4 KB: huge pages. To determine the size of huge pages available on your system (could be 2 MB or 1 GB), check the <literal>flags</literal> line in the output of <filename>/proc/cpuinfo</filename> for occurrences of <literal>pse</literal> and/or <literal>pdpe1gb</literal> ."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:247
#, no-c-format
msgid "Determine the available huge pages size"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:254
#, no-c-format
msgid "CPU flag"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:259
#, no-c-format
msgid "Huge pages size available"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:268
#, no-c-format
msgid "Empty string"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:273
#, no-c-format
msgid "No huge pages available"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:280
#, no-c-format
msgid "pse"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:285
#, no-c-format
msgid "2 MB"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:292
#, no-c-format
msgid "pdpe1gb"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:297
#, no-c-format
msgid "1 GB"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:305
#, no-c-format
msgid "Using huge pages improves performance of &vmguest;s and reduces host memory consumption."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:309
#, no-c-format
msgid "By default the system uses THP. To make huge pages available on your system, activate it at boot time with <option>hugepages=1</option> , and&mdash;optionally&mdash;add the huge pages size with, for example, <option>hugepagesz=2MB</option> ."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:316
#, no-c-format
msgid "1 GB huge pages"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:317
#, no-c-format
msgid "1 GB pages can only be allocated at boot time and cannot be freed afterward."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:322
#, no-c-format
msgid "To allocate and use the huge page table (HugeTlbPage) you need to mount <filename>hugetlbfs</filename> with correct permissions."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:327
#, no-c-format
msgid "Restrictions of huge pages"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:328
#, no-c-format
msgid "Even if huge pages provide the best performance, they do come with some drawbacks. You lose features such as Memory ballooning (see <xref linkend=\"sec-vt-best-vmguests-virtio-balloon\"/> ), KSM (see <xref linkend=\"sec-vt-best-perf-ksm\"/> ), and huge pages cannot be swapped."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:337
#, no-c-format
msgid "Configuring the use of huge pages"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:339
#, no-c-format
msgid "Mount <literal>hugetlbfs</literal> to <filename>/dev/hugepages</filename> :"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:343
#, no-c-format
msgid "&prompt.user;&sudo; mount -t hugetlbfs hugetlbfs /dev/hugepages"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:346
#, no-c-format
msgid "To reserve memory for huge pages use the <command>sysctl</command> command. If your system has a huge page size of 2 MB (2048 KB), and you want to reserve 1 GB (1,048,576 KB) for your &vmguest;, you need <emphasis>1,048,576/2048=512</emphasis> pages in the pool:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:352
#, no-c-format
msgid "&prompt.user;&sudo; sysctl vm.nr_hugepages=<replaceable>512</replaceable>"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:353
#, no-c-format
msgid "The value is written to <filename>/proc/sys/vm/nr_hugepages</filename> and represents the current number of <emphasis>persistent</emphasis> huge pages in the kernel's huge page pool. <emphasis>Persistent</emphasis> huge pages will be returned to the huge page pool when freed by a task."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:362
#, no-c-format
msgid "Add the <literal>memoryBacking</literal> element in the &vmguest; configuration file (by running <command>virsh edit <replaceable>CONFIGURATION</replaceable></command> )."
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:367
#, no-c-format
msgid "&lt;memoryBacking&gt;\n"
      "  &lt;hugepages/&gt;\n"
      "&lt;/memoryBacking&gt;"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:372
#, no-c-format
msgid "Start your &vmguest; and check on the host whether it uses hugepages:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:375
#, no-c-format
msgid "&prompt.user;cat /proc/meminfo | grep HugePages_\n"
      "HugePages_Total:<co xml:id=\"co-hp-total\"/>     512\n"
      "HugePages_Free:<co xml:id=\"co-hp-free\"/>       92\n"
      "HugePages_Rsvd:<co xml:id=\"co-hp-rsvd\"/>        0\n"
      "HugePages_Surp:<co xml:id=\"co-hp-surp\"/>        0"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:382
#, no-c-format
msgid "Size of the pool of huge pages"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:387
#, no-c-format
msgid "Number of huge pages in the pool that are not yet allocated"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:392
#, no-c-format
msgid "Number of huge pages for which a commitment to allocate from the pool has been made, but no allocation has yet been made"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:398
#, no-c-format
msgid "Number of huge pages in the pool above the value in <filename>/proc/sys/vm/nr_hugepages</filename> . The maximum number of surplus huge pages is controlled by <filename>/proc/sys/vm/nr_overcommit_hugepages</filename>"
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:410
#, no-c-format
msgid "Transparent huge pages"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:411
#, no-c-format
msgid "Transparent huge pages (THP) provide a way to dynamically allocate huge pages with the <command>khugepaged</command> kernel thread, rather than manually managing their allocation and use. Workloads with contiguous memory access patterns can benefit greatly from THP. A 1000 fold decrease in page faults can be observed when running synthetic workloads with contiguous memory access patterns. Conversely, workloads with sparse memory access patterns (like databases) may perform poorly with THP. In such cases it may be preferable to disable THP by adding the kernel parameter <option>transparent_hugepage=never</option> , rebuild your grub2 configuration, and reboot. Verify if THP is disabled with:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:423
#, no-c-format
msgid "&prompt.user;cat /sys/kernel/mm/transparent_hugepage/enabled\n"
      "always madvise [never]"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:425
#, no-c-format
msgid "If disabled, the value <literal>never</literal> is shown in square brackets like in the example above."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:430
#, no-c-format
msgid "&xen;"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:431
#, no-c-format
msgid "THP is not available under &xen;."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:437
#, no-c-format
msgid "&xen;-specific memory notes"
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:439
#, no-c-format
msgid "Managing domain-0 memory"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:440
#, no-c-format
msgid "In previous versions of &sls;, the default memory allocation scheme of a &xen; host was to allocate all host physical memory to &dom0; and enable auto-ballooning. Memory was automatically ballooned from &dom0; when additional domains were started. This behavior has always been error prone and disabling it was strongly encouraged. Starting in &sls; 15 SP1, auto-ballooning has been disabled by default and &dom0; is given 10% of host physical memory + 1GB. For example, on a host with 32GB of physical memory, 4.2GB of memory is allocated for &dom0;."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:450
#, no-c-format
msgid "The use of <option>dom0_mem</option> &xen; command line option in <filename>/etc/default/grub</filename> is still supported and encouraged (see <xref linkend=\"sec-vt-best-kernel-parameter\"/> for more information). You can restore the old behavior by setting <option>dom0_mem</option> to the host physical memory size and enabling the <option>autoballoon</option> setting in <filename>/etc/xen/xl.conf</filename> ."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:462
#, no-c-format
msgid "KSM and page sharing"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:463
#, no-c-format
msgid "Kernel Samepage Merging is a kernel feature that reduces memory consumption on the &vmhost; by sharing blocks of memory that &vmguest;s have in common. The KSM daemon <systemitem class=\"daemon\">ksmd</systemitem> periodically scans user memory looking for pages with identical contents, which can be replaced by a single write-protected page. To enable the KSM service, first make sure that the package <package>qemu-ksm</package> is installed, then run the command:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:472
#, no-c-format
msgid "&prompt.user;&sudo; systemctl enable --now ksm.service"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:473
#, no-c-format
msgid "Alternatively, it can also be started by running the command:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:476
#, no-c-format
msgid "&prompt.root; echo 1 &gt; /sys/kernel/mm/ksm/run"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:477
#, no-c-format
msgid "One advantage of using KSM from a &vmguest;'s perspective is that all guest memory is backed by host anonymous memory. You can share <emphasis>pagecache</emphasis> , <emphasis>tmpfs</emphasis> or any kind of memory allocated in the guest."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:483
#, no-c-format
msgid "KSM is controlled by <systemitem>sysfs</systemitem> . You can check KSM's values in <filename>/sys/kernel/mm/ksm/</filename> :"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:489
#, no-c-format
msgid "<literal>pages_shared</literal> : The number of shared pages that are being used (read-only)."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:495
#, no-c-format
msgid "<literal>pages_sharing</literal> : The number of sites sharing the pages (read-only)."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:501
#, no-c-format
msgid "<literal>pages_unshared</literal> : The number of pages that are unique and repeatedly checked for merging (read-only)."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:507
#, no-c-format
msgid "<literal>pages_volatile</literal> : The number of pages that are changing too fast to be considered for merging (read-only)."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:513
#, no-c-format
msgid "<literal>full_scans</literal> : The number of times all mergeable areas have been scanned (read-only)."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:519
#, no-c-format
msgid "<literal>sleep_millisecs</literal> : The number of milliseconds <systemitem class=\"daemon\">ksmd</systemitem> should sleep before the next scan. A low value will overuse the CPU, consuming CPU time that could be used for other tasks. We recommend a value greater than <literal>1000</literal> ."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:528
#, no-c-format
msgid "<literal>pages_to_scan</literal> : The number of present pages to scan before ksmd goes to sleep. A high value will overuse the CPU. We recommend to start with a value of <literal>1000</literal> , and then adjust as necessary based on the KSM results observed while testing your deployment."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:537
#, no-c-format
msgid "<literal>merge_across_nodes</literal> : By default the system merges pages across NUMA nodes. Set this option to <literal>0</literal> to disable this behavior."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:545
#, no-c-format
msgid "Use cases"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:546
#, no-c-format
msgid "KSM is a good technique to over-commit host memory when running multiple instances of the same application or &vmguest;. When applications and &vmguest; are heterogeneous and do not share any common data, it is preferable to disable KSM. In order to do that, run:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:552
#, no-c-format
msgid "&prompt.user;&sudo; systemctl disable --now ksm.service"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:553
#, no-c-format
msgid "Alternatively, it can also be disabled by running the command:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:556
#, no-c-format
msgid "&prompt.root; echo 0 &gt; /sys/kernel/mm/ksm/run"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:557
#, no-c-format
msgid "In a mixed heterogeneous and homogeneous environment, KSM can be enabled on the host but disabled on a per &vmguest; basis. Use <command>virsh edit</command> to disable page sharing of a &vmguest; by adding the following to the guest's XML configuration:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:564
#, no-c-format
msgid "&lt;memoryBacking&gt;\n"
      "   &lt;nosharepages/&gt;\n"
      "&lt;/memoryBacking&gt;"
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:569
#, no-c-format
msgid "Avoid out-of-memory conditions"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:570
#, no-c-format
msgid "KSM can free up some memory on the host system, but the administrator should reserve enough swap to avoid out-of-memory conditions if that shareable memory decreases. If the amount of shareable memory decreases, the use of physical memory is increased."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:578
#, no-c-format
msgid "Memory access latencies"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:579
#, no-c-format
msgid "By default, KSM will merge common pages across NUMA nodes. If the merged, common page is now located on a distant NUMA node (relative to the node running the &vmguest; vCPUs), this may degrade &vmguest; performance. If increased memory access latencies are noticed in the &vmguest;, disable cross-node merging with the <literal>merge_across_nodes</literal> sysfs control:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:587
#, no-c-format
msgid "&prompt.root; echo 0 &gt; /sys/kernel/mm/ksm/merge_across_nodes"
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:591
#, no-c-format
msgid "&vmguest;: memory hotplug"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:592
#, no-c-format
msgid "To optimize the usage of your host memory, it may be useful to hotplug more memory for a running &vmguest; when required. To support memory hotplugging, you must first configure the <literal>&lt;maxMemory&gt;</literal> tag in the &vmguest;'s configuration file:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:599
#, no-c-format
msgid "&lt;maxMemory<co xml:id=\"co-mem-hot-max\"/> slots='16'<co xml:id=\"co-mem-hot-slots\"/> unit='KiB'&gt;20971520<co xml:id=\"co-mem-hot-size\"/>&lt;/maxMemory&gt;\n"
      "  &lt;memory<co xml:id=\"co-mem-hot-mem\"/> unit='KiB'&gt;1048576&lt;/memory&gt;\n"
      "&lt;currentMemory<co xml:id=\"co-mem-hot-curr\"/> unit='KiB'&gt;1048576&lt;/currentMemory&gt;"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:604
#, no-c-format
msgid "Runtime maximum memory allocation of the guest."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:609
#, no-c-format
msgid "Number of slots available for adding memory to the guest"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:614
#, no-c-format
msgid "Valid units are:"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:619
#, no-c-format
msgid "\"KB\" for kilobytes (1,000 bytes)"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:624
#, no-c-format
msgid "\"k\" or \"KiB\" for kibibytes (1,024 bytes)"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:629
#, no-c-format
msgid "\"MB\" for megabytes (1,000,000 bytes)"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:634
#, no-c-format
msgid "\"M\" or \"MiB\" for mebibytes (1,048,576 bytes)"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:639
#, no-c-format
msgid "\"GB\" for gigabytes (1,000,000,000 bytes)"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:644
#, no-c-format
msgid "\"G\" or \"GiB\" for gibibytes (1,073,741,824 bytes)"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:649
#, no-c-format
msgid "\"TB\" for terabytes (1,000,000,000,000 bytes)"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:654
#, no-c-format
msgid "\"T\" or \"TiB\" for tebibytes (1,099,511,627,776 bytes)"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:661
#, no-c-format
msgid "Maximum allocation of memory for the guest at boot time"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:666
#, no-c-format
msgid "Actual allocation of memory for the guest"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:671
#, no-c-format
msgid "To hotplug memory devices into the slots, create a file <filename>mem-dev.xml</filename> like the following:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:675
#, no-c-format
msgid "&lt;memory model='dimm'&gt;\n"
      "  &lt;target&gt;\n"
      "  &lt;size unit='KiB'&gt;524287&lt;/size&gt;\n"
      "  &lt;node&gt;0&lt;/node&gt;\n"
      "  &lt;/target&gt;\n"
      "&lt;/memory&gt;"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:681
#, no-c-format
msgid "And attach it with the following command:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:684
#, no-c-format
msgid "&prompt.user;virsh attach-device vm-name mem-dev.xml"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:685
#, no-c-format
msgid "For memory device hotplug, the guest must have at least 1 NUMA cell defined (see <xref linkend=\"sec-vt-best-perf-numa-vmguest-topo\"/> )."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:693
#, no-c-format
msgid "Swap"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:694
#, no-c-format
msgid "<emphasis>Swap</emphasis> is usually used by the system to store underused physical memory (low usage, or not accessed for a long time). To prevent the system running out of memory, setting up a minimum swap is highly recommended."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:701
#, no-c-format
msgid "<literal>swappiness</literal>"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:702
#, no-c-format
msgid "The <literal>swappiness</literal> setting controls your system's swap behavior. It defines how memory pages are swapped to disk. A high value of <emphasis>swappiness</emphasis> results in a system that swaps more often. Available values range from <literal>0</literal> to <literal>100</literal> . A value of <literal>100</literal> tells the system to find inactive pages and put them in swap. A value of <option>0</option> disables swapping. <!-- reduces the systems tendency to swap user space processes but does not disable swap completely (this is now the case with kernel =&gt; 3.5). -->"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:714
#, no-c-format
msgid "To do some testing on a live system, change the value of <filename>/proc/sys/vm/swappiness</filename> on the fly and check the memory usage afterward:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:719
#, no-c-format
msgid "&prompt.root; echo 35 &gt; /proc/sys/vm/swappiness"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:720
#, no-c-format
msgid "&prompt.user;free -h\n"
      "total       used       free     shared    buffers     cached\n"
      "Mem:      24616680    4991492   19625188     167056     144340    2152408\n"
      "-/+ buffers/cache:    2694744   21921936\n"
      "Swap:      6171644          0    6171644"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:725
#, no-c-format
msgid "To permanently set a swappiness value, add a line in <filename>/etc/systcl.conf</filename> , for example:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:729
#, no-c-format
msgid "vm.swappiness = 35"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:730
#, no-c-format
msgid "You can also control the swap by using the <literal>swap_hard_limit</literal> element in the XML configuration of your &vmguest;. Before setting this parameter and using it in a production environment, do some testing because the host can terminate the domain if the value is too low."
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:737
#, no-c-format
msgid "&lt;memtune&gt;<co xml:id=\"co-mem-1\"/>\n"
      "  &lt;hard_limit unit='G'&gt;1&lt;/hard_limit&gt;<co xml:id=\"co-mem-hard\"/>\n"
      "  &lt;soft_limit unit='M'&gt;128&lt;/soft_limit&gt;<co xml:id=\"co-mem-soft\"/>\n"
      "  &lt;swap_hard_limit unit='G'&gt;2&lt;/swap_hard_limit&gt;<co xml:id=\"co-mem-swap\"/>\n"
      "&lt;/memtune&gt;"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:744
#, no-c-format
msgid "This element provides memory tunable parameters for the domain. If this is omitted, it defaults to the defaults provided b the operating system."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:750
#, no-c-format
msgid "Maximum memory the guest can use. To avoid any problems on the &vmguest; it is strongly recommended not to use this parameter."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:756
#, no-c-format
msgid "The memory limit to enforce during memory contention."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:761
#, no-c-format
msgid "The maximum memory plus swap the &vmguest; can use."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:770
#, no-c-format
msgid "I/O"
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:773
#, no-c-format
msgid "I/O scheduler"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:774
#, no-c-format
msgid "The I/O scheduler for &sle; 15 SP2 and up is Budget Fair Queueing (BFQ). The main aim of the BFQ scheduler is to provide a fair allocation of the disk I/O bandwidth for all processes that request an I/O operation. You can have different I/O schedulers for different devices."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:780
#, no-c-format
msgid "To get better performance in host and &vmguest;, use <literal>none</literal> in the &vmguest; (disable the I/O scheduler) and the <literal>mq-deadline</literal> scheduler for a virtualization host."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:786
#, no-c-format
msgid "Checking and changing the I/O scheduler at runtime"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:788
#, no-c-format
msgid "To check your current I/O scheduler for your disk (replace <replaceable>sdX</replaceable> by the disk you want to check), run:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:792
#, no-c-format
msgid "&prompt.user;cat /sys/block/<replaceable>sdX</replaceable>/queue/scheduler\n"
      "mq-deadline kyber [bfq] none"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:794
#, no-c-format
msgid "The value in square brackets is the one currently selected ( <literal>bfq</literal> in the example above)."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:800
#, no-c-format
msgid "You can change the scheduler at runtime by running the following command as &rootuser;:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:804
#, no-c-format
msgid "&prompt.root; echo mq-deadline &gt; /sys/block/<replaceable>sdX</replaceable>/queue/scheduler"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:807
#, no-c-format
msgid "If you need to specify different I/O schedulers for each disk, create the file <filename>/usr/lib/tmpfiles.d/IO_ioscheduler.conf</filename> with content similar to the following example. It defines the <literal>mq-deadline</literal> scheduler for <filename>/dev/sda</filename> and the <literal>none</literal> scheduler for <filename>/dev/sdb</filename> . Keep in mind that the device name can be different depending on the device type. This feature is available on &slea; 12 and up."
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:817
#, no-c-format
msgid "\n"
      "w /sys/block/sda/queue/scheduler - - - - mq-deadline\n"
      "w /sys/block/sdb/queue/scheduler - - - - none\n"
      ""
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:823
#, no-c-format
msgid "Asynchronous I/O"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:824
#, no-c-format
msgid "Many of the virtual disk back-ends use Linux Asynchronous I/O (aio) in their implementation. By default, the maximum number of aio contexts is set to 65536, which can be exceeded when running hundreds of &vmguest;s using virtual disks serviced by Linux Asynchronous I/O. When running large numbers of &vmguest;s on a &vmhost;, consider increasing /proc/sys/fs/aio-max-nr."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:833
#, no-c-format
msgid "Checking and changing aio-max-nr at runtime"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:835
#, no-c-format
msgid "To check your current aio-max-nr setting run:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:838
#, no-c-format
msgid "&prompt.user;cat /proc/sys/fs/aio-max-nr\n"
      "65536"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:842
#, no-c-format
msgid "You can change aio-max-nr at runtime with the following command:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:845
#, no-c-format
msgid "&prompt.root; echo 131072 &gt; /proc/sys/fs/aio-max-nr"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:848
#, no-c-format
msgid "To permanently set <option>aio-max-nr</option> , add an entry to a custom sysctl file. For example, include the following to <filename>/etc/sysctl.d/aio-max-nr.conf</filename> :"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:853
#, no-c-format
msgid "fs.aio-max-nr = 1048576"
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:856
#, no-c-format
msgid "I/O Virtualization"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:857
#, no-c-format
msgid "&suse; products support various I/O virtualization technologies. The following table lists advantages and disadvantages of each technology. For more information about I/O in virtualization refer to the <xref linkend=\"sec-vt-io\"/> ."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:864
#, no-c-format
msgid "I/O Virtualization solutions"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:877
#, no-c-format
msgid "Advantage"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:882
#, no-c-format
msgid "Disadvantage"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:891
#, no-c-format
msgid "Device Assignment (pass-through)"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:896
#, no-c-format
msgid "Device accessed directly by the guest"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:901
#, no-c-format
msgid "No sharing among multiple guests"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:908
#, no-c-format
msgid "High performance"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:913
#, no-c-format
msgid "Live migration is complex"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:923
#, no-c-format
msgid "PCI device limit is 8 per guest"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:933
#, no-c-format
msgid "Limited number of slots on a server"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:940
#, no-c-format
msgid "Full virtualization (IDE, SATA, SCSI, e1000)"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:945
#, no-c-format
msgid "&vmguest; compatibility"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:950
#, no-c-format
msgid "Bad performance"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:962
#, no-c-format
msgid "Emulated operation"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:969
#, no-c-format
msgid "Para-virtualization (virtio-blk, virtio-net, virtio-scsi)"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:974
#, no-c-format
msgid "Good performance"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:979
#, no-c-format
msgid "Modified guest (PV drivers)"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:986
#, no-c-format
msgid "Easy for live migration"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:996
#, no-c-format
msgid "Efficient host communication with &vmguest;"
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:1011
#, no-c-format
msgid "Storage and file system"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1012
#, no-c-format
msgid "Storage space for &vmguest;s can either be a block device (for example, a partition on a physical disk), or an image file on the file system:"
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:1017
#, no-c-format
msgid "Block devices compared to disk images"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1025
#, no-c-format
msgid "Technology"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1030
#, no-c-format
msgid "Advantages"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1035
#, no-c-format
msgid "Disadvantages"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1044
#, no-c-format
msgid "Block devices"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1051
#, no-c-format
msgid "Better performance"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1056
#, no-c-format
msgid "Use standard tools for administration/disk modification"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1061
#, no-c-format
msgid "Accessible from host (pro and con)"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1070
#, no-c-format
msgid "Device management"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1079
#, no-c-format
msgid "Image files"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1086
#, no-c-format
msgid "Easier system management"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1091
#, no-c-format
msgid "Easily move, clone, expand, back up domains"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1096
#, no-c-format
msgid "Comprehensive toolkit (guestfs) for image manipulation"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1101
#, no-c-format
msgid "Reduce overhead through sparse files"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1106
#, no-c-format
msgid "Fully allocate for best performance"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1115
#, no-c-format
msgid "Lower performance than block devices"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1142
#, no-c-format
msgid "For detailed information about image formats and maintaining images refer to <xref linkend=\"sec-vt-best-img\"/> ."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1146
#, no-c-format
msgid "If your image is stored on an NFS share, you should check some server and client parameters to improve access to the &vmguest; image."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:1151
#, no-c-format
msgid "NFS read/write (client)"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1152
#, no-c-format
msgid "Options <option>rsize</option> and <option>wsize</option> specify the size of the chunks of data that the client and server pass back and forth to each other. You should ensure NFS read/write sizes are sufficiently large, especially for large I/O. Change the <option>rsize</option> and <option>wsize</option> parameter in your <filename>/etc/fstab</filename> by increasing the value to 16 KB. This will ensure that all operations can be frozen if there is any instance of hanging."
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:1161
#, no-c-format
msgid "nfs_server:/exported/vm_images<co xml:id=\"co-nfs-server\"/> /mnt/images<co xml:id=\"co-nfs-mnt\"/> nfs<co xml:id=\"co-nfs-nfs\"/> rw<co xml:id=\"co-nfs-rw\"/>,hard<co xml:id=\"co-nfs-hard\"/>,sync<co xml:id=\"co-nfs-sync\"/>, rsize=8192<co xml:id=\"co-nfs-rsize\"/>,wsize=8192<co xml:id=\"co-nfs-wsize\"/> 0 0"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1164
#, no-c-format
msgid "NFS server's host name and export path name."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1169
#, no-c-format
msgid "Where to mount the NFS exported share."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1174
#, no-c-format
msgid "This is an <option>nfs</option> mount point."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1179
#, no-c-format
msgid "This mount point will be accessible in read/write."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1184
#, no-c-format
msgid "Determines the recovery behavior of the NFS client after an NFS request times out. <option>hard</option> is the best option to avoid data corruption."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1191
#, no-c-format
msgid "Any system call that writes data to files on that mount point causes that data to be flushed to the server before the system call returns control to user space."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1198
#, no-c-format
msgid "Maximum number of bytes in each network READ request that the NFS client can receive when reading data from a file on an NFS server."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1204
#, no-c-format
msgid "Maximum number of bytes per network WRITE request that the NFS client can send when writing data to a file on an NFS server."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:1212
#, no-c-format
msgid "NFS threads (server)"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1213
#, no-c-format
msgid "Your NFS server should have enough NFS threads to handle multi-threaded workloads. Use the <command>nfsstat</command> tool to get some RPC statistics on your server:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:1218
#, no-c-format
msgid "&prompt.user;&sudo; nfsstat -rc\n"
      "Client rpc stats:\n"
      "calls      retrans    authrefrsh\n"
      "6401066    198          0          0"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1222
#, no-c-format
msgid "If the <literal>retrans</literal> is equal to 0, everything is fine. Otherwise, the client needs to retransmit, so increase the <envar>USE_KERNEL_NFSD_NUMBER</envar> variable in <filename>/etc/sysconfig/nfs</filename> , and adjust accordingly until <literal>retrans</literal> is equal to <literal>0</literal> ."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:1233
#, no-c-format
msgid "CPUs"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1234
#, no-c-format
msgid "Host CPU <quote>components</quote> will be <quote>translated</quote> to virtual CPUs in a &vmguest; when being assigned. These components can either be:"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1241
#, no-c-format
msgid "<emphasis>CPU processor</emphasis> : this describes the main CPU unit, which usually has multiple cores and may support Hyper-Threading."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1247
#, no-c-format
msgid "<emphasis>CPU core</emphasis> : a main CPU unit can provide more than one core, and the proximity of cores speeds up the computation process and reduces energy costs."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1254
#, no-c-format
msgid "<emphasis>CPU Hyper-Threading</emphasis> : this implementation is used to improve parallelization of computations, but this is not as efficient as a dedicated core."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:1262
#, no-c-format
msgid "Assigning CPUs"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1263
#, no-c-format
msgid "CPU overcommit occurs when the cumulative number of virtual CPUs of all &vmguest;s becomes higher than the number of host CPUs. Best performance is likely to be achieved when there is no overcommit and each virtual CPU matches one hardware processor or core on the &vmhost;. In fact, &vmguest;s running on an overcommitted host will experience increased latency and a negative effect on per-&vmguest; throughput is also likely to be observed. Therefore, you should try to avoid overcommitting CPUs."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1274
#, no-c-format
msgid "Deciding whether to allow CPU overcommit or not requires good a-priori knowledge of workload as a whole. For example, if you know that all the &vmguest;s virtual CPUs will not be loaded more than 50% then you can assume that overcommitting the host by a factor of 2 (which means having 128 virtual CPUs in total, on a host with 64 CPUs) will work well. On the other hand, if you know that all the virtual CPUs of the &vmguest;s will try to run at 100% for most of the time then even having one virtual CPU more than the host has CPUs is already a misconfiguration."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1285
#, no-c-format
msgid "Overcommitting to a point where the cumulative number of virtual CPUs is higher than 8 times the number of physical cores of the &vmhost; will most likely lead to a malfunctioning and unstable system and should hence be avoided."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1291
#, no-c-format
msgid "Unless you know exactly how many virtual CPUs are required for a &vmguest;, you should start with one. A good rule of thumb is to target a CPU workload of approximately 70% inside your VM (see <xref linkend=\"sec-util-processes\"/> for information on monitoring tools). If you allocate more processors than needed in the &vmguest;, this will negatively affect the performance of host and guest. Cycle efficiency will be degraded, as the unused vCPU will still cause timer interrupts. In case you primarily run single threaded applications on a &vmguest;, a single virtual CPU is the best choice."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1302
#, no-c-format
msgid "A single &vmguest; with more virtual CPUs than the &vmhost; has CPUs is always a misconfiguration."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:1308
#, no-c-format
msgid "&vmguest; CPU configuration"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1309
#, no-c-format
msgid "This section describes how to choose and configure a CPU type for a &vmguest;. You will also learn how to pin virtual CPUs to physical CPUs on the host system. For more information about virtual CPU configuration and tuning parameters refer to the libvirt documentation at <link xlink:href=\"https://libvirt.org/formatdomain.html#elementsCPU\"/> ."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:1318
#, no-c-format
msgid "Virtual CPU models and features"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1319
#, no-c-format
msgid "The CPU model and topology can be specified individually for each &vmguest;. Configuration options range from selecting specific CPU models to excluding certain CPU features. Predefined CPU models are listed in files in the directory <filename>/usr/share/libvirt/cpu_map/</filename> . A CPU model and topology that is similar to the host generally provides the best performance. The host system CPU model and topology can be displayed by running <command>virsh capabilities</command> ."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1328
#, no-c-format
msgid "Note that changing the default virtual CPU configuration will require a &vmguest; shutdown when migrating it to a host with different hardware. More information on &vmguest; migration is available at <xref linkend=\"sec-libvirt-admin-migrate\"/> ."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1335
#, no-c-format
msgid "To specify a particular CPU model for a &vmguest;, add a respective entry to the &vmguest; configuration file. The following example configures a Broadwell CPU with the invariant TSC feature:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:1340
#, no-c-format
msgid "&lt;cpu mode='custom' match='exact'&gt;\n"
      "  &lt;model&gt;Broadwell&lt;/model&gt;\n"
      "  &lt;feature name='invtsc'/&gt;\n"
      "  &lt;/cpu&gt;"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1344
#, no-c-format
msgid "For a virtual CPU that most closely resembles the host physical CPU, <literal>&lt;cpu mode='host-passthrough'&gt;</literal> can be used. Note that a <literal>host-passthrough</literal> CPU model may not exactly resemble the host physical CPU, since by default KVM will mask any non-migratable features. For example invtsc is not included in the virtual CPU feature set. Changing the default KVM behavior is not directly supported through libvirt, although it does allow arbitrary pass-through of KVM command line arguments. Continuing with the <literal>invtsc</literal> example, you can achieve pass-through of the host CPU (including <literal>invtsc</literal> ) with the following command line pass-through in the &vmguest; configuration file:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:1357
#, no-c-format
msgid "&lt;domain type='kvm' xmlns:qemu='http://libvirt.org/schemas/domain/qemu/1.0'&gt;\n"
      "     &lt;qemu:commandline&gt;\n"
      "     &lt;qemu:arg value='-cpu'/&gt;\n"
      "     &lt;qemu:arg value='host,migratable=off,+invtsc'/&gt;\n"
      "     &lt;/qemu:commandline&gt;\n"
      "     ...\n"
      "     &lt;/domain&gt;\n"
      "     "
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:1366
#, no-c-format
msgid "The <literal>host-passthrough</literal> mode"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1367
#, no-c-format
msgid "Since <literal>host-passthrough</literal> exposes the physical CPU details to the virtual CPU, migration to dissimilar hardware is not possible. See <xref linkend=\"sec-vt-best-perf-cpu-guests-vcpumigration\"/> for more information."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:1377
#, no-c-format
msgid "Virtual CPU pinning"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1378
#, no-c-format
msgid "Virtual CPU pinning is used to constrain virtual CPU threads to a set of physical CPUs. The <literal>vcpupin</literal> element specifies the physical host CPUs that a virtual CPU can use. If this element is not set and the attribute <literal>cpuset</literal> of the <literal>vcpu</literal> element is not specified, the virtual CPU is free to use any of the physical CPUs."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1386
#, no-c-format
msgid "CPU intensive workloads can benefit from virtual CPU pinning by increasing the physical CPU cache hit ratio. To pin a virtual CPU to a specific physical CPU, run the following commands:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:1391
#, no-c-format
msgid "&prompt.user;virsh vcpupin <replaceable>DOMAIN_ID</replaceable> --vcpu <replaceable>vCPU_NUMBER</replaceable>\n"
      "VCPU: CPU Affinity\n"
      "----------------------------------\n"
      "0: 0-7\n"
      "&prompt.root;virsh vcpupin SLE15 --vcpu 0 0 --config"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1396
#, no-c-format
msgid "The last command generates the following entry in the XML configuration:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:1399
#, no-c-format
msgid "&lt;cputune&gt;\n"
      "   &lt;vcpupin vcpu='0' cpuset='0'/&gt;\n"
      "&lt;/cputune&gt;"
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:1403
#, no-c-format
msgid "Virtual CPU pinning on NUMA nodes"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1404
#, no-c-format
msgid "To confine a &vmguest;'s CPUs and its memory to a NUMA node, you can use virtual CPU pinning and memory allocation policies on a NUMA system. See <xref linkend=\"sec-vt-best-perf-numa\"/> for more information related to NUMA tuning."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:1412
#, no-c-format
msgid "Virtual CPU pinning and live migration"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1413
#, no-c-format
msgid "Even though <literal>vcpupin</literal> can improve performance, it can complicate live migration. See <xref linkend=\"sec-vt-best-perf-cpu-guests-vcpumigration\"/> for more information on virtual CPU migration considerations."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:1422
#, no-c-format
msgid "Virtual CPU migration considerations"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1423
#, no-c-format
msgid "Selecting a virtual CPU model containing all the latest features may improve performance of a &vmguest; workload, but often at the expense of migratability. Unless all hosts in the cluster contain the latest CPU features, migration can fail when a destination host lacks the new features. If migratability of a virtual CPU is preferred over the latest CPU features, a normalized CPU model and feature set should be used. The <command>virsh cpu-baseline</command> command can help define a normalized virtual CPU that can be migrated across all hosts. The following command, when run on each host in the migration cluster, illustrates collection of all hosts' capabilities in <literal>all-hosts-caps.xml</literal> ."
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:1436
#, no-c-format
msgid "&prompt.user;&sudo; virsh capabilities &gt;&gt; all-hosts-cpu-caps.xml"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1437
#, no-c-format
msgid "With the capabilities from each host collected in all-hosts-caps.xml, use <command>virsh cpu-baseline</command> to create a virtual CPU definition that will be compatible across all hosts."
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:1442
#, no-c-format
msgid "&prompt.user;&sudo; virsh cpu-baseline all-hosts-caps.xml"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1443
#, no-c-format
msgid "The resulting virtual CPU definition can be used as the <literal>cpu</literal> element in &vmguest; configuration file."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1447
#, no-c-format
msgid "At a logical level, virtual CPU pinning is a form of hardware pass-through. Pinning couples physical resources to virtual resources, and can also be problematic for migration. For example, the migration will fail if the requested physical resources are not available on the destination host, or if the source and destination hosts have different NUMA topologies. For more recommendations about Live Migration see <xref linkend=\"libvirt-admin-live-migration-requirements\"/> ."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:1461
#, no-c-format
msgid "NUMA tuning"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1462
#, no-c-format
msgid "NUMA is an acronym for Non Uniform Memory Access. A NUMA system has multiple physical CPUs, each with local memory attached. Each CPU can also access other CPUs' memory, known as <quote>remote memory access</quote> , but it is much slower than accessing local memory. NUMA systems can negatively impact &vmguest; performance if not tuned properly. Although ultimately tuning is workload dependent, this section describes controls that should be considered when deploying &vmguest;s on NUMA hosts. Always consider your host topology when configuring and deploying VMs."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1472
#, no-c-format
msgid "&productname; contains a NUMA auto-balancer that strives to reduce remote memory access by placing memory on the same NUMA node as the CPU processing it. In addition, standard tools such as <command>cgset</command> and virtualization tools such as libvirt provide mechanisms to constrain &vmguest; resources to physical resources."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1479
#, no-c-format
msgid "<command>numactl</command> is used to check for host NUMA capabilities:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:1482
#, no-c-format
msgid "&prompt.user;&sudo; numactl --hardware\n"
      "available: 4 nodes (0-3)\n"
      "node 0 cpus: 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 72 73 74 75 76 77 78\n"
      "79 80 81 82 83 84 85 86 87 88 89\n"
      "node 0 size: 31975 MB\n"
      "node 0 free: 31120 MB\n"
      "node 1 cpus: 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 90 91 92 93\n"
      "94 95 96 97 98 99 100 101 102 103 104 105 106 107\n"
      "node 1 size: 32316 MB\n"
      "node 1 free: 31673 MB\n"
      "node 2 cpus: 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 108 109 110\n"
      "111 112 113 114 115 116 117 118 119 120 121 122 123 124 125\n"
      "node 2 size: 32316 MB\n"
      "node 2 free: 31726 MB\n"
      "node 3 cpus: 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 126 127 128\n"
      "129 130 131 132 133 134 135 136 137 138 139 140 141 142 143\n"
      "node 3 size: 32314 MB\n"
      "node 3 free: 31387 MB\n"
      "node distances:\n"
      "node   0   1   2   3\n"
      "0:  10  21  21  21\n"
      "1:  21  10  21  21\n"
      "2:  21  21  10  21\n"
      "3:  21  21  21  10"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1506
#, no-c-format
msgid "The <command>numactl</command> output shows this is a NUMA system with 4 nodes or cells, each containing 36 CPUs and approximately 32G memory. <command>virsh capabilities</command> can also be used to examine the systems NUMA capabilities and CPU topology."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:1513
#, no-c-format
msgid "NUMA balancing"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1514
#, no-c-format
msgid "On NUMA machines, there is a performance penalty if remote memory is accessed by a CPU. Automatic NUMA balancing scans a task's address space and unmaps pages. By doing so, it detects whether pages are properly placed or whether to migrate the data to a memory node local to where the task is running. In defined intervals (configured with <literal>numa_balancing_scan_delay_ms</literal> ), the task scans the next scan size number of pages (configured with <literal>numa_balancing_scan_size_mb</literal> ) in its address space. When the end of the address space is reached the scanner restarts from the beginning."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1526
#, no-c-format
msgid "Higher scan rates cause higher system overhead as page faults must be trapped and data needs to be migrated. However, the higher the scan rate, the more quickly a task's memory is migrated to a local node when the workload pattern changes. This minimizes the performance impact caused by remote memory accesses. These <command>sysctl</command> directives control the thresholds for scan delays and the number of pages scanned:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:1534
#, no-c-format
msgid "&prompt.user;&sudo; sysctl -a | grep numa_balancing\n"
      "kernel.numa_balancing = 1<co xml:id=\"co-numa-balancing\"/>\n"
      "kernel.numa_balancing_scan_delay_ms = 1000<co xml:id=\"co-numa-delay\"/>\n"
      "kernel.numa_balancing_scan_period_max_ms = 60000<co xml:id=\"co-numa-pmax\"/>\n"
      "kernel.numa_balancing_scan_period_min_ms = 1000<co xml:id=\"co-numa-pmin\"/>\n"
      "kernel.numa_balancing_scan_size_mb = 256<co xml:id=\"co-numa-size\"/>"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1542
#, no-c-format
msgid "Enables/disables automatic page fault-based NUMA balancing"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1547
#, no-c-format
msgid "Starting scan delay used for a task when it initially forks"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1552
#, no-c-format
msgid "Maximum time in milliseconds to scan a task's virtual memory"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1557
#, no-c-format
msgid "Minimum time in milliseconds to scan a task's virtual memory"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1562
#, no-c-format
msgid "Size in megabytes' worth of pages to be scanned for a given scan"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1567
#, no-c-format
msgid "For more information see <xref linkend=\"cha-tuning-numactl\"/> ."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1570
#, no-c-format
msgid "The main goal of automatic NUMA balancing is either to reschedule tasks on the same node's memory (so the CPU follows the memory), or to copy the memory's pages to the same node (so the memory follows the CPU)."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:1576
#, no-c-format
msgid "Task placement"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1577
#, no-c-format
msgid "There are no rules to define the best place to run a task, because tasks could share memory with other tasks. For best performance, it is recommended to group tasks sharing memory on the same node. Check NUMA statistics with <command># cat /proc/vmstat | grep numa_</command> ."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:1586
#, no-c-format
msgid "Memory allocation control with the CPUset controller"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1587
#, no-c-format
msgid "The cgroups cpuset controller can be used confine memory used by a process to a NUMA node. There are three cpuset memory policy modes available:"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1593
#, no-c-format
msgid "<literal>interleave</literal> : This is a memory placement policy which is also known as round-robin. This policy can provide substantial improvements for jobs that need to place thread local data on the corresponding node. When the interleave destination is not available, it will be moved to another node."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1602
#, no-c-format
msgid "<literal>bind</literal> : This will place memory only on one node, which means in case of insufficient memory, the allocation will fail."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1608
#, no-c-format
msgid "<literal>preferred</literal> : This policy will apply a preference to allocate memory to a node. If there is not enough space for memory on this node, it will fall back to another node."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1615
#, no-c-format
msgid "You can change the memory policy mode with the <command>cgset</command> tool from the <package>libcgroup-tools</package> package:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:1619
#, no-c-format
msgid "&prompt.user;&sudo; cgset -r cpuset.mems=<replaceable>NODE</replaceable> sysdefault/libvirt/qemu/<replaceable>KVM_NAME</replaceable>/emulator"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1620
#, no-c-format
msgid "To migrate pages to a node, use the <command>migratepages</command> tool:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:1623
#, no-c-format
msgid "&prompt.user;migratepages <replaceable>PID</replaceable> <replaceable>FROM-NODE</replaceable> <replaceable>TO-NODE</replaceable>"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1624
#, no-c-format
msgid "To check everything is fine. use: <command>cat /proc/<replaceable>PID</replaceable>/status | grep Cpus</command> ."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:1629
#, no-c-format
msgid "Kernel NUMA/cpuset memory policy"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1630
#, no-c-format
msgid "For more information see <link xlink:href=\"https://www.kernel.org/doc/Documentation/vm/numa_memory_policy.txt\">Kernel NUMA memory policy</link> and <link xlink:href=\"https://www.kernel.org/doc/Documentation/cgroup-v1/cpusets.txt\">cpusets memory policy</link> . Check also the <link xlink:href=\"https://libvirt.org/formatdomain.html#elementsNUMATuning\">Libvirt NUMA Tuning documentation</link> ."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:1642
#, no-c-format
msgid "&vmguest;: NUMA related configuration"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1643
#, no-c-format
msgid "&libvirt; allows to set up virtual NUMA and memory access policies. Configuring these settings is not supported by <command>virt-install</command> or <command>virt-manager</command> and needs to be done manually by editing the &vmguest; configuration file with <command>virsh edit</command> ."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:1651
#, no-c-format
msgid "&vmguest; virtual NUMA topology"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1652
#, no-c-format
msgid "Creating a &vmguest; virtual NUMA (vNUMA) policy that resembles the host NUMA topology can often increase performance of traditional large, scale-up workloads. &vmguest; vNUMA topology can be specified using the <literal>numa</literal> element in the XML configuration:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:1658
#, no-c-format
msgid "&lt;cpu&gt;\n"
      "...\n"
      "  &lt;numa&gt;\n"
      "    &lt;cell<co xml:id=\"co-numa-cell\"/> id=\"0\"<co xml:id=\"co-numa-id\"/> cpus='0-1'<co xml:id=\"co-numa-cpus\"/> memory='512000' unit='KiB'/&gt;\n"
      "    &lt;cell id=\"1\" cpus='2-3' memory='256000'<co xml:id=\"co-numa-mem\"/>\n"
      "    unit='KiB'<co xml:id=\"co-numa-unit\"/> memAccess='shared'<co xml:id=\"co-numa-memaccess\"/>/&gt;\n"
      "  &lt;/numa&gt;\n"
      "  ...\n"
      "&lt;/cpu&gt;"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1670
#, no-c-format
msgid "Each <literal>cell</literal> element specifies a vNUMA cell or node"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1675
#, no-c-format
msgid "All cells should have an <literal>id</literal> attribute, allowing to reference the cell in other configuration blocks. Otherwise cells are assigned ids in ascending order starting from 0."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1682
#, no-c-format
msgid "The CPU or range of CPUs that are part of the node"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1687
#, no-c-format
msgid "The node memory"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1692
#, no-c-format
msgid "Units in which node memory is specified"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1697
#, no-c-format
msgid "Optional attribute which can control whether the memory is to be mapped as <option>shared</option> or <option>private</option> . This is valid only for hugepages-backed memory."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1704
#, no-c-format
msgid "To find where the &vmguest; has allocated its pages. use: <command>cat /proc/<replaceable>PID</replaceable>/numa_maps</command> and <command>cat /sys/fs/cgroup/memory/sysdefault/libvirt/qemu/<replaceable>KVM_NAME</replaceable>/memory.numa_stat</command> ."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:1710
#, no-c-format
msgid "NUMA specification"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1711
#, no-c-format
msgid "The &libvirt; &vmguest; NUMA specification is currently only available for &qemu;/&kvm;."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:1718
#, no-c-format
msgid "Memory allocation control with &libvirt;"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1719
#, no-c-format
msgid "If the &vmguest; has a vNUMA topology (see <xref linkend=\"sec-vt-best-perf-numa-vmguest-topo\"/> ), memory can be pinned to host NUMA nodes using the <literal>numatune</literal> element. This method is currently only available for &qemu;/&kvm; guests. See <xref linkend=\"sec-vt-best-perf-numa-alloc-libvirt-non-vnuma\"/> for how to configure non-vNUMA &vmguest;s."
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:1729
#, no-c-format
msgid "&lt;numatune&gt;\n"
      "    &lt;memory mode=\"strict\"<co xml:id=\"co-numat-mode\"/> nodeset=\"1-4,^3\"<co xml:id=\"co-numat-nodeset\"/>/&gt;\n"
      "    &lt;memnode<co xml:id=\"co-numat-memnode\"/> cellid=\"0\"<co xml:id=\"co-numat-cellid\"/> mode=\"strict\" nodeset=\"1\"/&gt;\n"
      "    &lt;memnode cellid=\"2\" placement=\"strict\"<co xml:id=\"co-numat-placement\"/> mode=\"preferred\" nodeset=\"2\"/&gt;\n"
      "&lt;/numatune&gt;"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1736
#, no-c-format
msgid "Policies available are: <literal>interleave</literal> (round-robin like), <literal>strict</literal> (default) or <literal>preferred</literal> ."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1743
#, no-c-format
msgid "Specify the NUMA nodes."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1748
#, no-c-format
msgid "Specify memory allocation policies for each guest NUMA node (if this element is not defined then this will fall back and use the <literal>memory</literal> element)."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1755
#, no-c-format
msgid "Addresses the guest NUMA node for which the settings are applied."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1760
#, no-c-format
msgid "The placement attribute can be used to indicate the memory placement mode for a domain process, the value can be <literal>auto</literal> or <literal>strict</literal> ."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:1768
#, no-c-format
msgid "Non-vNUMA &vmguest;"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1769
#, no-c-format
msgid "On a non-vNUMA &vmguest;, pinning memory to host NUMA nodes is done like in the following example:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:1773
#, no-c-format
msgid "&lt;numatune&gt;\n"
      "   &lt;memory mode=\"strict\" nodeset=\"0-1\"/&gt;\n"
      "&lt;/numatune&gt;"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1776
#, no-c-format
msgid "In this example, memory is allocated from the host nodes <literal>0</literal> and <literal>1</literal> . In case these memory requirements cannot be fulfilled, starting the &vmguest; will fail. <command>virt-install</command> also supports this configuration with the <option>--numatune</option> option."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:1785
#, no-c-format
msgid "Memory and CPU across NUMA nodes"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1786
#, no-c-format
msgid "You should avoid allocating &vmguest; memory across NUMA nodes, and prevent virtual CPUs from floating across NUMA nodes."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:1796
#, no-c-format
msgid "&vmguest; images"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1798
#, no-c-format
msgid "Images are virtual disks used to store the operating system and data of &vmguest;s. They can be created, maintained and queried with the <command>qemu-img</command> command. Refer to <xref linkend=\"cha-qemu-guest-inst-qemu-img-create\"/> for more information on the <command>qemu-img</command> tool and examples."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:1808
#, no-c-format
msgid "&vmguest; image formats"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1809
#, no-c-format
msgid "Certain storage formats which &qemu; recognizes have their origins in other virtualization technologies. By recognizing these formats, &qemu; can leverage either data stores or entire guests that were originally targeted to run under these other virtualization technologies. Some formats are supported only in read-only mode. To use them in read/write mode, convert them to a fully supported &qemu; storage format (using <command>qemu-img</command> ). Otherwise they can only be used as read-only data store in a QEMU guest."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1819
#, no-c-format
msgid "Use <command>qemu-img info <replaceable>VMGUEST.IMG</replaceable></command> to get information about an existing image, such as: the format, the virtual size, the physical size, snapshots if available."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:1825
#, no-c-format
msgid "Performance"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1826
#, no-c-format
msgid "It is recommended to convert the disk images to either raw or qcow2 to achieve good performance."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:1832
#, no-c-format
msgid "Encrypted images cannot be compressed"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1833
#, no-c-format
msgid "When you create an image, you cannot use compression ( <option>-c</option> ) in the output file together with the encryption option ( <option>-e</option> )."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:1840
#, no-c-format
msgid "Raw format"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1844
#, no-c-format
msgid "This format is simple and easily exportable to all other emulators/hypervisors."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1850
#, no-c-format
msgid "It provides best performance (least I/O overhead)."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1855
#, no-c-format
msgid "It occupies all allocated space on the file system."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1860
#, no-c-format
msgid "The raw format allows to copy a &vmguest; image to a physical device ( <command>dd if=<replaceable>VMGUEST.RAW</replaceable> of=<replaceable>/dev/sda</replaceable></command> )."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1867
#, no-c-format
msgid "It is byte-for-byte the same as what the &vmguest; sees, so this wastes a lot of space."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:1875
#, no-c-format
msgid "qcow2 format"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1879
#, no-c-format
msgid "Use this to have smaller images (useful if your file system does not supports holes)."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1885
#, no-c-format
msgid "It has optional AES encryption (now deprecated)."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1890
#, no-c-format
msgid "Zlib-based compression option."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1895
#, no-c-format
msgid "Support of multiple VM snapshots (internal, external)."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1900
#, no-c-format
msgid "Improved performance and stability."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1905
#, no-c-format
msgid "Supports changing the backing file."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1910
#, no-c-format
msgid "Supports consistency checks."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1915
#, no-c-format
msgid "Less performance than raw format."
msgstr ""

#. Tag: term
#: art_virtualization-best-practices.xml:1922
#, no-c-format
msgid "l2-cache-size"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1924
#, no-c-format
msgid "qcow2 can provide the same performance for random read/write access as raw format, but it needs a well-sized cache size. By default cache size is set to 1 MB. This will give good performance up to a disk size of 8 GB. If you need a bigger disk size, you need to adjust the cache size. For a disk size of 64 GB (64*1024 = 65536), you need 65536 / 8192B = 8 MB of cache ( <option>-drive format=qcow2,l2-cache-size=8M</option> )."
msgstr ""

#. Tag: term
#: art_virtualization-best-practices.xml:1935
#, no-c-format
msgid "Cluster size"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1937
#, no-c-format
msgid "The qcow2 format offers the capability to change the cluster size. The value must be between 512&nbsp;KB and 2&nbsp;MB. Smaller cluster sizes can improve the image file size whereas larger cluster sizes generally provide better performance."
msgstr ""

#. Tag: term
#: art_virtualization-best-practices.xml:1946
#, no-c-format
msgid "Preallocation"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1948
#, no-c-format
msgid "An image with preallocated metadata is initially larger but can improve performance when the image needs to grow."
msgstr ""

#. Tag: term
#: art_virtualization-best-practices.xml:1955
#, no-c-format
msgid "Lazy refcounts"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1957
#, no-c-format
msgid "Reference count updates are postponed with the goal of avoiding metadata I/O and improving performance. This is particularly beneficial with <option>cache=writethrough</option> . This option does not batch metadata updates, but if in case of host crash, the reference count tables must be rebuilt, this is done automatically at the next open with <command>qemu-img check -r all</command> . Note that this takes some time."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:1971
#, no-c-format
msgid "qed format"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1972
#, no-c-format
msgid "qed is a follow-on qcow (&qemu; Copy On Write) format. Because qcow2 provides all the benefits of qed and more, qed is now deprecated."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:1978
#, no-c-format
msgid "VMDK format"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1979
#, no-c-format
msgid "VMware 3, 4, or 6 image format, for exchanging images with that product."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:1986
#, no-c-format
msgid "Overlay disk images"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1987
#, no-c-format
msgid "The qcow2 and qed formats provide a way to create a base image (also called backing file) and overlay images on top of the base image. A backing file is useful to be able to revert to a known state and discard the overlay. If you write to the image, the backing image will be untouched and all changes will be recorded in the overlay image file. The backing file will never be modified unless you use the <option>commit</option> monitor command (or <command>qemu-img commit</command> )."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:1996
#, no-c-format
msgid "To create an overlay image:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:1999
#, no-c-format
msgid "&prompt.root;qemu-img create -o<co xml:id=\"co-1-minoro\"/>backing_file=vmguest.raw<co xml:id=\"co-1-backingfile\"/>,backing_fmt=raw<co xml:id=\"co-1-backingfmt\"/>\\\n"
      "     -f<co xml:id=\"co-1-minorf\"/> qcow2 vmguest.cow<co xml:id=\"co-1-imagename\"/>"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2003
#, no-c-format
msgid "Use <option>-o ?</option> for an overview of available options."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2008
#, no-c-format
msgid "The backing file name."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2013
#, no-c-format
msgid "Specify the file format for the backing file."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2018
#, no-c-format
msgid "Specify the image format for the &vmguest;."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2023
#, no-c-format
msgid "Image name of the &vmguest;, it will only record the differences from the backing file."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:2030
#, no-c-format
msgid "Backing image path"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2031
#, no-c-format
msgid "You should not change the path to the backing image, otherwise you will need to adjust it. The path is stored in the overlay image file. To update the path, you should make a symbolic link from the original path to the new path and then use the <command>qemu-img</command> <option>rebase</option> option."
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:2038
#, no-c-format
msgid "\n"
      "&prompt.root;ln -sf /var/lib/images/<replaceable>OLD_PATH</replaceable>/vmguest.raw  \\\n"
      " /var/lib/images/<replaceable>NEW_PATH</replaceable>/vmguest.raw\n"
      "&prompt.root;qemu-img rebase<co xml:id=\"co-2-rebase\"/> -u<co xml:id=\"co-2-unsafe\"/> -b<co xml:id=\"co-2-minorb\"/> \\\n"
      " /var/lib/images/<replaceable>OLD_PATH</replaceable>/vmguest.raw /var/lib/images/<replaceable>NEW_PATH</replaceable>/vmguest.cow\n"
      ""
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2046
#, no-c-format
msgid "The <command>rebase</command> subcommand tells <command>qemu-img</command> to change the backing file image."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2052
#, no-c-format
msgid "The <option>-u</option> option activates the unsafe mode (see note below). There are two different modes in which <option>rebase</option> can operate:"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2059
#, no-c-format
msgid "<emphasis>Safe</emphasis> : This is the default mode and performs a real rebase operation. The safe mode is a time-consuming operation."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2065
#, no-c-format
msgid "<emphasis>Unsafe</emphasis> : The unsafe mode ( <option>-u</option> ) only changes the backing files name and the format of the file name without making any checks on the files contents. You should use this mode to rename or moving a backing file."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2075
#, no-c-format
msgid "The backing image to be used is specified with <option>-b</option> and the image path is the last argument of the command."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2082
#, no-c-format
msgid "A common use is to initiate a new guest with the backing file. Let's assume we have a <filename>sle15_base.img</filename> &vmguest; ready to be used (fresh installation without any modification). This will be our backing file. Now you need to test a new package, on an updated system and on a system with a different kernel. We can use <filename>sle15_base.img</filename> to instantiate the new &sle; &vmguest; by creating a qcow2 overlay file pointing to this backing file ( <filename>sle15_base.img</filename> )."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2092
#, no-c-format
msgid "In our example we will use <filename>sle15_updated.qcow2</filename> for the updated system, and <filename>sle15_kernel.qcow2</filename> for the system with a different kernel."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2097
#, no-c-format
msgid "To create the two thin provisioned systems use the <command>qemu-img</command> command line with the <option>-b</option> option:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:2102
#, no-c-format
msgid "&prompt.root;qemu-img create -b /var/lib/libvirt/sle15_base.img -f qcow2 \\\n"
      "/var/lib/libvirt/sle15_updated.qcow2\n"
      "Formatting 'sle15_updated.qcow2', fmt=qcow2 size=17179869184\n"
      "backing_file='sle15_base.img' encryption=off cluster_size=65536\n"
      "lazy_refcounts=off nocow=off\n"
      "&prompt.root;qemu-img create -b /var/lib/libvirt/sle15_base.img -f qcow2 \\\n"
      "/var/lib/libvirt/sle15_kernel.qcow2\n"
      "Formatting 'sle15_kernel.qcow2', fmt=qcow2 size=17179869184\n"
      "backing_file='vmguest-sle15_base.img' encryption=off cluster_size=65536\n"
      "lazy_refcounts=off nocow=off"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2112
#, no-c-format
msgid "The images are now usable, and you can do your test without touching the initial <filename>sle15_base.img</filename> backing file. All changes will be stored in the new overlay images. Additionally, you can also use these new images as a backing file, and create a new overlay."
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:2118
#, no-c-format
msgid "&prompt.root;qemu-img create -b sle15_kernel.qcow2 -f qcow2 sle15_kernel_TEST.qcow2"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2119
#, no-c-format
msgid "When using <command>qemu-img info</command> with the option <option>--backing-chain</option> , it will return all information about the entire backing chain recursively:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:2124
#, no-c-format
msgid "&prompt.root;qemu-img info --backing-chain\n"
      "/var/lib/libvirt/images/sle15_kernel_TEST.qcow2\n"
      "image: sle15_kernel_TEST.qcow2\n"
      "file format: qcow2\n"
      "virtual size: 16G (17179869184 bytes)\n"
      "disk size: 196K\n"
      "cluster_size: 65536\n"
      "backing file: sle15_kernel.qcow2\n"
      "Format specific information:\n"
      "compat: 1.1\n"
      "lazy refcounts: false\n"
      "\n"
      "image: sle15_kernel.qcow2\n"
      "file format: qcow2\n"
      "virtual size: 16G (17179869184 bytes)\n"
      "disk size: 196K\n"
      "cluster_size: 65536\n"
      "backing file: SLE15.qcow2\n"
      "Format specific information:\n"
      "compat: 1.1\n"
      "lazy refcounts: false\n"
      "\n"
      "image: sle15_base.img\n"
      "file format: qcow2\n"
      "virtual size: 16G (17179869184 bytes)\n"
      "disk size: 16G\n"
      "cluster_size: 65536\n"
      "Format specific information:\n"
      "compat: 1.1\n"
      "lazy refcounts: true"
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:2155
#, no-c-format
msgid "Understanding image overlay"
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:2218
#, no-c-format
msgid "Opening a &vmguest; image"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2219
#, no-c-format
msgid "To access the file system of an image, use the <package>guestfs-tools</package> . If you do not have this tool installed on your system you can mount an image with other Linux tools. Avoid accessing an untrusted or unknown &vmguest;'s image system because this can lead to security issues (for more information, read <link xlink:href=\"https://www.berrange.com/posts/2013/02/20/a-reminder-why-you-should-never-mount-guest-disk-images-on-the-host-os/\">D. Berrang's post</link> )."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:2230
#, no-c-format
msgid "Opening a raw image"
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:2232
#, no-c-format
msgid "Mounting a raw image"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2234
#, no-c-format
msgid "To be able to mount the image, find a free loop device. The following command displays the first unused loop device, <filename>/dev/loop1</filename> in this example."
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:2239
#, no-c-format
msgid "&prompt.root;losetup -f\n"
      "/dev/loop1"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2243
#, no-c-format
msgid "Associate an image ( <filename>SLE15.raw</filename> in this example) with the loop device:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:2247
#, no-c-format
msgid "&prompt.root;losetup /dev/loop1 SLE15.raw"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2250
#, no-c-format
msgid "Check whether the image has successfully been associated with the loop device by getting detailed information about the loop device:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:2254
#, no-c-format
msgid "&prompt.root;losetup -l\n"
      "NAME       SIZELIMIT OFFSET AUTOCLEAR RO BACK-FILE\n"
      "/dev/loop1         0      0         0  0    /var/lib/libvirt/images/SLE15.raw"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2259
#, no-c-format
msgid "Check the image's partitions with <command>kpartx</command> :"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:2262
#, no-c-format
msgid "&prompt.root;kpartx -a<co xml:id=\"co-kpartx-a\"/> -v<co xml:id=\"co-kpartx-v\"/> /dev/loop1\n"
      "add map loop1p1 (254:1): 0 29358080 linear /dev/loop1 2048"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2266
#, no-c-format
msgid "Add partition device mappings."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2271
#, no-c-format
msgid "Verbose mode."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2278
#, no-c-format
msgid "Now mount the image partition(s) (to <filename>/mnt/sle15mount</filename> in the following example):"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:2282
#, no-c-format
msgid "&prompt.root;mkdir /mnt/sle15mount\n"
      "&prompt.root;mount /dev/mapper/loop1p1 /mnt/sle15mount"
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:2287
#, no-c-format
msgid "Raw image with LVM"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2288
#, no-c-format
msgid "If your raw image contains an LVM volume group you should use LVM tools to mount the partition. Refer to <xref linkend=\"sec-lvm-found\"/> ."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:2294
#, no-c-format
msgid "Unmounting a raw image"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:2299
#, no-c-format
msgid "&prompt.root;umount /mnt/sle15mount"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2302
#, no-c-format
msgid "Delete partition device mappings with <command>kpartx</command> :"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:2305
#, no-c-format
msgid "&prompt.root;kpartx -d /dev/loop1"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2308
#, no-c-format
msgid "Detach the devices with <command>losetup</command>"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:2311
#, no-c-format
msgid "&prompt.root;losetup -d /dev/loop1"
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:2316
#, no-c-format
msgid "Opening a qcow2 image"
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:2318
#, no-c-format
msgid "Mounting a qcow2 image"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2320
#, no-c-format
msgid "First you need to load the <literal>nbd</literal> (network block devices) module. The following example loads it with support for 16 block devices ( <option>max_part=16</option> ). Check with <command>dmesg</command> whether the operation was successful:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:2326
#, no-c-format
msgid "&prompt.root;modprobe nbd max_part=16\n"
      "&prompt.root;dmesg | grep nbd\n"
      "[89155.142425] nbd: registered device at major 43"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2331
#, no-c-format
msgid "Connect the &vmguest; image (for example <filename>SLE15.qcow2</filename> ) to an NBD device ( <filename>/debv/nbd0</filename> in the following example) with the <command>qemu-nbd</command> command. Make sure to use a free NBD device:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:2337
#, no-c-format
msgid "&prompt.root;qemu-nbd -c<co xml:id=\"co-qemunbd-minusc\"/> /dev/nbd0<co xml:id=\"co-qemunbd-device\"/> SLE15.qcow2<co xml:id=\"co-qemunbd-image\"/>"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2340
#, no-c-format
msgid "Connect <filename>SLE15.qcow2</filename> to the local NBD device <filename>/dev/nbd0</filename>"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2346
#, no-c-format
msgid "NBD device to use"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2351
#, no-c-format
msgid "&vmguest; image to use"
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:2357
#, no-c-format
msgid "Checking for a free NBD device"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2358
#, no-c-format
msgid "To check whether an NBD device is free, run the following command:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:2361
#, no-c-format
msgid "&prompt.root;lsof /dev/nbd0\n"
      "COMMAND    PID USER   FD   TYPE DEVICE SIZE/OFF  NODE NAME\n"
      "qemu-nbd 15149 root   10u   BLK   43,0      0t0 47347 /dev/nbd0"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2364
#, no-c-format
msgid "If the command produces an output like in the example above, the device is busy (not free). This can also be confirmed by the presence of the <filename>/sys/devices/virtual/block/nbd0/pid</filename> file."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2372
#, no-c-format
msgid "Inform the operating system about partition table changes with <command>partprobe</command> :"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:2376
#, no-c-format
msgid "&prompt.root;partprobe /dev/nbd0 -s\n"
      "/dev/nbd0: msdos partitions 1 2\n"
      "&prompt.root;dmesg | grep nbd0 | tail -1\n"
      "[89699.082206]  nbd0: p1 p2"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2382
#, no-c-format
msgid "In the example above, the <filename>SLE15.qcow2</filename> contains two partitions: <filename>/dev/nbd0p1</filename> and <filename>/dev/nbd0p2</filename> . Before mounting these partitions, use <command>vgscan</command> to check whether they belong to an LVM volume:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:2388
#, no-c-format
msgid "&prompt.root;vgscan -v\n"
      "    Wiping cache of LVM-capable devices\n"
      "    Wiping internal VG cache\n"
      "    Reading all physical volumes. This may take a while...\n"
      "    Using volume group(s) on command line.\n"
      "    No volume groups found."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2396
#, no-c-format
msgid "If no LVM volume has been found, you can mount the partition with <command>mount</command> :"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:2400
#, no-c-format
msgid "&prompt.root;mkdir /mnt/nbd0p2\n"
      "# mount /dev/nbd0p1 /mnt/nbd0p2"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2402
#, no-c-format
msgid "Refer to <xref linkend=\"sec-lvm-found\"/> for information on how to handle LVM volumes."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:2409
#, no-c-format
msgid "Unmounting a qcow2 image"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2411
#, no-c-format
msgid "Unmount all mounted partitions of the image, for example:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:2414
#, no-c-format
msgid "&prompt.root;umount /mnt/nbd0p2"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2417
#, no-c-format
msgid "Disconnect the image from the <filename>/dev/nbd0</filename> device."
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:2420
#, no-c-format
msgid "&prompt.root;qemu-nbd -d /dev/nbd0"
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:2425
#, no-c-format
msgid "Opening images containing LVM"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2427
#, no-c-format
msgid "If your &vmhost; uses VG name <literal>system</literal> , and the guest image also uses VG name <literal>system</literal> , LVM will complain during its activation. A workaround is to temporarily rename the guest VG, while a correct approach is to use different VG names for the guests than for the &vmhost;."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:2436
#, no-c-format
msgid "Mounting images containing LVM"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2438
#, no-c-format
msgid "To check images for LVM groups, use <command>vgscan -v</command> . If an image contains LVM groups, the output of the command looks like the following:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:2443
#, no-c-format
msgid "&prompt.root;vgscan -v\n"
      "Wiping cache of LVM-capable devices\n"
      "Wiping internal VG cache\n"
      "Reading all physical volumes.  This may take a while...\n"
      "Finding all volume groups\n"
      "Finding volume group \"system\"\n"
      "Found volume group \"system\" using metadata type lvm2"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2452
#, no-c-format
msgid "The <literal>system</literal> LVM volume group has been found on the system. You can get more information about this volume with <command>vgdisplay <replaceable>VOLUMEGROUPNAME</replaceable></command> (in our case <replaceable>VOLUMEGROUPNAME</replaceable> is <literal>system</literal> ). You should activate this volume group to expose LVM partitions as devices so the system can mount them. Use <command>vgchange</command> :"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:2461
#, no-c-format
msgid "&prompt.root;vgchange -ay -v\n"
      "Finding all volume groups\n"
      "Finding volume group \"system\"\n"
      "Found volume group \"system\"\n"
      "activation/volume_list configuration setting not defined: Checking only\n"
      "host tags for system/home\n"
      "Creating system-home\n"
      "Loading system-home table (254:0)\n"
      "Resuming system-home (254:0)\n"
      "Found volume group \"system\"\n"
      "activation/volume_list configuration setting not defined: Checking only\n"
      "host tags for system/root\n"
      "Creating system-root\n"
      "Loading system-root table (254:1)\n"
      "Resuming system-root (254:1)\n"
      "Found volume group \"system\"\n"
      "activation/volume_list configuration setting not defined: Checking only\n"
      "host tags for system/swap\n"
      "Creating system-swap\n"
      "Loading system-swap table (254:2)\n"
      "Resuming system-swap (254:2)\n"
      "Activated 3 logical volumes in volume group system\n"
      "    3 logical volume(s) in volume group \"system\" now active"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2486
#, no-c-format
msgid "All partitions in the volume group will be listed in the <filename>/dev/mapper</filename> directory. You can simply mount them now."
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:2491
#, no-c-format
msgid "&prompt.root;ls /dev/mapper/system-*\n"
      "/dev/mapper/system-home  /dev/mapper/system-root /dev/mapper/system-swap\n"
      "\n"
      "&prompt.root;mkdir /mnt/system-root\n"
      "&prompt.root;mount  /dev/mapper/system-root /mnt/system-root\n"
      "\n"
      "&prompt.root;ls /mnt/system-root/\n"
      "bin   dev  home  lib64       mnt  proc        root  sbin     srv  tmp  var\n"
      "boot  etc  lib   lost+found  opt  read-write  run   selinux  sys  usr"
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:2503
#, no-c-format
msgid "Unmounting images containing LVM"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2505
#, no-c-format
msgid "Unmount all partitions (with <command>umount</command> )"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:2508
#, no-c-format
msgid "&prompt.root;umount /mnt/system-root"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2511
#, no-c-format
msgid "Deactivate the LVM volume group (with <command>vgchange -an <replaceable>VOLUMEGROUPNAME</replaceable></command> )"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:2515
#, no-c-format
msgid "&prompt.root;vgchange -an -v system\n"
      "Using volume group(s) on command line\n"
      "Finding volume group \"system\"\n"
      "Found volume group \"system\"\n"
      "Removing system-home (254:0)\n"
      "Found volume group \"system\"\n"
      "Removing system-root (254:1)\n"
      "Found volume group \"system\"\n"
      "Removing system-swap (254:2)\n"
      "Deactivated 3 logical volumes in volume group system\n"
      "0 logical volume(s) in volume group \"system\" now active"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2528
#, no-c-format
msgid "Now you have two choices:"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2533
#, no-c-format
msgid "In case of a qcow2 image, proceed as described in <xref linkend=\"st-umount-qcow2\"/> ( <command>qemu-nbd -d /dev/nbd0</command> )."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2540
#, no-c-format
msgid "In case of a raw image, proceeds as described in <xref linkend=\"st-umount-raw\"/> ( <command>kpartx -d /dev/loop1</command> ; <command>losetup -d /dev/loop1</command> )."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:2548
#, no-c-format
msgid "Check for a successful unmount"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2549
#, no-c-format
msgid "You should double-check that unmounting succeeded by using a system command like <command>losetup</command> , <command>qemu-nbd</command> , <command>mount</command> or <command>vgscan</command> . If this is not the case you may have trouble using the &vmguest; because its system image is used in different places."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:2563
#, no-c-format
msgid "File system sharing"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2564
#, no-c-format
msgid "You can access a host directory in the &vmguest; using the <tag class=\"element\">filesystem</tag> element. In the following example we will share the <filename>/data/shared</filename> directory and mount it in the &vmguest;. Note that the <tag class=\"attribute\">accessmode</tag> parameter only works with <tag class=\"attribute\">type='mount'</tag> for the &qemu;/&kvm; driver (most other values for <tag class=\"attribute\">type</tag> are exclusively used for the LXC driver)."
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:2573
#, no-c-format
msgid "&lt;filesystem type='mount'<co xml:id=\"co-fs-mount\"/> accessmode='mapped'<co xml:id=\"co-fs-mode\"/>&gt;\n"
      "   &lt;source dir='/data/shared'<co xml:id=\"co-fs-sourcedir\"/>&gt;\n"
      "   &lt;target dir='shared'<co xml:id=\"co-fs-targetdir\"/>/&gt;\n"
      "&lt;/filesystem&gt;"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2579
#, no-c-format
msgid "A host directory to mount &vmguest;."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2584
#, no-c-format
msgid "Access mode (the security mode) set to <literal>mapped</literal> will give access with the permissions of the hypervisor. Use <literal>passthrough</literal> to access this share with the permissions of the user inside the &vmguest;."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2592
#, no-c-format
msgid "Path to share with the &vmguest;."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2597
#, no-c-format
msgid "Name or label of the path for the mount command."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2602
#, no-c-format
msgid "To mount the <literal>shared</literal> directory on the &vmguest;, use the following commands: Under the &vmguest; now you need to mount the <literal>target dir='shared'</literal> :"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:2607
#, no-c-format
msgid "&prompt.root;mkdir /opt/mnt_shared\n"
      "&prompt.root;mount shared -t 9p /opt/mnt_shared -o trans=virtio"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2609
#, no-c-format
msgid "See <link xlink:href=\"https://libvirt.org/formatdomain.html#elementsFilesystems\">&libvirt; File System </link> and <link xlink:href=\"http://wiki.qemu.org/Documentation/9psetup\">&qemu; 9psetup</link> for more information."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:2619
#, no-c-format
msgid "&vmguest; configuration"
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:2622
#, no-c-format
msgid "Virtio driver"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2623
#, no-c-format
msgid "To increase &vmguest; performance it is recommended to use paravirtualized drivers within the &vmguest;s. The virtualization standard for such drivers for &kvm; are the <literal>virtio</literal> drivers, which are designed for running in a virtual environment. &xen; uses similar paravirtualized device drivers (like <link xlink:href=\"https://www.suse.com/products/vmdriverpack/\">VMDP</link> in a Windows* guest)."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:2633
#, no-c-format
msgid "<literal>virtio blk</literal>"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2634
#, no-c-format
msgid "<literal>virtio_blk</literal> is the virtio block device for disk. To use the <literal>virtio blk</literal> driver for a block device, specify the <tag class=\"attribute\">bus='virtio'</tag> attribute in the <tag class=\"element\">disk</tag> definition:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:2641
#, no-c-format
msgid "&lt;disk type='....' device='disk'&gt;\n"
      "    ....\n"
      "    &lt;target dev='vda' bus='virtio'/&gt;\n"
      "&lt;/disk&gt;"
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:2646
#, no-c-format
msgid "Disk device names"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2647
#, no-c-format
msgid "<literal>virtio</literal> disk devices are named <literal>/dev/vd[a-z][1-9]</literal> . If you migrate a Linux guest from a non-virtio disk you need to adjust the <literal>root=</literal> parameter in the GRUB configuration, and regenerate the <filename>initrd</filename> file. Otherwise the system cannot boot. On &vmguest;s with other operating systems, the boot loader may need to be adjusted or reinstalled accordingly, too."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:2658
#, no-c-format
msgid "Using <literal>virtio</literal> disks with <command>qemu-system-ARCH</command>"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2659
#, no-c-format
msgid "When running <command>qemu-system-ARCH</command> , use the <option>-drive</option> option to add a disk to the &vmguest;. See <xref linkend=\"cha-qemu-guest-inst-qemu-kvm\"/> for an example. The <option>-hd[abcd]</option> option will not work for virtio disks."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:2668
#, no-c-format
msgid "virtio net"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2669
#, no-c-format
msgid "<literal>virtio_net</literal> is the virtio network device. The kernel modules should be loaded automatically in the guest at boot time. You need to start the service to make the network available."
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:2674
#, no-c-format
msgid "&lt;interface type='network'&gt;\n"
      "    ...\n"
      "    &lt;model type='virtio' /&gt;\n"
      "&lt;/interface&gt;"
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:2680
#, no-c-format
msgid "virtio balloon"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2681
#, no-c-format
msgid "The virtio balloon is used for host memory over-commits for guests. For Linux guests, the balloon driver runs in the guest kernel, whereas for Windows guests, the balloon driver is in the VMDP package. <literal>virtio_balloon</literal> is a PV driver to give or take memory from a &vmguest;."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2690
#, no-c-format
msgid "<emphasis>Inflate balloon</emphasis> : Return memory from guest to host kernel (for &kvm;) or to hypervisor (for &xen;)"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2696
#, no-c-format
msgid "<emphasis>Deflate balloon</emphasis> : Guest will have more available memory"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2702
#, no-c-format
msgid "It is controlled by the <literal>currentMemory</literal> and <literal>memory</literal> options."
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:2706
#, no-c-format
msgid "&lt;memory unit='KiB'&gt;16777216&lt;/memory&gt;\n"
      "    &lt;currentMemory unit='KiB'&gt;1048576&lt;/currentMemory&gt;\n"
      "    [...]\n"
      "    &lt;devices&gt;\n"
      "        &lt;memballoon model='virtio'/&gt;\n"
      "    &lt;/devices&gt;"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2712
#, no-c-format
msgid "You can also use <command>virsh</command> to change it:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:2715
#, no-c-format
msgid "&prompt.user;virsh setmem <replaceable>DOMAIN_ID</replaceable> <replaceable>MEMORY in KB</replaceable>"
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:2718
#, no-c-format
msgid "Checking virtio presence"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2719
#, no-c-format
msgid "You can check the virtio block PCI with:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:2722
#, no-c-format
msgid "&prompt.user;find /sys/devices/ -name virtio*\n"
      "/sys/devices/pci0000:00/0000:00:06.0/virtio0\n"
      "/sys/devices/pci0000:00/0000:00:07.0/virtio1\n"
      "/sys/devices/pci0000:00/0000:00:08.0/virtio2"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2726
#, no-c-format
msgid "To find the block device associated with <filename>vdX</filename> :"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:2729
#, no-c-format
msgid "&prompt.user;find /sys/devices/ -name virtio* -print  -exec ls {}/block 2&gt;/dev/null \\;\n"
      "/sys/devices/pci0000:00/0000:00:06.0/virtio0\n"
      "/sys/devices/pci0000:00/0000:00:07.0/virtio1\n"
      "/sys/devices/pci0000:00/0000:00:08.0/virtio2\n"
      "vda"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2734
#, no-c-format
msgid "To get more information on the virtio block:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:2737
#, no-c-format
msgid "&prompt.user;udevadm info -p /sys/devices/pci0000:00/0000:00:08.0/virtio2\n"
      "P: /devices/pci0000:00/0000:00:08.0/virtio2\n"
      "E: DEVPATH=/devices/pci0000:00/0000:00:08.0/virtio2\n"
      "E: DRIVER=virtio_blk\n"
      "E: MODALIAS=virtio:d00000002v00001AF4\n"
      "E: SUBSYSTEM=virtio"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2743
#, no-c-format
msgid "To check all virtio drivers being used:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:2746
#, no-c-format
msgid "&prompt.user;find /sys/devices/ -name virtio* -print  -exec ls -l {}/driver 2&gt;/dev/null \\;\n"
      "/sys/devices/pci0000:00/0000:00:06.0/virtio0\n"
      "lrwxrwxrwx 1 root root 0 Jun 17 15:48 /sys/devices/pci0000:00/0000:00:06.0/virtio0/driver -&gt; ../../../../bus/virtio/drivers/virtio_console\n"
      "/sys/devices/pci0000:00/0000:00:07.0/virtio1\n"
      "lrwxrwxrwx 1 root root 0 Jun 17 15:47 /sys/devices/pci0000:00/0000:00:07.0/virtio1/driver -&gt; ../../../../bus/virtio/drivers/virtio_balloon\n"
      "/sys/devices/pci0000:00/0000:00:08.0/virtio2\n"
      "lrwxrwxrwx 1 root root 0 Jun 17 14:35 /sys/devices/pci0000:00/0000:00:08.0/virtio2/driver -&gt; ../../../../bus/virtio/drivers/virtio_blk"
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:2760
#, no-c-format
msgid "Find device driver options"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2761
#, no-c-format
msgid "Virtio devices and other drivers have various options. To list all of them, use the <option>help</option> parameter of the <command>qemu-system-ARCH</command> command."
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:2766
#, no-c-format
msgid "&prompt.user;qemu-system-x86_64 -device virtio-net,help\n"
      "virtio-net-pci.ioeventfd=on/off\n"
      "virtio-net-pci.vectors=uint32\n"
      "virtio-net-pci.indirect_desc=on/off\n"
      "virtio-net-pci.event_idx=on/off\n"
      "virtio-net-pci.any_layout=on/off\n"
      "....."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:2777
#, no-c-format
msgid "Cirrus video driver"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2778
#, no-c-format
msgid "To get 16-bit color, high compatibility and better performance it is recommended to use the <literal>cirrus</literal> video driver."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:2783
#, no-c-format
msgid "&libvirt;"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2784
#, no-c-format
msgid "&libvirt; ignores the <literal>vram</literal> value because video size has been hardcoded in &qemu;."
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:2789
#, no-c-format
msgid "&lt;video&gt;\n"
      "   &lt;model type='cirrus' vram='9216' heads='1'/&gt;\n"
      "&lt;/video&gt;"
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:2795
#, no-c-format
msgid "Better entropy"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2796
#, no-c-format
msgid "Virtio RNG (random number generator) is a paravirtualized device that is exposed as a hardware RNG device to the guest. On the host side, it can be wired up to one of several sources of entropy (including a real hardware RNG device and the host's <filename>/dev/random</filename> ) if hardware support does not exist. The Linux kernel contains the guest driver for the device from version 2.6.26 and higher."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2804
#, no-c-format
msgid "The system entropy is collected from various non-deterministic hardware events and is mainly used by cryptographic applications. The virtual random number generator device (paravirtualized device) allows the host to pass through entropy to &vmguest; operating systems. This results in a better entropy in the &vmguest;."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2811
#, no-c-format
msgid "To use Virtio RNG, add an <literal>RNG</literal> device in <command>virt-manager</command> or directly in the &vmguest;'s XML configuration:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:2816
#, no-c-format
msgid "&lt;devices&gt;\n"
      "   &lt;rng model='virtio'&gt;\n"
      "       &lt;backend model='random'&gt;/dev/random&lt;/backend&gt;\n"
      "   &lt;/rng&gt;\n"
      "&lt;/devices&gt;"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2821
#, no-c-format
msgid "The host now should used <filename>/dev/random</filename> :"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:2824
#, no-c-format
msgid "&prompt.user;lsof /dev/random\n"
      "qemu-syst 4926 qemu    6r   CHR    1,8      0t0 8199 /dev/random"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2826
#, no-c-format
msgid "On the &vmguest;, the source of entropy can be checked with:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:2829
#, no-c-format
msgid "&prompt.user;cat /sys/devices/virtual/misc/hw_random/rng_available"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2830
#, no-c-format
msgid "The current device used for entropy can be checked with:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:2833
#, no-c-format
msgid "&prompt.user;cat /sys/devices/virtual/misc/hw_random/rng_current\n"
      "virtio_rng.0"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2835
#, no-c-format
msgid "You should install the <package>rng-tools</package> package on the &vmguest;, enable the service, and start it. Under &productname; 15, do the following:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:2840
#, no-c-format
msgid "&prompt.root;zypper in rng-tools\n"
      "&prompt.root;systemctl enable rng-tools\n"
      "&prompt.root;systemctl start rng-tools"
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:2846
#, no-c-format
msgid "Disable unused tools and devices"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2847
#, no-c-format
msgid "Per host, use one virtualization technology only. For example, do not use &kvm; and &xen; on the same host. Otherwise, you may find yourself with a reduced amount of available resources, increased security risk and a longer software update queue. Even when the amount of resources allocated to each of the technologies is configured carefully, the host may suffer from reduced overall availability and degraded performance."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2855
#, no-c-format
msgid "Minimize the amount of software and services available on hosts. Most default installations of operating systems are not optimized for VM usage. Install what you really need and remove all other components in the &vmguest;."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2861
#, no-c-format
msgid "Windows* Guest:"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2866
#, no-c-format
msgid "Disable the screen saver"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2871
#, no-c-format
msgid "Remove all graphical effects"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2876
#, no-c-format
msgid "Disable indexing of hard disks if not necessary"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2886
#, no-c-format
msgid "Check and remove all unneeded devices"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2891
#, no-c-format
msgid "Disable system update if not needed, or configure it to avoid any delay while rebooting or shutting down the host"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2897
#, no-c-format
msgid "Check the Firewall rules"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2902
#, no-c-format
msgid "Schedule backups and anti-virus updates appropriately"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2907
#, no-c-format
msgid "Install the <link xlink:href=\"https://www.suse.com/products/vmdriverpack/\">VMDP</link> paravirtualized driver for best performance"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2914
#, no-c-format
msgid "Check the operating system recommendations, such as on the <link xlink:href=\"http://windows.microsoft.com/en-us/windows/optimize-windows-better-performance#optimize-windows-better-performance=windows-7\">Microsoft Windows* 7 better performance</link> Web page."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2921
#, no-c-format
msgid "Linux Guest:"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2926
#, no-c-format
msgid "Remove or do not start the X Window System if not necessary"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2931
#, no-c-format
msgid "Check the list of started services and disable the ones you do not need"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2936
#, no-c-format
msgid "Check the OS recommendations for kernel parameters that enable better performance"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2942
#, no-c-format
msgid "Only install software that you really need"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2947
#, no-c-format
msgid "Optimize the scheduling of predictable tasks (system updates, hard disk checks, etc.)"
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:2956
#, no-c-format
msgid "Updating the guest machine type"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2957
#, no-c-format
msgid "&qemu; machine types define details of the architecture that are particularly relevant for migration and session management. As changes or improvements to &qemu; are made, new machine types are added. Old machine types are still supported for compatibility reasons, but to take advantage of improvements, we recommend to always migrate to the latest machine type when upgrading."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2965
#, no-c-format
msgid "Changing the guest's machine type for a Linux guest will mostly be transparent. For Windows* guests, we recommend to take a snapshot or backup of the guest&mdash;in case Windows* has issues with the changes it detects and subsequently the user decides to revert to the original machine type the guest was created with."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:2973
#, no-c-format
msgid "Changing the machine type"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2974
#, no-c-format
msgid "Refer to <xref linkend=\"sec-libvirt-config-machinetype-virsh\"/> for documentation."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:2982
#, no-c-format
msgid "&vmguest;-specific configurations and settings"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2985
#, no-c-format
msgid "This section applies to &qemu; / &kvm; hypervisor only."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:2991
#, no-c-format
msgid "ACPI testing"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2992
#, no-c-format
msgid "The ability to change a &vmguest;'s state heavily depends on the operating system. It is very important to test this feature before any use of your &vmguest;s in production. For example, most Linux operating systems disable this capability by default, so this requires you to enable this operation (mostly through &pk;)."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:2999
#, no-c-format
msgid "ACPI must be enabled in the guest for a graceful shutdown to work. To check if ACPI is enabled, run:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:3003
#, no-c-format
msgid "&prompt.user;virsh dumpxml <replaceable>VMNAME</replaceable> | grep acpi"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:3004
#, no-c-format
msgid "If nothing is printed, ACPI is not enabled for your machine. Use <command>virsh edit</command> to add the following XML under &lt;domain&gt;:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:3009
#, no-c-format
msgid "&lt;features&gt;\n"
      "   &lt;acpi/&gt;\n"
      "&lt;/features&gt;"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:3012
#, no-c-format
msgid "If ACPI was enabled during a Windows Server&thrdmrk; guest installation, it is not sufficient to turn it on in the &vmguest; configuration only. For more information, see <link xlink:href=\"https://support.microsoft.com/en-us/kb/309283\"/> . <remark>FIXME: URL is for XP and Server 2003. Is there something newer? - sknorr, 2017-06-07</remark>"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:3022
#, no-c-format
msgid "Regardless of the &vmguest;'s configuration, a graceful shutdown is always possible from within the guest operating system."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:3029
#, no-c-format
msgid "Keyboard layout"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:3030
#, no-c-format
msgid "Though it is possible to specify the keyboard layout from a <command>qemu-system-ARCH</command> command, it is recommended to configure it in the &libvirt; XML file. To change the keyboard layout while connecting to a remote &vmguest; using vnc, you should edit the &vmguest; XML configuration file. For example, to add an <literal>en-us</literal> keymap, add in the <literal>&lt;devices&gt;</literal> section:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:3038
#, no-c-format
msgid "&lt;graphics type='vnc' port='-1' autoport='yes' keymap='en-us'/&gt;"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:3039
#, no-c-format
msgid "Check the <literal>vncdisplay</literal> configuration and connect to your &vmguest;:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:3043
#, no-c-format
msgid "&prompt.user;virsh vncdisplay sles15 127.0.0.1:0"
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:3047
#, no-c-format
msgid "Spice default listen URL"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:3048
#, no-c-format
msgid "If no network interface other than <literal>lo</literal> is assigned an IPv4 address on the host, the default address on which the spice server listens will not work. An error like the following one will occur:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:3053
#, no-c-format
msgid "&prompt.user;virsh start sles15\n"
      "error: Failed to start domain sles15\n"
      "error: internal error: process exited while connecting to monitor: ((null):26929): Spice-Warning **: reds.c:2330:reds_init_socket: getaddrinfo(127.0.0.1,5900): Address family for hostname not supported\n"
      "2015-08-12T11:21:14.221634Z qemu-system-x86_64: failed to initialize spice server"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:3057
#, no-c-format
msgid "To fix this, you can change the default <literal>spice_listen</literal> value in <filename>/etc/libvirt/qemu.conf</filename> using the local IPv6 address <systemitem class=\"ipaddress\">::1</systemitem> . The spice server listening address can also be changed on a per &vmguest; basis, use <command>virsh edit</command> to add the listen XML attribute to the <literal>graphics type='spice'</literal> element:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:3065
#, no-c-format
msgid "&lt;graphics type='spice' listen='::1' autoport='yes'/&gt;&gt;"
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:3069
#, no-c-format
msgid "XML to &qemu; command line"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:3070
#, no-c-format
msgid "Sometimes it could be useful to get the &qemu; command line to launch the &vmguest; from the XML file."
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:3074
#, no-c-format
msgid "&prompt.user;virsh domxml-to-native<co xml:id=\"co-domxml-native\"/> qemu-argv<co xml:id=\"co-domxml-argv\"/> SLE15.xml<co xml:id=\"co-domxml-file\"/>"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:3077
#, no-c-format
msgid "Convert the XML file in domain XML format to the native guest configuration"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:3083
#, no-c-format
msgid "For the &qemu;/&kvm; hypervisor, the format argument needs be qemu-argv"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:3088
#, no-c-format
msgid "Domain XML file to use"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:3093
#, no-c-format
msgid "&prompt.user;&sudo; virsh domxml-to-native qemu-argv /etc/libvirt/qemu/SLE15.xml\n"
      "LC_ALL=C PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin \\\n"
      "   QEMU_AUDIO_DRV=none /usr/bin/qemu-system-x86_64 -name SLE15 -machine \\\n"
      "   pc-i440fx-2.3,accel=kvm,usb=off -cpu SandyBridge -m 4048 -realtime \\\n"
      "   mlock=off -smp 4,sockets=4,cores=1,threads=1 -uuid 8616d00f-5f05-4244-97cc-86aeaed8aea7 \\\n"
      "   -no-user-config -nodefaults -chardev socket,id=charmonitor,path=/var/lib/libvirt/qemu/SLE15.monitor,server,nowait \\\n"
      "   -mon chardev=charmonitor,id=monitor,mode=control -rtc base=utc,driftfix=slew \\\n"
      "   -global kvm-pit.lost_tick_policy=discard -no-hpet \\\n"
      "   -no-shutdown -global PIIX4_PM.disable_s3=1 -global PIIX4_PM.disable_s4=1 \\\n"
      "   -boot strict=on -device ich9-usb-ehci1,id=usb,bus=pci.0,addr=0x4.0x7 \\\n"
      "   -device ich9-usb-uhci1,masterbus=usb.0,firstport=0,bus=pci.0,multifunction=on,addr=0x4 \\\n"
      "   -device ich9-usb-uhci2,masterbus=usb.0,firstport=2,bus=pci.0,addr=0x4.0x1 \\\n"
      "   -device ich9-usb-uhci3,masterbus=usb.0,firstport=4,bus=pci.0,addr=0x4.0x2 \\\n"
      "   -drive file=/var/lib/libvirt/images/SLE15.qcow2,if=none,id=drive-virtio-disk0,format=qcow2,cache=none \\\n"
      "   -device virtio-blk-pci,scsi=off,bus=pci.0,addr=0x6,drive=drive-virtio-disk0,id=virtio-disk0,bootindex=2 \\\n"
      "   -drive if=none,id=drive-ide0-0-1,readonly=on,format=raw  \\\n"
      "   -device ide-cd,bus=ide.0,unit=1,drive=drive-ide0-0-1,id=ide0-0-1 -netdev tap,id=hostnet0  \\\n"
      "   -device virtio-net-pci,netdev=hostnet0,id=net0,mac=52:54:00:28:04:a9,bus=pci.0,addr=0x3,bootindex=1 \\\n"
      "   -chardev pty,id=charserial0 -device isa-serial,chardev=charserial0,id=serial0 \\\n"
      "   -vnc 127.0.0.1:0 -device cirrus-vga,id=video0,bus=pci.0,addr=0x2 \\\n"
      "   -device virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x5 -msg timestamp=on"
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:3117
#, no-c-format
msgid "Change kernel parameters at boot time"
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:3119
#, no-c-format
msgid "&sle; 11"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:3120
#, no-c-format
msgid "To change the value for &slea; 11 products at boot time, you need to modify your <filename>/boot/grub/menu.lst</filename> file by adding the <option>OPTION=parameter</option> . Then reboot your system."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:3127
#, no-c-format
msgid "&sle; 12 and 15"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:3128
#, no-c-format
msgid "To change the value for &slea; 12 and 15 products at boot time, you need to modify your <filename>/etc/default/grub</filename> file. Find the variable starting with <option>GRUB_CMDLINE_LINUX_DEFAULT</option> and add at the end <option>OPTION=parameter</option> (or change it with the correct value if it is already available)."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:3135
#, no-c-format
msgid "Now you need to regenerate your <literal>grub2</literal> configuration:"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:3138
#, no-c-format
msgid "# grub2-mkconfig -o /boot/grub2/grub.cfg"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:3139
#, no-c-format
msgid "Then reboot your system."
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:3146
#, no-c-format
msgid "Add a device to an XML configuration"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:3147
#, no-c-format
msgid "To create a new &vmguest; based on an XML file, you can specify the &qemu; command line using the special tag <literal>qemu:commandline</literal> . For example, to add a virtio-balloon-pci, add this block at the end of the XML configuration file (before the &lt;/domain&gt; tag):"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:3153
#, no-c-format
msgid "&lt;qemu:commandline&gt;\n"
      "    &lt;qemu:arg value='-device'/&gt;\n"
      "    &lt;qemu:arg value='virtio-balloon-pci,id=balloon0'/&gt;\n"
      "&lt;/qemu:commandline&gt;"
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:3159
#, no-c-format
msgid "Adding and removing CPUs"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:3160
#, no-c-format
msgid "Some virtualization environments allow adding or removing CPUs while the virtual machine is running."
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:3164
#, no-c-format
msgid "For the safe removal of CPUs, deactivate them first by executing"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:3167
#, no-c-format
msgid "&prompt.root;<command>echo 0 &gt; /sys/devices/system/cpu/cpu<replaceable>X</replaceable>/online</command>"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:3168
#, no-c-format
msgid "Replace <replaceable>X</replaceable> with the CPU number. To bring a CPU back online, execute"
msgstr ""

#. Tag: screen
#: art_virtualization-best-practices.xml:3172
#, no-c-format
msgid "&prompt.root;<command>echo 1 &gt; /sys/devices/system/cpu/cpu<replaceable>X</replaceable>/online</command>"
msgstr ""

#. Tag: title
#: art_virtualization-best-practices.xml:3894
#, no-c-format
msgid "More information"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:3900
#, no-c-format
msgid "<link xlink:href=\"https://kernel.org/doc/ols/2009/ols2009-pages-19-28.pdf\">Increasing memory density using KSM</link>"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:3906
#, no-c-format
msgid "<link xlink:href=\"http://www.linux-kvm.org/page/KSM\">linux-kvm.org KSM</link>"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:3912
#, no-c-format
msgid "<link xlink:href=\"https://www.kernel.org/doc/Documentation/vm/ksm.txt\">KSM's kernel documentation</link>"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:3918
#, no-c-format
msgid "<link xlink:href=\"https://lwn.net/Articles/329123/\">ksm - dynamic page sharing driver for linux v4</link>"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:3924
#, no-c-format
msgid "<link xlink:href=\"http://www.espenbraastad.no/post/memory-ballooning/\">Memory Ballooning</link>"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:3930
#, no-c-format
msgid "<link xlink:href=\"https://wiki.libvirt.org/page/Virtio\">libvirt virtio</link>"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:3936
#, no-c-format
msgid "<link xlink:href=\"https://www.kernel.org/doc/html/latest/block/bfq-iosched.html\">BFQ (Budget Fair Queueing)</link>"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:3941
#, no-c-format
msgid "<link xlink:href=\"https://www.kernel.org/doc/Documentation/sysctl/kernel.txt\">Documentation for sysctl</link>"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:3948
#, no-c-format
msgid "<link xlink:href=\"https://lwn.net/Articles/525459/\">LWN Random Number</link>"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:3954
#, no-c-format
msgid "<link xlink:href=\"http://wiki.mikejung.biz/KVM_/_Xen\">&kvm; / &xen; tweaks</link>"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:3960
#, no-c-format
msgid "<link xlink:href=\"http://events.linuxfoundation.org/sites/events/files/slides/CloudOpen2013_Khoa_Huynh_v3.pdf\">Dr. Khoa Huynh, IBM Linux Technology Center</link>"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:3967
#, no-c-format
msgid "<link xlink:href=\"https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/plain/Documentation/admin-guide/kernel-parameters.txt\">Kernel Parameters</link>"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:3974
#, no-c-format
msgid "<link xlink:href=\"https://lwn.net/Articles/374424/\">Huge pages Administration (Mel Gorman)</link>"
msgstr ""

#. Tag: para
#: art_virtualization-best-practices.xml:3980
#, no-c-format
msgid "<link xlink:href=\"https://www.kernel.org/doc/Documentation/vm/hugetlbpage.txt\">kernel hugetlbpage</link>"
msgstr ""

